<!DOCTYPE html>
<html lang="{{ current_lang }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ t.title }} | {{ t.subtitle }}</title>
  <meta name="description" content="{{ t.subtitle }}. {{ t.detailed_test_desc }}">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Charts -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css">
  
  <!-- Animations -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
  
  <style>
    :root {
      --primary: #00a896;
      --primary-light: #8bf0d6;
      --primary-dark: #00756c;
      --secondary: #05668d;
      --secondary-light: #5ab1d1;
      --secondary-dark: #033d56;
      --accent: #f0a202;
      --accent-light: #f8d57e;
      --accent-dark: #c78300;
      --dark: #2d3436;
      --darker: #1e2223;
      --light: #f9f9f9;
      --lighter: #ffffff;
      --gray: #636e72;
      --light-gray: #dfe6e9;
      --success: #00b894;
      --warning: #fdcb6e;
      --error: #d63031;
      
      /* Gradients */
      --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-dark));
      --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      --gradient-accent: linear-gradient(135deg, var(--accent), var(--accent-dark));
      --gradient-dark: linear-gradient(135deg, var(--dark), var(--darker));
      
      /* Shadows */
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
      --shadow-lg: 0 8px 32px rgba(0,0,0,0.16);
      
      /* Border radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      
      /* Spacing */
      --space-xs: 0.5rem;
      --space-sm: 1rem;
      --space-md: 1.5rem;
      --space-lg: 2rem;
      --space-xl: 3rem;
      
      /* Transition */
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    /* Reset & Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      scroll-behavior: smooth;
      font-size: 16px;
    }
    
    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: var(--light);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      padding-top: 80px;
    }
    
    a {
      text-decoration: none;
      color: inherit;
    }
    
    ul {
      list-style-type: none;
    }
    
    img {
      max-width: 100%;
      height: auto;
    }

    /* Typography */
    h1, h2, h3, h4, h5 {
      font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: var(--space-sm);
      color: var(--dark);
    }
    
    h1 {
      font-size: 3rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
      display: inline-block;
    }
    
    h1:after {
      content: '';
      position: absolute;
      bottom: -12px;
      left: 0;
      width: 80px;
      height: 5px;
      background: var(--gradient-primary);
      border-radius: 3px;
    }
    
    h2 {
      font-size: 2.2rem;
      margin-top: var(--space-xl);
      margin-bottom: var(--space-md);
    }
    
    h3 {
      font-size: 1.8rem;
    }
    
    h4 {
      font-size: 1.4rem;
    }
    
    p {
      font-size: 1.1rem;
      margin-bottom: var(--space-md);
      color: var(--gray);
    }
    
    small {
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    .lead {
      font-size: 1.3rem;
      font-weight: 300;
      line-height: 1.5;
    }
    
    .text-center {
      text-align: center;
    }
    
    /* Layout */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--space-md);
    }
    
    /* Navbar */
    .navbar {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: var(--space-sm) var(--space-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-sm);
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      transition: var(--transition);
    }
    
    .navbar.scrolled {
      box-shadow: var(--shadow-md);
    }
    
    .navbar-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .navbar-logo {
      font-weight: 700;
      font-size: 1.5rem;
      font-family: 'Montserrat', sans-serif;
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      color: var(--dark);
      text-decoration: none;
      transition: var(--transition);
    }
    
    .navbar-logo:hover {
      transform: scale(1.03);
    }
    
    .navbar-logo i {
      font-size: 1.5rem;
      color: var(--primary);
    }
    
    .nav-links {
      display: flex;
      gap: var(--space-sm);
      align-items: center;
    }
    
    .nav-links a {
      color: var(--dark);
      text-decoration: none;
      padding: var(--space-xs) var(--space-sm);
      border-radius: 50px;
      transition: var(--transition);
      font-weight: 500;
      position: relative;
    }
    
    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 2px;
      background: var(--primary);
      transition: var(--transition);
    }
    
    .nav-links a:hover::after,
    .nav-links a.active::after {
      width: 80%;
    }
    
    .nav-links a:hover,
    .nav-links a.active {
      color: var(--primary);
    }
    
    /* Language Selector */
    .language-selector {
      display: flex;
      gap: var(--space-xs);
      margin-left: var(--space-sm);
    }
    
    .language-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.05);
      color: var(--dark);
      border: none;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .language-btn:hover {
      background: rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    .language-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(0, 168, 150, 0.3);
    }
    
    /* Hero Section */
    .hero {
      background: url('static/img/earth-hero.jpg') no-repeat center center;
      background-size: cover;
      height: 500px;
      display: flex;
      align-items: center;
      position: relative;
      margin-bottom: var(--space-xl);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-lg);
    }
    
    .hero:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
    }
    
    .hero-content {
      position: relative;
      z-index: 1;
      color: white;
      max-width: 600px;
      animation: fadeInUp 1s ease-out;
    }
    
    .hero h1 {
      -webkit-text-fill-color: white;
      color: white;
      background: none;
      animation-delay: 0.2s;
    }
    
    .hero h1:after {
      background: white;
    }
    
    .hero p {
      color: rgba(255,255,255,0.9);
      font-size: 1.2rem;
      animation-delay: 0.4s;
    }
    
    /* Cards */
    .card {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      box-shadow: var(--shadow-md);
      transition: var(--transition);
      margin-bottom: var(--space-lg);
      border: none;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 168, 150, 0.03) 0%, rgba(5, 102, 141, 0.03) 100%);
      z-index: 0;
    }
    
    .card:hover {
      transform: translateY(-10px);
      box-shadow: var(--shadow-lg);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
      position: relative;
      z-index: 1;
    }
    
    .card-icon {
      width: 60px;
      height: 60px;
      background: rgba(0, 168, 150, 0.1);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--primary);
      transition: var(--transition);
    }
    
    .card:hover .card-icon {
      transform: rotate(15deg) scale(1.1);
      background: var(--gradient-primary);
      color: white;
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.8rem 1.8rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 1rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      border: none;
      gap: var(--space-xs);
      white-space: nowrap;
      position: relative;
      overflow: hidden;
    }
    
    .btn:after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      opacity: 0;
      transition: var(--transition);
    }
    
    .btn:hover:after {
      opacity: 1;
    }
    
    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 168, 150, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 168, 150, 0.4);
    }
    
    .btn-secondary {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    
    .btn-secondary:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
    }
    
    .btn-accent {
      background: var(--gradient-accent);
      color: white;
    }
    
    .btn-accent:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(243, 115, 53, 0.4);
    }
    
    .btn-block {
      display: flex;
      width: 100%;
    }
    
    /* Forms */
    .form-group {
      margin-bottom: var(--space-md);
    }
    
    label {
      display: block;
      margin-bottom: var(--space-xs);
      font-weight: 500;
      color: var(--dark);
    }
    
    .radio-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-sm);
      margin-bottom: var(--space-md);
    }
    
    .radio-option {
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
      cursor: pointer;
      padding: var(--space-md);
      border-radius: var(--radius-md);
      background: white;
      border: 1px solid var(--light-gray);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    .radio-option:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 0;
      background: var(--primary);
      transition: var(--transition);
    }
    
    .radio-option:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow-sm);
      transform: translateY(-3px);
    }
    
    .radio-option:hover:before {
      height: 100%;
    }
    
    .radio-option input[type="radio"] {
      margin-top: 0.2rem;
      min-width: 18px;
      height: 18px;
      accent-color: var(--primary);
    }
    
    .radio-option-content {
      flex: 1;
    }
    
    .radio-option h4 {
      color: var(--dark);
      margin-bottom: var(--space-xs);
    }
    
    .radio-option small {
      color: var(--gray);
    }
    
    .radio-option.selected {
      border-color: var(--primary);
      background: rgba(0, 168, 150, 0.05);
      box-shadow: 0 4px 12px rgba(0, 168, 150, 0.1);
    }
    
    .radio-option.selected:before {
      height: 100%;
    }
    
    select {
      width: 100%;
      padding: var(--space-sm);
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      color: var(--dark);
      background-color: white;
      transition: var(--transition);
      appearance: none;
      background-image: 
        linear-gradient(45deg, transparent 50%, var(--primary) 50%),
        linear-gradient(135deg, var(--primary) 50%, transparent 50%);
      background-position:
        calc(100% - 20px) calc(1em + 4px),
        calc(100% - 15px) calc(1em + 4px);
      background-size: 5px 5px, 5px 5px;
      background-repeat: no-repeat;
    }
    
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 168, 150, 0.2);
    }
    
    /* Questions */
    .questions-container {
      display: grid;
      gap: var(--space-md);
    }
    
    .question-card {
      background: white;
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      box-shadow: var(--shadow-sm);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border-left: 4px solid var(--primary);
      animation: floatUp 0.5s ease-out forwards;
      opacity: 0;
      position: relative;
      z-index: 1;
    }
    
    .question-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: var(--shadow-lg);
    }
    
    /* Delayed animations */
    .question-card:nth-child(1) { animation-delay: 0.1s; }
    .question-card:nth-child(2) { animation-delay: 0.2s; }
    .question-card:nth-child(3) { animation-delay: 0.3s; }
    .question-card:nth-child(4) { animation-delay: 0.4s; }
    .question-card:nth-child(5) { animation-delay: 0.5s; }
    .question-card:nth-child(6) { animation-delay: 0.6s; }
    .question-card:nth-child(7) { animation-delay: 0.7s; }
    .question-card:nth-child(8) { animation-delay: 0.8s; }
    .question-card:nth-child(9) { animation-delay: 0.9s; }
    .question-card:nth-child(10) { animation-delay: 1.0s; }
    .question-card:nth-child(11) { animation-delay: 1.1s; }
    .question-card:nth-child(12) { animation-delay: 1.2s; }
    .question-card:nth-child(13) { animation-delay: 1.3s; }
    .question-card:nth-child(14) { animation-delay: 1.4s; }
    .question-card:nth-child(15) { animation-delay: 1.5s; }
    .question-card:nth-child(16) { animation-delay: 1.6s; }
    .question-card:nth-child(17) { animation-delay: 1.7s; }
    .question-card:nth-child(18) { animation-delay: 1.8s; }
    .question-card:nth-child(19) { animation-delay: 1.9s; }
    .question-card:nth-child(20) { animation-delay: 2.0s; }
    
    .question-header {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-sm);
    }
    
    .question-number {
      width: 36px;
      height: 36px;
      background: var(--gradient-primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }
    
    .question-text {
      font-weight: 500;
      color: var(--dark);
    }
    
    .question-category {
      display: inline-block;
      padding: 0.3rem 0.8rem;
      background: rgba(0, 168, 150, 0.1);
      color: var(--primary);
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-top: var(--space-xs);
    }
    
    .hint-text {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: var(--space-xs);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }
    
    .hint-text i {
      color: var(--accent);
    }
    
    /* Results */
    .results-card {
      animation: fadeIn 0.8s ease-out;
    }
    
    .result-header {
      text-align: center;
      margin-bottom: var(--space-xl);
    }
    
    .result-badge {
      display: inline-flex;
      align-items: baseline;
      background: var(--gradient-primary);
      color: white;
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-md);
      box-shadow: var(--shadow-md);
      animation: pulse 2s infinite;
    }
    
    .result-badge span {
      font-size: 3.5rem;
      font-weight: 800;
      line-height: 1;
    }
    
    .result-badge small {
      font-size: 1.5rem;
      color: white;
      opacity: 0.8;
    }
    
    .result-category {
      display: inline-block;
      padding: var(--space-xs) var(--space-lg);
      background: var(--gradient-primary);
      color: white;
      border-radius: 50px;
      font-weight: 700;
      margin-bottom: var(--space-md);
      font-size: 1.4rem;
      box-shadow: 0 4px 20px rgba(0, 168, 150, 0.3);
      animation: floatUp 0.8s ease-out;
    }
    
    .progress-container {
      width: 100%;
      height: 12px;
      background: var(--light-gray);
      border-radius: 6px;
      margin: var(--space-md) 0;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: var(--gradient-primary);
      width: 0;
      transition: width 1.5s ease-out;
      position: relative;
    }
    
    .progress-dots {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 10px;
    }
    
    .progress-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      opacity: 0.5;
    }
    
    .progress-labels {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-xs);
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    .result-description {
      text-align: center;
      max-width: 800px;
      margin: 0 auto var(--space-lg);
      font-size: 1.1rem;
    }
    
    /* Impact Stats */
    .impact-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-md);
      margin: var(--space-xl) 0;
    }
    
    .stat-card {
      background: white;
      padding: var(--space-md);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      text-align: center;
      transition: var(--transition);
      border-top: 4px solid var(--primary);
      animation: fadeInUp 0.5s ease-out;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      background: rgba(0, 168, 150, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-sm);
      font-size: 1.5rem;
      color: var(--primary);
      transition: var(--transition);
    }
    
    .stat-card:hover .stat-icon {
      transform: scale(1.1);
      background: var(--gradient-primary);
      color: white;
    }
    
    .stat-value {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--primary-dark);
      margin: var(--space-xs) 0;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    /* Enhanced Category Results */
    .enhanced-category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--space-md);
      margin-top: var(--space-md);
    }
    
    .enhanced-category-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      box-shadow: var(--shadow-md);
      transition: var(--transition);
      border-top: 4px solid var(--primary);
      display: flex;
      flex-direction: column;
    }
    
    .enhanced-category-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }
    
    .category-header {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-sm);
    }
    
    .category-icon {
      width: 50px;
      height: 50px;
      background: rgba(0, 168, 150, 0.1);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: var(--primary);
    }
    
    .score-display {
      display: flex;
      justify-content: space-between;
      margin: var(--space-sm) 0;
    }
    
    .your-score, .average-score {
      text-align: center;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
    }
    
    .your-score {
      background: rgba(0, 168, 150, 0.1);
    }
    
    .average-score {
      background: rgba(5, 102, 141, 0.1);
    }
    
    .score-value {
      font-size: 1.8rem;
      font-weight: 700;
      display: block;
      line-height: 1;
    }
    
    .your-score .score-value {
      color: var(--primary);
    }
    
    .average-score .score-value {
      color: var(--secondary);
    }
    
    .score-label {
      font-size: 0.8rem;
      color: var(--gray);
      display: block;
      margin-top: var(--space-xs);
    }
    
    .progress-comparison {
      margin: var(--space-sm) 0;
    }
    
    .progress-container {
      height: 8px;
      background: var(--light-gray);
      border-radius: 4px;
      margin-bottom: var(--space-xs);
    }
    
    .your-progress {
      background: var(--gradient-primary);
    }
    
    .average-progress {
      background: var(--gradient-dark);
    }
    
    .category-description {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: var(--space-sm);
      line-height: 1.5;
    }
    
    /* Carbon Visualization */
    .carbon-visualization {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      margin: var(--space-xl) 0;
      box-shadow: var(--shadow-md);
      border: 1px solid rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }
    
    .carbon-visualization:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 168, 150, 0.03) 0%, rgba(5, 102, 141, 0.03) 100%);
      z-index: 0;
    }
    
    .visualization-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-lg);
      margin: var(--space-md) 0;
    }
    
    .chart-container {
      position: relative;
      width: 100%;
      height: 300px;
      margin: 0 auto;
    }
    
    .chart-center-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      pointer-events: none;
    }
    
    .center-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary-dark);
      line-height: 1;
    }
    
    .center-label {
      font-size: 1rem;
      color: var(--gray);
      margin-top: var(--space-xs);
    }
    
    /* Recommendations */
    .recommendations {
      margin: var(--space-xl) 0;
    }
    
    .recommendation-item {
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
      margin-bottom: var(--space-md);
      padding: var(--space-md);
      border-radius: var(--radius-sm);
      background: white;
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
      animation: fadeInRight 0.5s ease-out;
    }
    
    .recommendation-item:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }
    
    .recommendation-number {
      width: 30px;
      height: 30px;
      background: var(--gradient-primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }
    
    .recommendation-content {
      flex: 1;
    }
    
    /* Badges */
    .badges-container {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-md);
      margin: var(--space-xl) 0;
      justify-content: center;
    }
    
    .badge {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-md);
      border-radius: var(--radius-lg);
      font-size: 1rem;
      font-weight: 600;
      background: white;
      box-shadow: var(--shadow-md);
      transition: var(--transition);
      width: 200px;
      text-align: center;
      position: relative;
      overflow: hidden;
      border-top: 4px solid var(--primary);
      animation: fadeInUp 0.5s ease-out;
    }
    
    .badge i {
      font-size: 2rem;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(0, 168, 150, 0.1);
      transition: var(--transition);
    }
    
    .badge:hover {
      transform: translateY(-10px);
      box-shadow: var(--shadow-lg);
    }
    
    .badge:hover i {
      transform: rotate(15deg) scale(1.1);
      background: var(--gradient-primary);
      color: white;
    }
    
    .badge-primary {
      background: var(--gradient-primary);
      color: white;
    }
    
    .badge-primary i {
      color: white;
      background: rgba(255, 255, 255, 0.2);
    }
    
    .badge-description {
      font-size: 0.85rem;
      font-weight: normal;
      color: var(--gray);
      margin-top: var(--space-xs);
    }
    
    .badge-primary .badge-description {
      color: rgba(255, 255, 255, 0.8);
    }
    
    /* Mini Game */
    .game-container {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      margin: var(--space-xl) 0;
      box-shadow: var(--shadow-md);
    }
    
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }
    
    .game-stats {
      display: flex;
      gap: var(--space-lg);
    }
    
    .game-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .game-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
    }
    
    .game-stat-label {
      font-size: 0.8rem;
      color: var(--gray);
    }
    
    .game-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }
    
    .game-card {
      aspect-ratio: 1;
      background: var(--primary-light);
      border-radius: var(--radius-sm);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-size: 2rem;
      transition: var(--transition);
      position: relative;
      transform-style: preserve-3d;
    }
    
    .game-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }
    
    .game-card.flipped .game-card-inner {
      transform: rotateY(180deg);
    }
    
    .game-card-front, .game-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
    }
    
    .game-card-front {
      background: var(--gradient-primary);
      color: white;
    }
    
    .game-card-back {
      background: white;
      color: var(--primary-dark);
      transform: rotateY(180deg);
      box-shadow: inset 0 0 0 2px var(--primary-light);
    }
    
    .game-card.matched {
      cursor: default;
      transform: scale(0.95);
    }
    
    .game-card.matched .game-card-front {
      background: var(--success);
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-md);
      flex-wrap: wrap;
    }
    
    /* Footer */
      .footer {
          background: linear-gradient(135deg, var(--dark-color), var(--darker-color));
          color: var(--white);
          padding: 5rem 2rem 2rem;
          margin-top: 5rem;
          position: relative;
      }

      .footer::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100px;
          background: linear-gradient(to bottom, var(--lighter-color), transparent);
      }

      .footer-container {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
          gap: 3rem;
          max-width: 1200px;
          margin: 0 auto;
          position: relative;
          z-index: 1;
      }

      .footer-logo {
          font-size: 2rem;
          font-weight: 700;
          margin-bottom: 1.5rem;
          font-family: 'Montserrat', sans-serif;
          display: flex;
          align-items: center;
          gap: 12px;
      }

      .footer-logo i {
          color: var(--primary-color);
      }

      .footer-about {
          margin-bottom: 2rem;
          line-height: 1.7;
          opacity: 0.8;
      }

      h3, .footer-contact h3 {
          font-size: 1.4rem;
          margin-bottom: 2rem;
          position: relative;
          padding-bottom: 0.8rem;
          font-family: 'Montserrat', sans-serif;
      }

      .footer-links h3::after, .footer-contact h3::after {
          content: '';
          position: absolute;
          bottom: 0;
          left: 0;
          width: 50px;
          height: 4px;
          background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
          border-radius: 2px;
      }

      .footer-links ul {
          list-style: none;
      }

      .footer-links li {
          margin-bottom: 1rem;
      }

      .footer-links a {
          color: #bbb;
          text-decoration: none;
          transition: var(--transition);
          display: flex;
          align-items: center;
          gap: 10px;
      }

      .footer-links a:hover {
          color: var(--primary-color);
          transform: translateX(5px);
      }

      .contact-item {
          display: flex;
          align-items: flex-start;
          margin-bottom: 1.5rem;
          gap: 15px;
      }

      .contact-icon {
          color: var(--primary-color);
          font-size: 1.2rem;
          margin-top: 3px;
      }

      .social-links {
          display: flex;
          gap: 1.5rem;
          margin-top: 2rem;
      }

      .social-link {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 45px;
          height: 45px;
          background-color: rgba(255, 255, 255, 0.1);
          border-radius: 50%;
          color: var(--white);
          transition: var(--transition);
          font-size: 1.2rem;
      }

      .social-link:hover {
          background-color: var(--primary-color);
          transform: translateY(-5px);
      }

      .copyright {
          text-align: center;
          padding-top: 3rem;
          margin-top: 3rem;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          color: #bbb;
          font-size: 0.9rem;
          position: relative;
          z-index: 1;
      }

    /* Responsive Tasarım */
    @media (max-width: 768px) {
      .footer {
        padding: 3rem 1.5rem 1.5rem;
      }
      
      .footer-container {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      
      .footer-logo {
        font-size: 1.8rem;
      }
      
      .footer-links h3, .footer-contact h3 {
        font-size: 1.3rem;
        margin-bottom: 1.5rem;
      }
      
      .social-links {
        justify-content: center;
      }
    }
    .contact-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1.5rem;
        gap: 15px;
    }
    
    .contact-icon {
        color: var(--primary-color);
        font-size: 1.2rem;
        margin-top: 3px;
    }
    
    .social-links {
        display: flex;
        gap: 1.5rem;
        margin-top: 2rem;
    }
    
    .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 45px;
        height: 45px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        color: var(--white);
        transition: var(--transition);
        font-size: 1.2rem;
    }
    
    .social-link:hover {
        background-color: var(--primary-color);
        transform: translateY(-5px);
    }
    
    .copyright {
        text-align: center;
        padding-top: 3rem;
        margin-top: 3rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        color: #bbb;
        font-size: 0.9rem;
        position: relative;
        z-index: 1;
    }

    .chart-legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-xs) var(--space-sm);
      border-radius: 50px;
      background: white;
      box-shadow: var(--shadow-sm);
      font-size: 0.9rem;
    }
    
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeInRight {
      from { opacity: 0; transform: translateX(30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0); }
    }
    
    @keyframes floatUp {
      0% { transform: translateY(20px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 0 0 rgba(0, 168, 150, 0.4); }
      70% { box-shadow: 0 0 0 15px rgba(0, 168, 150, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 168, 150, 0); }
    }
    
    @keyframes scaleIn {
      0% { opacity: 0; transform: scale(0.8); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.8s ease-out;
    }
    
    .animate-pulse {
      animation: pulse 2s infinite;
    }
    
    .animate-float {
      animation: float 3s ease-in-out infinite;
    }
    
    .animate-float-up {
      animation: floatUp 0.8s ease-out forwards;
    }
    
    .animate-pulse-glow {
      animation: pulseGlow 2s infinite;
    }
    
    .animate-scaleIn {
      animation: scaleIn 0.6s ease-out forwards;
    }
    
    .delay-1 { animation-delay: 0.2s; }
    .delay-2 { animation-delay: 0.4s; }
    .delay-3 { animation-delay: 0.6s; }
    .delay-4 { animation-delay: 0.8s; }
    .delay-5 { animation-delay: 1s; }
    
    /* Utility Classes */
    .mt-1 { margin-top: var(--space-xs); }
    .mt-2 { margin-top: var(--space-sm); }
    .mt-3 { margin-top: var(--space-md); }
    .mt-4 { margin-top: var(--space-lg); }
    .mt-5 { margin-top: var(--space-xl); }
    .mb-1 { margin-bottom: var(--space-xs); }
    .mb-2 { margin-bottom: var(--space-sm); }
    .mb-3 { margin-bottom: var(--space-md); }
    .mb-4 { margin-bottom: var(--space-lg); }
    .mb-5 { margin-bottom: var(--space-xl); }
    .hidden {
      display: none;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
      h1 {
        font-size: 2.8rem;
      }
      
      h2 {
        font-size: 2rem;
      }
      
      .hero {
        height: 400px;
      }
      
      .visualization-container {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      h1 {
        font-size: 2.4rem;
      }
      
      h2 {
        font-size: 1.8rem;
      }
      
      .hero {
        height: 350px;
      }
      
      .radio-group {
        grid-template-columns: 1fr;
      }
      
      .game-board {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .action-buttons .btn {
        width: 100%;
      }
      
      .enhanced-category-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 576px) {
      h1 {
        font-size: 2rem;
      }
      
      .hero {
        height: 300px;
      }
      
      .game-board {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .impact-stats {
        grid-template-columns: 1fr;
      }
      
      .navbar {
        padding: var(--space-sm);
      }
      
      .navbar-logo {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="container navbar-container">
      <a href="{{ url_for('index') }}" class="navbar-logo">
        <i class="fas fa-leaf"></i> Eco Urgent
      </a>
      <div class="nav-links">
        <a href="{{ url_for('index') }}" aria-current="{{ 'page' if request.path == url_for('index') else 'false' }}">{{ t.home }}</a>
        <a href="{{ url_for('bilgilendirme') }}">{{ t.info }}</a>
        <a href="{{ url_for('kurbanlar') }}">{{ t.victims }}</a>
        <a href="{{ url_for('senin_etkin') }}" class="active" aria-current="page">{{ t.impact_test }}</a>
        <a href="{{ url_for('destek') }}"  aria-current="page">{{ t.destek }}</a>
        <div class="language-selector">
            <button class="language-btn {{ 'active' if current_lang == 'tr' else '' }}" 
                    onclick="changeLanguage('tr')"
                    aria-label="Turkish language">
                TR
            </button>
            <button class="language-btn {{ 'active' if current_lang == 'en' else '' }}" 
                    onclick="changeLanguage('en')"
                    aria-label="English language">
                EN
            </button>
        </div>
      </div>
    </div>
  </nav>

  <main class="container" role="main">
    {% if not test_turu and not sonuc %}
    <section class="hero">
      <div class="container hero-content">
        <h1 class="animate__animated animate__fadeInDown"><i class="fas fa-seedling"></i> {{ t.title }}</h1>
        <p class="lead animate__animated animate__fadeInDown animate__delay-1s">{{ t.subtitle }}</p>
        <a href="#test-section" class="btn btn-primary btn-lg mt-3 animate__animated animate__pulse animate__infinite">
          <i class="fas fa-play"></i> {{ t.start_test }}
        </a>
      </div>
    </section>
    {% endif %}
    
    <section id="test-section" class="{{ 'mt-5' if not test_turu and not sonuc else '' }}">
      <div class="card">
        <h1><i class="fas fa-seedling"></i> {{ t.title }}</h1>
        <p>{{ t.subtitle }}</p>
        
        <div class="mt-4">
          <h3>{{ t.select_test }}</h3>
          <p>{% if current_lang == 'tr' %}İhtiyacınıza göre kısa veya detaylı test seçebilirsiniz:{% else %}Choose between quick or detailed test based on your needs:{% endif %}</p>
          
          <form method="POST" id="test-type-form" class="mt-3">
            <input type="hidden" name="answers_submitted" value="false">
            <div class="radio-group">
              <label class="radio-option {{ 'selected' if test_turu == 'kisa' else '' }}">
                <input type="radio" name="test_turu" value="kisa" required {{ 'checked' if test_turu == 'kisa' else '' }}>
                <div class="radio-option-content">
                  <h4>{{ t.quick_test }}</h4>
                  <small>{{ t.quick_test_desc }}</small>
                </div>
              </label>
              <label class="radio-option {{ 'selected' if test_turu == 'detayli' else '' }}">
                <input type="radio" name="test_turu" value="detayli" required {{ 'checked' if test_turu == 'detayli' else '' }}>
                <div class="radio-option-content">
                  <h4>{{ t.detailed_test }}</h4>
                  <small>{{ t.detailed_test_desc }}</small>
                </div>
              </label>
            </div>
            <button type="submit" class="btn btn-primary mt-3">
              <i class="fas fa-play"></i> {{ t.start_test }}
            </button>
          </form>
        </div>
      </div>
    </section>

    {% if test_turu %}
    <section id="test-questions">
      <div class="card">
        <form method="POST" id="test-form">
          <input type="hidden" name="test_turu" value="{{ test_turu }}">
          <input type="hidden" name="answers_submitted" value="true">
          <div class="text-center mb-4">
            <h2>{{ "Hızlı Etki Testi" if test_turu == "kisa" else "Detaylı Etki Analizi" }}</h2>
            <p>{% if current_lang == 'tr' %}Lütfen aşağıdaki soruları günlük yaşam alışkanlıklarınıza göre yanıtlayınız.{% else %}Please answer the following questions according to your daily habits.{% endif %}</p>
            <div class="progress-container">
              <div id="form-progress" class="progress-bar" style="width: 0%">
                <div class="progress-dots">
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                </div>
              </div>
              <div class="progress-labels">
                <span>0%</span>
                <span>100%</span>
              </div>
            </div>
          </div>

          <div class="questions-container">
            {% set sorular = [
              {
                "text": "Haftalık ortalama araba kullanma mesafeniz nedir?", 
                "options": [
                  {"text": "Arabam yok (0 km)", "value": "0", "impact": "0 kg CO₂"},
                  {"text": "Çok az (1-50 km)", "value": "1", "impact": "12 kg CO₂"},
                  {"text": "Orta (51-150 km)", "value": "2", "impact": "24 kg CO₂"},
                  {"text": "Fazla (151-300 km)", "value": "3", "impact": "48 kg CO₂"},
                  {"text": "Çok fazla (300+ km)", "value": "4", "impact": "80+ kg CO₂"}
                ],
                "category": "Ulaşım",
                "icon": "fa-car",
                "weight": 1.2
              },
              {
                "text": "Haftada kaç öğün kırmızı et tüketiyorsunuz?", 
                "options": [
                  {"text": "Vejetaryenim (0 öğün)", "value": "0", "impact": "0 kg CO₂"},
                  {"text": "Az (1-3 öğün)", "value": "1", "impact": "8 kg CO₂"},
                  {"text": "Orta (4-7 öğün)", "value": "2", "impact": "18 kg CO₂"},
                  {"text": "Fazla (8-14 öğün)", "value": "3", "impact": "35 kg CO₂"},
                  {"text": "Çok fazla (15+ öğün)", "value": "4", "impact": "55+ kg CO₂"}
                ],
                "category": "Beslenme",
                "icon": "fa-drumstick-bite",
                "weight": 1.1
              },
              {
                "text": "Evde enerji tasarruflu cihaz ve ampul kullanım oranınız nedir?", 
                "options": [
                  {"text": "Hepsi tasarruflu", "value": "0", "impact": "0.8 ton CO₂/yıl"},
                  {"text": "Çoğunlukla", "value": "1", "impact": "1.5 ton CO₂/yıl"},
                  {"text": "Yarı yarıya", "value": "2", "impact": "2.2 ton CO₂/yıl"},
                  {"text": "Azınlıkta", "value": "3", "impact": "3.0 ton CO₂/yıl"},
                  {"text": "Hiçbiri", "value": "4", "impact": "4.5+ ton CO₂/yıl"}
                ],
                "category": "Enerji",
                "icon": "fa-bolt",
                "weight": 1.0
              },
              {
                "text": "Atıklarınızın ne kadarını geri dönüştürüyorsunuz?", 
                "options": [
                  {"text": "Tüm atıklarım", "value": "0", "impact": "0.15 ton atık/yıl"},
                  {"text": "Çoğunu", "value": "1", "impact": "0.45 ton atık/yıl"},
                  {"text": "Yarısını", "value": "2", "impact": "0.75 ton atık/yıl"},
                  {"text": "Azını", "value": "3", "impact": "1.2 ton atık/yıl"},
                  {"text": "Hiç", "value": "4", "impact": "1.8+ ton atık/yıl"}
                ],
                "category": "Atık Yönetimi",
                "icon": "fa-recycle",
                "weight": 0.9
              },
              {
                "text": "Çevre dostu ürünleri tercih etme sıklığınız nedir?", 
                "options": [
                  {"text": "Her zaman", "value": "0", "impact": "Düşük etki"},
                  {"text": "Sıklıkla", "value": "1", "impact": "Orta-düşük etki"},
                  {"text": "Bazen", "value": "2", "impact": "Orta etki"},
                  {"text": "Nadiren", "value": "3", "impact": "Orta-yüksek etki"},
                  {"text": "Hiç", "value": "4", "impact": "Yüksek etki"}
                ],
                "category": "Tüketim",
                "icon": "fa-shopping-bag",
                "weight": 0.8
              },
              {
                "text": "Toplu taşıma veya bisiklet kullanma sıklığınız nedir?", 
                "options": [
                  {"text": "Her gün", "value": "0", "impact": "0 kg CO₂"},
                  {"text": "Haftada 3-5 kez", "value": "1", "impact": "3 kg CO₂"},
                  {"text": "Haftada 1-2 kez", "value": "2", "impact": "7 kg CO₂"},
                  {"text": "Ayda 1-2 kez", "value": "3", "impact": "15 kg CO₂"},
                  {"text": "Hiç", "value": "4", "impact": "30+ kg CO₂"}
                ],
                "category": "Ulaşım",
                "icon": "fa-bus",
                "weight": 1.1
              },
              {
                "text": "Kullanmadığınız elektronik cihazları kapatma alışkanlığınız nedir?", 
                "options": [
                  {"text": "Her zaman", "value": "0", "impact": "75 kWh/yıl"},
                  {"text": "Sıklıkla", "value": "1", "impact": "150 kWh/yıl"},
                  {"text": "Bazen", "value": "2", "impact": "300 kWh/yıl"},
                  {"text": "Nadiren", "value": "3", "impact": "450 kWh/yıl"},
                  {"text": "Hiç", "value": "4", "impact": "700+ kWh/yıl"}
                ],
                "category": "Enerji",
                "icon": "fa-plug",
                "weight": 0.9
              },
              {
                "text": "Günlük ortalama internet/cihaz kullanım süreniz nedir?", 
                "options": [
                  {"text": "1 saatten az", "value": "0", "impact": "75 kg CO₂/yıl"},
                  {"text": "1-3 saat", "value": "1", "impact": "150 kg CO₂/yıl"},
                  {"text": "4-6 saat", "value": "2", "impact": "300 kg CO₂/yıl"},
                  {"text": "7-9 saat", "value": "3", "impact": "450 kg CO₂/yıl"},
                  {"text": "10+ saat", "value": "4", "impact": "700+ kg CO₂/yıl"}
                ],
                "category": "Teknoloji",
                "icon": "fa-laptop",
                "weight": 0.8
              },
              {
                "text": "Dışarıda yemek yeme veya paket servis kullanma sıklığınız?", 
                "options": [
                  {"text": "Hiç", "value": "0", "impact": "0 kg atık"},
                  {"text": "Ayda 1-2 kez", "value": "1", "impact": "1.5 kg atık/ay"},
                  {"text": "Haftada 1-2 kez", "value": "2", "impact": "4.5 kg atık/ay"},
                  {"text": "Haftada 3-5 kez", "value": "3", "impact": "9 kg atık/ay"},
                  {"text": "Her gün", "value": "4", "impact": "15+ kg atık/ay"}
                ],
                "category": "Beslenme",
                "icon": "fa-utensils",
                "weight": 0.9
              },
              {
                "text": "İkinci el veya sürdürülebilir ürün alışverişi yapma sıklığınız?", 
                "options": [
                  {"text": "Her zaman", "value": "0", "impact": "Düşük etki"},
                  {"text": "Sıklıkla", "value": "1", "impact": "Orta-düşük etki"},
                  {"text": "Bazen", "value": "2", "impact": "Orta etki"},
                  {"text": "Nadiren", "value": "3", "impact": "Orta-yüksek etki"},
                  {"text": "Hiç", "value": "4", "impact": "Yüksek etki"}
                ],
                "category": "Tüketim",
                "icon": "fa-tshirt",
                "weight": 0.8
              },
              {
                "text": "Plastik poşet ve tek kullanımlık ürünlerden kaçınma düzeyiniz?", 
                "options": [
                  {"text": "Tamamen kaçınıyorum", "value": "0", "impact": "0 kg plastik/yıl"},
                  {"text": "Çoğunlukla", "value": "1", "impact": "3 kg plastik/yıl"},
                  {"text": "Yarı yarıya", "value": "2", "impact": "7 kg plastik/yıl"},
                  {"text": "Nadiren", "value": "3", "impact": "15 kg plastik/yıl"},
                  {"text": "Hiç", "value": "4", "impact": "30+ kg plastik/yıl"}
                ],
                "category": "Atık Yönetimi",
                "icon": "fa-trash-alt",
                "weight": 0.9
              },
              {
                "text": "Yıllık uçakla seyahat sayınız ortalama kaçtır?", 
                "options": [
                  {"text": "Hiç", "value": "0", "impact": "0 ton CO₂"},
                  {"text": "1-2", "value": "1", "impact": "1.5 ton CO₂"},
                  {"text": "3-5", "value": "2", "impact": "4.5 ton CO₂"},
                  {"text": "6-10", "value": "3", "impact": "9 ton CO₂"},
                  {"text": "10+", "value": "4", "impact": "15+ ton CO₂"}
                ],
                "category": "Ulaşım",
                "icon": "fa-plane",
                "weight": 1.3
              },
              {
                "text": "Su tasarrufu yapmak için önlem alıyor musunuz?", 
                "options": [
                  {"text": "Kapsamlı önlemler", "value": "0", "impact": "75 L/gün"},
                  {"text": "Birkaç önlem", "value": "1", "impact": "150 L/gün"},
                  {"text": "Bazı", "value": "2", "impact": "225 L/gün"},
                  {"text": "Çok az", "value": "3", "impact": "300 L/gün"},
                  {"text": "Hiç", "value": "4", "impact": "450+ L/gün"}
                ],
                "category": "Su Kullanımı",
                "icon": "fa-tint",
                "weight": 0.8
              },
              {
                "text": "Yılda satın aldığınız yeni giysi sayısı ortalama kaçtır?", 
                "options": [
                  {"text": "5'ten az", "value": "0", "impact": "75 kg CO₂"},
                  {"text": "5-10", "value": "1", "impact": "150 kg CO₂"},
                  {"text": "11-20", "value": "2", "impact": "300 kg CO₂"},
                  {"text": "21-30", "value": "3", "impact": "450 kg CO₂"},
                  {"text": "30+", "value": "4", "impact": "700+ kg CO₂"}
                ],
                "category": "Tüketim",
                "icon": "fa-tshirt",
                "weight": 0.7
              },
              {
                "text": "Haftalık çöp üretiminiz ne kadar?", 
                "options": [
                  {"text": "Çok az (1 küçük poşet)", "value": "0", "impact": "75 kg/yıl"},
                  {"text": "Az (1 poşet)", "value": "1", "impact": "150 kg/yıl"},
                  {"text": "Orta (2 poşet)", "value": "2", "impact": "300 kg/yıl"},
                  {"text": "Çok (3-4 poşet)", "value": "3", "impact": "450 kg/yıl"},
                  {"text": "Çok fazla (5+ poşet)", "value": "4", "impact": "700+ kg/yıl"}
                ],
                "category": "Atık Yönetimi",
                "icon": "fa-trash",
                "weight": 0.9
              },
              {
                "text": "Bahçenizde veya balkonunuzda bitki yetiştiriyor musunuz?", 
                "options": [
                  {"text": "Evet, geniş bir bahçem var", "value": "0", "impact": "Negatif CO₂"},
                  {"text": "Evet, balkonumda bitkiler var", "value": "1", "impact": "Düşük etki"},
                  {"text": "Birkaç saksı bitkim var", "value": "2", "impact": "Orta-düşük etki"},
                  {"text": "Hayır, ama ilgileniyorum", "value": "3", "impact": "Orta etki"},
                  {"text": "Hayır, ilgilenmiyorum", "value": "4", "impact": "Yüksek etki"}
                ],
                "category": "Yaşam Tarzı",
                "icon": "fa-spa",
                "weight": 0.7
              },
              {
                "text": "Yerel ve mevsimsel ürünler tüketme sıklığınız nedir?", 
                "options": [
                  {"text": "Her zaman", "value": "0", "impact": "0 kg CO₂"},
                  {"text": "Sıklıkla", "value": "1", "impact": "3 kg CO₂"},
                  {"text": "Bazen", "value": "2", "impact": "7 kg CO₂"},
                  {"text": "Nadiren", "value": "3", "impact": "15 kg CO₂"},
                  {"text": "Hiç", "value": "4", "impact": "30+ kg CO₂"}
                ],
                "category": "Beslenme",
                "icon": "fa-apple-alt",
                "weight": 0.8
              },
              {
                "text": "Elektronik cihazlarınızı ne sıklıkla yeniliyorsunuz?", 
                "options": [
                  {"text": "Bozulunca", "value": "0", "impact": "0.15 ton atık/yıl"},
                  {"text": "5+ yılda bir", "value": "1", "impact": "0.45 ton atık/yıl"},
                  {"text": "3-4 yılda bir", "value": "2", "impact": "0.75 ton atık/yıl"},
                  {"text": "2 yılda bir", "value": "3", "impact": "1.2 ton atık/yıl"},
                  {"text": "Her yıl", "value": "4", "impact": "1.8+ ton atık/yıl"}
                ],
                "category": "Teknoloji",
                "icon": "fa-mobile-alt",
                "weight": 0.8
              },
              {
                "text": "Hangi tür su şişeleri kullanıyorsunuz?", 
                "options": [
                  {"text": "Cam veya çelik şişe", "value": "0", "impact": "0 kg plastik"},
                  {"text": "Yeniden kullanılabilir plastik", "value": "1", "impact": "0.75 kg plastik"},
                  {"text": "Büyük damacanalar", "value": "2", "impact": "1.5 kg plastik"},
                  {"text": "Tek kullanımlık pet şişe", "value": "3", "impact": "7.5 kg plastik"},
                  {"text": "Her gün yeni pet şişe", "value": "4", "impact": "15+ kg plastik"}
                ],
                "category": "Atık Yönetimi",
                "icon": "fa-wine-bottle",
                "weight": 0.9
              }
            ] %}

            {% for i in range(sorular|length) if (test_turu == 'detayli') or (i < 10) %}
            <div class="question-card" id="question-{{ loop.index }}">
              <div class="question-header">
                <div class="question-number">{{ loop.index }}</div>
                <div class="question-text">
                  <i class="fas {{ sorular[i].icon }}"></i> {{ sorular[i].text }}
                  <div class="question-category">{{ sorular[i].category }}</div>
                </div>
              </div>
              <div class="hint-text">
                <i class="fas fa-info-circle"></i> {{ t.hint_text }}
              </div>
              <select name="soru{{ loop.index }}" class="mt-2" required>
                <option value="" disabled selected>{{ t.select_option }}</option>
                {% for option in sorular[i].options %}
                <option value="{{ option.value }}" data-impact="{{ option.impact }}" data-weight="{{ sorular[i].weight }}">{{ option.text }} ({{ option.impact }})</option>
                {% endfor %}
              </select>
            </div>
            {% endfor %}
          </div>

          <div class="form-group mt-4">
            <button type="submit" class="btn btn-primary btn-block">
              <i class="fas fa-chart-bar"></i> {% if current_lang == 'tr' %}Sonuçları Görüntüle{% else %}View Results{% endif %}
            </button>
          </div>
        </form>
      </div>
    </section>
    {% endif %}
    
    {% if sonuc %}
    <section id="results-section">
      <div class="card results-card">
        <div class="result-header">
          <h2><i class="fas fa-award"></i> {{ t.results_title }}</h2>
          <p>{{ t.results_desc }}</p>
          
          <div class="result-badge animate__animated animate__pulse">
            <span>{{ sonuc.puan }}</span>
            <small>/100</small>
          </div>
          <span class="result-category animate__animated animate__fadeIn animate__delay-1s">{{ sonuc.puan_text }}</span>
          
          <div class="result-progress">
            <div class="progress-container">
              <div class="progress-bar" style="width: {{ sonuc.puan }}%;">
                <div class="progress-dots">
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                  <div class="progress-dot"></div>
                </div>
              </div>
              <div class="progress-labels">
                <span>0%</span>
                <span>100%</span>
              </div>
            </div>
          </div>
          
          <div class="result-description">
            <p>{{ sonuc.aciklama }}</p>
          </div>
        </div>
        
        <div class="impact-stats">
          <div class="stat-card animate__animated animate__fadeInUp delay-1">
            <div class="stat-icon"><i class="fas fa-fire"></i></div>
            <div class="stat-value">{{ sonuc.yillik_karbon }} {% if current_lang == 'tr' %}ton{% else %}tons{% endif %}</div>
            <div class="stat-label">{% if current_lang == 'tr' %}Yıllık Karbon Ayak İzi{% else %}Annual Carbon Footprint{% endif %}</div>
          </div>
          <div class="stat-card animate__animated animate__fadeInUp delay-2">
            <div class="stat-icon"><i class="fas fa-bolt"></i></div>
            <div class="stat-value">{{ sonuc.aylik_elektrik }} kWh</div>
            <div class="stat-label">{% if current_lang == 'tr' %}Aylık Elektrik Tüketimi{% else %}Monthly Electricity Consumption{% endif %}</div>
          </div>
          <div class="stat-card animate__animated animate__fadeInUp delay-3">
            <div class="stat-icon"><i class="fas fa-tint"></i></div>
            <div class="stat-value">{{ sonuc.gunluk_su }} L</div>
            <div class="stat-label">{% if current_lang == 'tr' %}Günlük Su Tüketimi{% else %}Daily Water Consumption{% endif %}</div>
          </div>
          <div class="stat-card animate__animated animate__fadeInUp delay-4">
            <div class="stat-icon"><i class="fas fa-trash"></i></div>
            <div class="stat-value">{{ sonuc.haftalik_cop }} kg</div>
            <div class="stat-label">{% if current_lang == 'tr' %}Haftalık Çöp Üretimi{% else %}Weekly Waste Production{% endif %}</div>
          </div>
        </div>
        
        <div class="carbon-visualization">
          <h3><i class="fas fa-chart-pie"></i> {% if current_lang == 'tr' %}Karbon Ayak İzi Dağılımı ve Karşılaştırma{% else %}Carbon Footprint Distribution & Comparison{% endif %}</h3>
          
          <div class="visualization-container">
            <!-- Kişisel Grafik -->
            <div>
              <h4 style="text-align: center;">{% if current_lang == 'tr' %}Sizin Dağılımınız{% else %}Your Distribution{% endif %}</h4>
              <div class="chart-container">
                <canvas id="carbonChart"></canvas>
                <div class="chart-center-text">
                  <div class="center-value">{{ sonuc.yillik_karbon }}</div>
                  <div class="center-label">{% if current_lang == 'tr' %}ton CO₂/yıl{% else %}tons CO₂/year{% endif %}</div>
                </div>
              </div>
            </div>
            
            <!-- Ortalama Grafik -->
            <div>
              <h4 style="text-align: center;">{% if current_lang == 'tr' %}Topluluk Ortalaması{% else %}Community Average{% endif %}</h4>
              <div class="chart-container">
                <canvas id="averageChart"></canvas>
                <div class="chart-center-text">
                  <div class="center-value">{{ "%.1f"|format(sonuc.averages.average_score) }}</div>
                  <div class="center-label">{% if current_lang == 'tr' %}Ortalama Puan{% else %}Average Score{% endif %}</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="chart-legend">
            {% for category, percentage in sonuc.carbon_percentages.items() %}
            <div class="legend-item">
              <div class="legend-color" style="background-color: {{ 
                  '#00a896' if category == 'transportation' else
                  '#05668d' if category == 'nutrition' else
                  '#028090' if category == 'energy' else
                  '#02c39a' if category == 'waste' else
                  '#f0a202' if category == 'consumption' else
                  '#f0f3bd'
              }}"></div>
              <span>{{ 
                  ('Ulaşım' if current_lang == 'tr' else 'Transportation') if category == 'transportation' else
                  ('Beslenme' if current_lang == 'tr' else 'Nutrition') if category == 'nutrition' else
                  ('Enerji' if current_lang == 'tr' else 'Energy') if category == 'energy' else
                  ('Atık Yönetimi' if current_lang == 'tr' else 'Waste Management') if category == 'waste' else
                  ('Tüketim' if current_lang == 'tr' else 'Consumption') if category == 'consumption' else
                  ('Yaşam Tarzı' if current_lang == 'tr' else 'Lifestyle')
              }} ({{ percentage }}%)</span>
            </div>
            {% endfor %}
          </div>
        </div>
        
        <div class="category-comparison mt-5">
          <h3><i class="fas fa-chart-bar"></i> {% if current_lang == 'tr' %}Kategori Bazında Performans{% else %}Category Performance{% endif %}</h3>
          <p>{% if current_lang == 'tr' %}Kategorilerdeki puanlarınız ve topluluk ortalaması:{% else %}Your scores vs community averages by category:{% endif %}</p>
          
          <div class="enhanced-category-grid">
          <div class="enhanced-category-grid">
            {% for category, score in sonuc.kategori_puanlari.items() %}
              {% set category_key = 
                  'transportation' if category == 'Ulaşım' else
                  'nutrition' if category == 'Beslenme' else
                  'energy' if category == 'Enerji' else
                  'waste' if category == 'Atık Yönetimi' else
                  'consumption' if category == 'Tüketim' else
                  'lifestyle' if category == 'Yaşam Tarzı' else
                  category.lower().replace(' ', '_').replace('ı','i').replace('ş','s').replace('ğ','g')
              %}
              <div class="enhanced-category-card">
                <div class="category-header">
                  <div class="category-icon">
                    <i class="fas {{
                        'fa-car' if category_key == 'transportation' else
                        'fa-utensils' if category_key == 'nutrition' else
                        'fa-bolt' if category_key == 'energy' else
                        'fa-recycle' if category_key == 'waste' else
                        'fa-shopping-bag' if category_key == 'consumption' else
                        'fa-spa'
                    }}"></i>
                  </div>
                  <h4>{{ category }}</h4>
                </div>
                
                <div class="score-display">
                  <div class="your-score">
                    <span class="score-value">{{ score }}</span>
                    <span class="score-label">{% if current_lang == 'tr' %}Sizin Puanınız{% else %}Your Score{% endif %}</span>
                  </div>
                  <div class="average-score">
                    <span class="score-value">{{ sonuc.averages.category_averages[category_key] }}</span>
                    <span class="score-label">{% if current_lang == 'tr' %}Ortalama{% else %}Average{% endif %}</span>
                  </div>
                </div>
                
                <div class="progress-comparison">
                  <div class="progress-container">
                    <div class="progress-bar your-progress" style="width: {{ score }}%"></div>
                  </div>
                  <div class="progress-container">
                    <div class="progress-bar average-progress" style="width: {{ sonuc.averages.category_averages[category_key] }}%"></div>
                  </div>
                </div>
                
                <div class="category-description">
                  {{ sonuc.kategori_aciklamalari[category] }}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        
        <div class="recommendations animate__animated animate__fadeIn delay-3">
          <h3><i class="fas fa-lightbulb"></i> {{ t.recommendations }}</h3>
          <p>{% if current_lang == 'tr' %}Çevresel etkinizi azaltmak için aşağıdaki önerileri uygulayabilirsiniz:{% else %}You can apply the following recommendations to reduce your environmental impact:{% endif %}</p>
          
          {% for tavsiye in sonuc.tavsiyeler %}
          <div class="recommendation-item animate__animated animate__fadeInRight delay-{{ loop.index0 // 2 + 1 }}">
            <div class="recommendation-number">{{ loop.index }}</div>
            <div class="recommendation-content">{{ tavsiye }}</div>
          </div>
          {% endfor %}
        </div>
        
        <div class="badges-container animate__animated animate__fadeIn delay-4">
          {% for badge in sonuc.badges %}
          <div class="badge {% if badge.name in ['Eco Champion', 'Çevre Şampiyonu'] %}badge-primary{% endif %}" style="border-top-color: {{ badge.color }}; animation-delay: {{ loop.index * 0.2 }}s">
            <i class="fas {{ badge.icon }}" style="color: {{ badge.color }}"></i>
            <h4>{{ badge.name }}</h4>
            <p class="badge-description">{{ badge.description }}</p>
          </div>
          {% endfor %}
        </div>
        
        <div class="game-container animate__animated animate__fadeIn delay-5">
          <div class="game-header">
            <h3><i class="fas fa-gamepad"></i> {{ t.game_title }}</h3>
            <div class="game-stats">
              <div class="game-stat">
                <div class="game-stat-value" id="game-score">0</div>
                <div class="game-stat-label">{% if current_lang == 'tr' %}Puan{% else %}Score{% endif %}</div>
              </div>
              <div class="game-stat">
                <div class="game-stat-value" id="game-moves">0</div>
                <div class="game-stat-label">{% if current_lang == 'tr' %}Hamle{% else %}Moves{% endif %}</div>
              </div>
            </div>
          </div>
          <p>{{ t.game_desc }}</p>
          <div class="game-board" id="game-board"></div>
        </div>
        
        <div class="action-buttons animate__animated animate__fadeIn">
          <a href="{{ url_for('senin_etkin') }}" class="btn btn-secondary">
            <i class="fas fa-redo"></i> {{ t.retake_test }}
          </a>
          <button class="btn btn-primary" id="share-results">
            <i class="fas fa-share-alt"></i> {{ t.share_results }}
          </button>
          <button class="btn btn-accent" id="download-results">
            <i class="fas fa-download"></i> {{ t.download_report }}
          </button>
        </div>
      </div>
    </section>
    {% endif %}
  </main>

  <footer class="footer">
        <div class="footer-container">
            <div class="footer-about">
                <div class="footer-logo">
                    <i class="fas fa-leaf"></i>
                    <span>Eco Urgent</span>
                </div>
                <p class="footer-about">
                    {% if current_lang == 'tr' %}
                        İklim değişikliği ile mücadelede birlikte hareket ediyoruz. Siz de söz verin, geleceğimizi birlikte kurtaralım.
                    {% else %}
                        We act together in the fight against climate change. Make your pledge and let's save our future together.
                    {% endif %}
                </p>
            </div>

            <div class="footer-links">
                <h3>
                    {% if current_lang == 'tr' %}
                        Hızlı Linkler
                    {% else %}
                        Quick Links
                    {% endif %}
                </h3>
                <ul>
                    <li><a href="{{ url_for('index') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span>{{ t.home }}</span>
                    </a></li>
                    <li><a href="{{ url_for('bilgilendirme') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span>{{ t.info }}</span>
                    </a></li>
                    <li><a href="{{ url_for('kurbanlar') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span>{{ t.victims }}</span>
                    </a></li>
                    <li><a href="{{ url_for('senin_etkin') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span>{{ t.impact_test }}</span>
                    </a></li>
                    <li><a href="{{ url_for('destek') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span class="tr-text">Siteyi Destekle</span>
                        <span class="en-text" style="display: none">Support Us</span>
                    </a></li>
                </ul>
            </div>

            <div class="footer-contact">
                <h3>
                    {% if current_lang == 'tr' %}
                        İletişim
                    {% else %}
                        Contact
                    {% endif %}
                </h3>

                <div class="contact-item">
                    <i class="fas fa-map-marker-alt contact-icon"></i>
                    <div>
                        <span>
                            {% if current_lang == 'tr' %}
                                24 № Tam Orta Okul
                            {% else %}
                                Fully Secondary School №24
                            {% endif %}
                        </span>
                        <br>
                        <span>
                            {% if current_lang == 'tr' %}
                                Bakü, Azerbaycan
                            {% else %}
                                Baku, Azerbaijan
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="contact-item">
                    <i class="fas fa-envelope contact-icon"></i>
                    <div>
                        <span>kaymasali3@gmail.com</span>
                    </div>
                </div>

                <div class="contact-item">
                    <i class="fas fa-phone-alt contact-icon"></i>
                    <div>
                        <span>+994 50 602 29 16</span>
                    </div>
                </div>

                <div class="social-links">
                    <a href="https://instagram.com/mrkaymasfire" class="social-link" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="copyright">
            <p>&copy; 2025 Eco Urgent. 
                {% if current_lang == 'tr' %}
                    Tüm hakları saklıdır.
                {% else %}
                    All rights reserved.
                {% endif %}
            </p>
            <div style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <a href="{{ url_for('privacy_policy') }}" style="color: #bbb; text-decoration: none; font-size: 0.9rem; transition: color 0.3s ease;">
                    {% if current_lang == 'tr' %}
                        Gizlilik Politikası
                    {% else %}
                        Privacy Policy
                    {% endif %}
                </a>
                <a href="{{ url_for('terms_of_use') }}" style="color: #bbb; text-decoration: none; font-size: 0.9rem; transition: color 0.3s ease;">
                    {% if current_lang == 'tr' %}
                        Kullanım Şartları
                    {% else %}
                        Terms of Use
                    {% endif %}
                </a>
            </div>
        </div>
    </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Navbar scroll effect
    const navbar = document.querySelector('.navbar');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    });

    // Language change function
    function changeLanguage(lang) {
        // Set a cookie with the selected language
        document.cookie = `lang=${lang};path=/;max-age=31536000`; // 1 year
        
        // Send request to server to change language
        fetch(`/set_language/${lang}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'same-origin' // Include cookies
        })
        .then(response => {
            if (response.ok) {
                // Force page reload to apply language changes
                window.location.reload(true);
            } else {
                console.error('Language change failed');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            // Fallback: reload anyway
            window.location.reload(true);
        });
    }

    // Form progress bar
    const testForm = document.getElementById('test-form');
    if(testForm) {
      const questions = testForm.querySelectorAll('.question-card');
      const progressBar = document.getElementById('form-progress');
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if(entry.isIntersecting) {
            const visibleQuestions = Array.from(questions).filter(q => {
              const rect = q.getBoundingClientRect();
              return rect.top >= 0 && rect.bottom <= window.innerHeight + 100;
            }).length;
            
            const progress = Math.min(100, Math.round((visibleQuestions / questions.length) * 100));
            progressBar.style.width = `${progress}%`;
          }
        });
      }, {threshold: 0.5});
      
      questions.forEach(q => observer.observe(q));
      
      // Form validation
      testForm.addEventListener('submit', (e) => {
        let isValid = true;
        const selects = testForm.querySelectorAll('select[required]');
        
        selects.forEach(select => {
          if(!select.value) {
            select.style.borderColor = 'var(--error)';
            select.scrollIntoView({behavior: 'smooth', block: 'center'});
            isValid = false;
          } else {
            select.style.borderColor = '';
          }
        });
        
        if(!isValid) {
          e.preventDefault();
          alert('{{ t.select_option }}' === 'Select...' ? 'Please answer all questions!' : 'Lütfen tüm soruları yanıtlayınız!');
        }
      });
    }
    
    // Test type selection animation
    const testTypeForm = document.getElementById('test-type-form');
    if(testTypeForm) {
      const options = testTypeForm.querySelectorAll('.radio-option');
      options.forEach(option => {
        option.addEventListener('click', function() {
          options.forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
        });
      });
    }
    
    // Share results button
    const shareBtn = document.getElementById('share-results');
    if(shareBtn) {
      shareBtn.addEventListener('click', () => {
        if(navigator.share) {
          navigator.share({
            title: '{{ t.results_title }}',
            text: `{% if current_lang == 'tr' %}Benim çevresel etki puanım ${sonuc.puan}/100 (${sonuc.puan_text}). Sen de testi yap!{% else %}My environmental impact score is ${sonuc.puan}/100 (${sonuc.puan_text}). Take the test too!{% endif %}`,
            url: window.location.href
          }).catch(err => {
            console.log('Share cancelled:', err);
          });
        } else {
          const shareText = `{% if current_lang == 'tr' %}Benim çevresel etki puanım ${sonuc.puan}/100 (${sonuc.puan_text}). Sen de testi yap: ${window.location.href}{% else %}My environmental impact score is ${sonuc.puan}/100 (${sonuc.puan_text}). Take the test: ${window.location.href}{% endif %}`;
          prompt('{% if current_lang == tr %}Sonuçları paylaşmak için bu metni kopyalayın:{% else %}Copy this text to share your results:{% endif %}', shareText);
        }
      });
    }              
    
    // Download report button
    const downloadBtn = document.getElementById('download-results');
    if(downloadBtn) {
      downloadBtn.addEventListener('click', () => {
        // Generate PDF report
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Add title
        doc.setFontSize(20);
        doc.setTextColor(0, 168, 150);
        doc.text('{{ t.results_title }}', 105, 20, { align: 'center' });
        
        // Add score
        doc.setFontSize(16);
        doc.setTextColor(0, 0, 0);
        doc.text(`{% if current_lang == 'tr' %}Puanınız: ${sonuc.puan}/100 (${sonuc.puan_text}){% else %}Your Score: ${sonuc.puan}/100 (${sonuc.puan_text}){% endif %}`, 105, 30, { align: 'center' });
        
        // Add description
        doc.setFontSize(12);
        doc.text(sonuc.aciklama, 20, 40, { maxWidth: 170 });
        
        // Add recommendations
        doc.setFontSize(14);
        doc.setTextColor(0, 168, 150);
        doc.text('{{ t.recommendations }}', 20, 70);
        
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        let y = 80;
        sonuc.tavsiyeler.forEach((tavsiye, index) => {
          doc.text(`${index + 1}. ${tavsiye}`, 20, y);
          y += 10;
          if (y > 280) {
            doc.addPage();
            y = 20;
          }
        });
        
        // Save the PDF
        doc.save('{% if current_lang == "tr" %}Çevresel_Etki_Raporu{% else %}Environmental_Impact_Report{% endif %}.pdf');
      });
    }
    
    // Memory game
    const gameBoard = document.getElementById('game-board');
    if(gameBoard) {
      const icons = [
        'fa-recycle', 'fa-leaf', 'fa-solar-panel', 'fa-bicycle',
        'fa-tree', 'fa-wind', 'fa-seedling', 'fa-bus',
        'fa-tint', 'fa-lightbulb', 'fa-trash-alt', 'fa-tshirt'
      ];
      const cards = [...icons, ...icons];
      
      // Shuffle cards with Fisher-Yates algorithm
      for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }
      
      let flippedCards = [];
      let matchedCards = [];
      let score = 0;
      let moves = 0;
      const scoreElement = document.getElementById('game-score');
      const movesElement = document.getElementById('game-moves');
      let canFlip = true;
      
      // Create game board with animations
      cards.forEach((icon, index) => {
        const card = document.createElement('div');
        card.className = 'game-card';
        card.dataset.index = index;
        card.dataset.icon = icon;
        
        const cardInner = document.createElement('div');
        cardInner.className = 'game-card-inner';
        
        const cardFront = document.createElement('div');
        cardFront.className = 'game-card-front';
        const frontIcon = document.createElement('i');
        frontIcon.className = 'fas fa-question';
        cardFront.appendChild(frontIcon);
        
        const cardBack = document.createElement('div');
        cardBack.className = 'game-card-back';
        const backIcon = document.createElement('i');
        backIcon.className = `fas ${icon}`;
        cardBack.appendChild(backIcon);
        
        cardInner.appendChild(cardFront);
        cardInner.appendChild(cardBack);
        card.appendChild(cardInner);
        
        card.addEventListener('click', flipCard);
        gameBoard.appendChild(card);
        
        // Initial animation
        setTimeout(() => {
          card.style.opacity = '1';
          card.style.transform = 'scale(1)';
        }, 100 + (index * 50));
      });
      
      function flipCard() {
        if (!canFlip || this.classList.contains('flipped') || this.classList.contains('matched')) {
          return;
        }
        
        this.classList.add('flipped');
        flippedCards.push(this);
        
        if (flippedCards.length === 2) {
          canFlip = false;
          moves++;
          movesElement.textContent = moves;
          checkForMatch();
        }
      }
      
      function checkForMatch() {
        const [card1, card2] = flippedCards;
        const isMatch = card1.dataset.icon === card2.dataset.icon;
        
        if (isMatch) {
          card1.classList.add('matched');
          card2.classList.add('matched');
          matchedCards.push(card1, card2);
          
          // Add score with animation
          score += 20 - moves; // Bonus for fewer moves
          if (score < 0) score = 0;
          scoreElement.textContent = score;
          
          // Pulse animation for matched cards
          card1.querySelector('.game-card-front').style.animation = 'pulse 0.5s';
          card2.querySelector('.game-card-front').style.animation = 'pulse 0.5s';
          
          setTimeout(() => {
            card1.querySelector('.game-card-front').style.animation = '';
            card2.querySelector('.game-card-front').style.animation = '';
          }, 500);
          
          if (matchedCards.length === cards.length) {
            setTimeout(() => {
              const message = `{% if current_lang == 'tr' %}Tebrikler! Oyunu ${score} puan ve ${moves} hamle ile tamamladınız.{% else %}Congratulations! You completed the game with ${score} points and ${moves} moves.{% endif %}`;
              alert(message);
            }, 1000);
          }
          
          resetTurn();
        } else {
          setTimeout(() => {
            card1.classList.remove('flipped');
            card2.classList.remove('flipped');
            resetTurn();
          }, 1000);
        }
      }
      
      function resetTurn() {
        flippedCards = [];
        canFlip = true;
      }
    }
    
    // Charts for results section
    window.carbonData = JSON.parse('{{ carbon_data | safe }}');
    window.averagesData = JSON.parse('{{ averages_data | safe }}');
    window.currentLang = '{{ current_lang }}';

    function initCarbonChart() {
      const ctx = document.getElementById('carbonChart').getContext('2d');
      
      // Prepare data in correct order
      const orderedCategories = ['transportation', 'nutrition', 'energy', 'waste', 'consumption', 'lifestyle'];
      const labels = orderedCategories.map(key => 
        window.currentLang === 'tr' ? 
          (key === 'transportation' ? 'Ulaşım' :
           key === 'nutrition' ? 'Beslenme' :
           key === 'energy' ? 'Enerji' :
           key === 'waste' ? 'Atık' :
           key === 'consumption' ? 'Tüketim' : 'Yaşam Tarzı') :
          key.charAt(0).toUpperCase() + key.slice(1)
      );
      
      const data = orderedCategories.map(key => window.carbonData[key] || 0);
      const backgroundColors = [
        '#00a896', '#05668d', '#028090',
        '#02c39a', '#f0a202', '#f0f3bd'
      ];

      // Create chart
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: backgroundColors,
            borderWidth: 0,
            hoverBorderWidth: 1,
            hoverBorderColor: '#fff',
            hoverOffset: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '75%',
          radius: '95%',
          layout: {
            padding: 0
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              enabled: true,
              displayColors: true,
              usePointStyle: true,
              callbacks: {
                label: function(context) {
                  return `${context.label}: ${context.raw}%`;
                }
              },
              bodyFont: {
                family: "'Poppins', sans-serif",
                size: 12
              },
              titleFont: {
                family: "'Montserrat', sans-serif",
                size: 14,
                weight: 'bold'
              }
            }
          },
          animation: {
            animateScale: true,
            animateRotate: true,
            duration: 1500
          },
          elements: {
            arc: {
              borderWidth: 0,
              borderRadius: data.length > 5 ? 3 : 0
            }
          }
        }
      });
    }

    function initAverageChart() {
      const ctx = document.getElementById('averageChart').getContext('2d');
      
      // Prepare data in correct order
      const orderedCategories = ['transportation', 'nutrition', 'energy', 'waste', 'consumption', 'lifestyle'];
      const labels = orderedCategories.map(key => 
        window.currentLang === 'tr' ? 
          (key === 'transportation' ? 'Ulaşım' :
           key === 'nutrition' ? 'Beslenme' :
           key === 'energy' ? 'Enerji' :
           key === 'waste' ? 'Atık' :
           key === 'consumption' ? 'Tüketim' : 'Yaşam Tarzı') :
          key.charAt(0).toUpperCase() + key.slice(1)
      );
      
      const data = orderedCategories.map(key => window.averagesData[key] || 0);
      const backgroundColors = [
        '#00a896', '#05668d', '#028090',
        '#02c39a', '#f0a202', '#f0f3bd'
      ];

      // Create chart
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: backgroundColors,
            borderWidth: 0,
            hoverBorderWidth: 1,
            hoverBorderColor: '#fff',
            hoverOffset: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '75%',
          radius: '95%',
          layout: {
            padding: 0
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              enabled: true,
              displayColors: true,
              usePointStyle: true,
              callbacks: {
                label: function(context) {
                  return `${context.label}: ${context.raw}%`;
                }
              },
              bodyFont: {
                family: "'Poppins', sans-serif",
                size: 12
              },
              titleFont: {
                family: "'Montserrat', sans-serif",
                size: 14,
                weight: 'bold'
              }
            }
          },
          animation: {
            animateScale: true,
            animateRotate: true,
            duration: 1500
          },
          elements: {
            arc: {
              borderWidth: 0,
              borderRadius: data.length > 5 ? 3 : 0
            }
          }
        }
      });
    }

    // Initialize charts when page loads
    document.addEventListener('DOMContentLoaded', function() {
      if (document.getElementById('carbonChart') && window.carbonData) {
        initCarbonChart();
      }
      if (document.getElementById('averageChart') && window.averagesData) {
        initAverageChart();
      }
      
      // Animate progress bars
      setTimeout(() => {
        document.querySelectorAll('.progress-bar').forEach(bar => {
          const width = bar.style.width;
          bar.style.width = '0';
          setTimeout(() => {
            bar.style.width = width;
          }, 100);
        });
      }, 500);
    });
  </script>
</body>
</html>