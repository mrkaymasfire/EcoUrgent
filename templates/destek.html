<!DOCTYPE html>
<html lang="{{ current_lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Support our climate awareness initiative through donations or by playing our educational eco-city building game">
    <meta name="keywords" content="climate support, environmental donation, eco game, sustainability, carbon footprint, city builder, urban planning, environmental education">
    <title>{{ t.support }} - Climate Awareness</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --primary: #00a896;
            --primary-dark: #028a7a;
            --primary-light: #4dd0c4;
            --secondary: #f4a261;
            --accent: #e76f51;
            --success: #06d6a0;
            --warning: #ffd60a;
            --danger: #e63946;
            --dark: #264653;
            --darker: #1a252f;
            --gray: #6c757d;
            --light: #f8f9fa;
            --white: #ffffff;
            --eco-green: #2ecc71;
            --eco-blue: #3498db;
            --eco-dark: #0a2e38;
            --money: #f1c40f;
            --food: #e67e22;
            --happiness: #e84393;
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-light));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--accent));
            --gradient-dark: linear-gradient(135deg, var(--dark), var(--darker));
            --gradient-eco: linear-gradient(135deg, var(--eco-green), var(--eco-blue));
            --gradient-money: linear-gradient(135deg, var(--money), #f39c12);
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.15);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.2);
            --radius-sm: 6px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-top: 80px;
        }
        /* Navbar */
        .navbar {
            background: var(--gradient-dark);
            padding: 1rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-lg);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            background-color: rgba(44, 62, 80, 0.95);
        }
        
        .navbar.scrolled {
            padding: 0.8rem 3rem;
            background-color: rgba(44, 62, 80, 0.98);
        }
        
        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .navbar-logo {
            font-weight: 700;
            font-size: 1.8rem;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--white);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .navbar-logo:hover {
            transform: scale(1.03);
        }
        
        .navbar-logo i {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .navbar-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        
        .navbar a {
            color: var(--white);
            text-decoration: none;
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .navbar a::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: var(--transition);
        }
        
        .navbar a:hover::before, .navbar a.active::before {
            width: 100%;
        }
        
        .navbar a:hover, .navbar a.active {
            color: var(--primary);
        }
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }
        /* Hero Section */
        .hero {
            background: url('https://images.unsplash.com/photo-1615529328331-f8917597711f?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80') no-repeat center center;
            background-size: cover;
            height: 60vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            color: white;
            margin-bottom: var(--space-xl);
        }
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            padding: 2rem;
        }
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .hero p {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        /* Language Toggle */
        .language-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 0.5rem;
            background: rgba(255,255,255,0.9);
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(5px);
        }
        .language-toggle button {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
        }
        .language-toggle button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .language-toggle button.active {
            background: var(--gradient-secondary);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-md);
        }
        /* Support Section - Enhanced */
        .support-section {
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-lg);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .support-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }
        .support-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }
        .support-title {
            font-size: 2.5rem;
            margin-bottom: var(--space-md);
            font-weight: 700;
        }
        .support-description {
            font-size: 1.2rem;
            margin-bottom: var(--space-lg);
            line-height: 1.8;
        }
        .coffee-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-md);
            background: url('https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg') no-repeat center;
            background-size: contain;
        }
        .coffee-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            background: var(--gradient-money);
            color: #000;
            padding: 1rem 2rem;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 700;
            font-size: 1.2rem;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            margin: var(--space-md) auto;
            position: relative;
            z-index: 1;
            width: fit-content;
            min-width: 250px;
        }
        .coffee-button:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, #FFDD00, #FFC312);
        }
        .coffee-icon {
            width: 24px;
            height: 24px;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTUgMTBWMThBMzMgMCAwMDggMjFIMTNBMzMgMCAwMDE2IDE4VjEwTTUgMTBIMTZNNSAxMEg0QTIgMiAwIDAwMiAxMlYxNEEyIDIgMCAwMDQgNUg1TTE2IDEwSDE4QTIgMiAwIDAxMjAgMTJWMTRBMiAyIDAgMDExOCAxNkgxNk05IDdWNUEyIDIgMCAwMTEgM0gyQTIgMiAwIDAxMyA1VjciIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+') no-repeat center;
            background-size: contain;
        }
        
        /* Supporters Section - New */
        .supporters-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border-radius: var(--radius-md);
            margin-top: var(--space-lg);
            padding: var(--space-md);
            box-shadow: var(--shadow-md);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .supporters-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--space-md);
            gap: var(--space-sm);
        }
        
        .supporters-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--white);
            margin: 0;
        }
        
        .supporters-icon {
            font-size: 1.5rem;
            color: var(--warning);
        }
        
        .supporters-container {
            height: 200px;
            overflow-y: auto;
            padding: var(--space-sm);
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            text-align: left;
        }
        
        .supporters-message {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            border-left: 3px solid var(--warning);
        }
        
        .supporters-message:last-child {
            margin-bottom: 0;
        }
        
        .supporters-message p {
            margin: 0;
            color: var(--white);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .supporters-message .signature {
            font-style: italic;
            text-align: right;
            margin-top: var(--space-xs);
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* Scrollbar styling */
        .supporters-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .supporters-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
        }
        
        .supporters-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-sm);
        }
        
        .supporters-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .support-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: var(--space-md);
            margin-top: var(--space-xl);
        }
        .support-option {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(5px);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            width: 250px;
            text-align: center;
            transition: var(--transition);
        }
        .support-option:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-5px);
        }
        .support-option i {
            font-size: 2.5rem;
            margin-bottom: var(--space-sm);
            color: var(--warning);
        }
        .support-option h3 {
            font-size: 1.2rem;
            margin-bottom: var(--space-xs);
        }
        .support-option p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        /* Game Section - Enhanced */
        .game-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--space-xl);
            position: relative;
            overflow: hidden;
        }
        .game-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1476231682828-37e571bc172f?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80') no-repeat center center;
            background-size: cover;
            opacity: 0.1;
            z-index: 0;
        }
        .game-title {
            font-size: 2.5rem;
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--space-md);
            position: relative;
            z-index: 1;
            text-align: center;
        }
        .game-description {
            text-align: center;
            max-width: 800px;
            margin: 0 auto var(--space-lg);
            position: relative;
            z-index: 1;
            font-size: 1.1rem;
            color: var(--gray);
        }
        /* Game Header */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            position: relative;
            z-index: 1;
        }
        /* Resources Panel */
        .resources-panel {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            background: rgba(255,255,255,0.9);
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }
        .resource {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            background: rgba(0,0,0,0.05);
            font-weight: 600;
            min-width: 120px;
        }
        .resource-icon {
            font-size: 1.2rem;
        }
        .resource-value {
            font-size: 1.1rem;
            font-family: 'Montserrat', sans-serif;
        }
        .resource.money .resource-icon { color: var(--money); }
        .resource.energy .resource-icon { color: var(--warning); }
        .resource.food .resource-icon { color: var(--food); }
        .resource.population .resource-icon { color: var(--primary); }
        .resource.happiness .resource-icon { color: var(--happiness); }
        /* Missions Panel */
        .missions-panel {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--space-md);
            border: 1px solid rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }
        .mission-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) 0;
            border-bottom: 1px dashed rgba(0,0,0,0.1);
        }
        .mission-icon {
            font-size: 1.2rem;
            color: var(--primary);
        }
        .mission-progress {
            flex-grow: 1;
            background: rgba(0,0,0,0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        .mission-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            width: 0%;
            transition: width 0.5s ease;
        }
        .mission-reward {
            background: var(--gradient-money);
            color: #000;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
        }
        /* Game Controls */
        .game-controls {
            display: flex;
            gap: var(--space-sm);
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: var(--space-lg);
            position: relative;
            z-index: 1;
        }
        .game-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            position: relative;
            overflow: hidden;
        }
        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .game-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .game-btn.secondary {
            background: var(--gradient-secondary);
        }
        /* Game Container */
        .game-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: var(--space-lg);
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }
        @media (max-width: 992px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }
        /* Game World */
        .game-world {
            background: linear-gradient(to bottom, #87ceeb 0%, #98fb98 100%);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            min-height: 500px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
            touch-action: manipulation;
        }
        .game-grid {
            display: grid;
            grid-template-columns: repeat(15, 1fr); /* Increased grid size */
            gap: 4px;
            margin: var(--space-md) 0;
            background: rgba(255,255,255,0.1);
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            position: relative;
            z-index: 1;
        }
        .game-tile {
            aspect-ratio: 1;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem; /* Reduced font size for smaller tiles */
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            background-size: cover;
            background-position: center;
            user-select: none;
        }
        .game-tile:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-sm);
        }
        .game-tile.grass {
            background: linear-gradient(135deg, #7cb342, #8bc34a);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        .game-tile.water {
            background: linear-gradient(135deg, #2196f3, #03a9f4);
            animation: wave 2s ease-in-out infinite;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        .game-tile.rock {
            background: linear-gradient(135deg, #757575, #9e9e9e);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }
        .game-tile.forest {
            background: linear-gradient(135deg, #2e7d32, #388e3c);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        .game-tile.polluted {
            background: linear-gradient(135deg, #795548, #8d6e63);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }
        .game-tile.clean {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            animation: glow 1s ease-in-out;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        .game-tile.house {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        .game-tile.factory {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
        }
        .game-tile.solar {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
        }
        .game-tile.farm {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        .game-tile.park {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        .game-tile.hospital {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        .game-tile.school {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        .game-tile.wind {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        .game-tile.nursery {
            background: linear-gradient(135deg, #1abc9c, #16a085);
        }
        .game-tile.mountain {
            background: linear-gradient(135deg, #795548, #5d4037);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        .game-tile.desert {
            background: linear-gradient(135deg, #ffcc80, #ffb74d);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        .game-tile.selected {
            border-color: var(--warning);
            box-shadow: 0 0 10px rgba(255, 214, 10, 0.5);
        }
        .building-level {
            position: absolute;
            bottom: 2px;
            right: 2px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 0.6rem;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
        }
        /* Building Menu */
        .building-menu {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            height: 100%;
            position: relative;
            z-index: 1;
            overflow-y: auto;
        }
        .building-category {
            margin-bottom: var(--space-lg);
        }
        .building-category h3 {
            font-size: 1.2rem;
            margin-bottom: var(--space-sm);
            color: var(--dark);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 0.5rem;
        }
        .building-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
        }
        .building-option {
            background: var(--light);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            border: 1px solid rgba(0,0,0,0.1);
            position: relative;
        }
        .building-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            background: var(--primary-light);
            color: white;
        }
        .building-option.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }
        .building-option.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .building-option.locked::after {
            content: '\f023';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 5px;
            right: 5px;
            color: var(--danger);
        }
        .building-icon {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        .building-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        .building-cost {
            font-size: 0.8rem;
            color: var(--gray);
        }
        .building-option.selected .building-cost {
            color: rgba(255,255,255,0.8);
        }
        .building-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            width: 200px;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            box-shadow: var(--shadow-md);
        }
        .building-option:hover .building-tooltip {
            opacity: 1;
        }
        /* Stats Panel */
        .stats-panel {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            margin-top: var(--space-lg);
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px dashed rgba(0,0,0,0.1);
        }
        .stat-label {
            font-weight: 500;
            color: var(--gray);
        }
        .stat-value {
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
        }
        /* Tech Tree Panel */
        .tech-tree-panel {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            margin-top: var(--space-lg);
            display: none;
        }
        .tech-tree {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-md);
        }
        .tech-item {
            background: var(--light);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            position: relative;
            border-left: 3px solid var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }
        .tech-item.unlocked {
            border-left-color: var(--success);
            background: rgba(6,214,160,0.1);
        }
        .tech-item.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .tech-item:hover:not(.locked) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        .tech-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        .tech-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .tech-desc {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }
        .tech-cost {
            font-size: 0.8rem;
            color: var(--money);
            font-weight: 600;
        }
        .tech-requirements {
            font-size: 0.7rem;
            color: var(--gray);
            font-style: italic;
        }
        /* Events Panel */
        .events-panel {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            margin-top: var(--space-lg);
            max-height: 200px;
            overflow-y: auto;
        }
        .event-item {
            padding: var(--space-sm);
            border-left: 3px solid var(--primary);
            margin-bottom: var(--space-sm);
            background: rgba(0,168,150,0.05);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
        }
        .event-item.warning {
            border-left-color: var(--warning);
            background: rgba(255,214,10,0.05);
        }
        .event-item.danger {
            border-left-color: var(--danger);
            background: rgba(230,57,70,0.05);
        }
        .event-item.success {
            border-left-color: var(--success);
            background: rgba(6,214,160,0.05);
        }
        /* Charts Panel */
        .charts-panel {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            margin-top: var(--space-lg);
            display: none;
        }
        .chart-container {
            height: 200px;
            margin-bottom: var(--space-md);
            position: relative;
        }
        /* Scenario Selection Modal */
        .scenario-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        .scenario-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: popIn 0.5s ease-out;
        }
        .scenario-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
            margin: var(--space-lg) 0;
        }
        .scenario-option {
            background: var(--light);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            text-align: center;
        }
        .scenario-option:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }
        .scenario-option.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }
        .scenario-icon {
            font-size: 2.5rem;
            margin-bottom: var(--space-sm);
        }
        .scenario-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: var(--space-xs);
        }
        .scenario-desc {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: var(--space-sm);
        }
        .scenario-option.selected .scenario-desc {
            color: rgba(255,255,255,0.8);
        }
        .scenario-start-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: block;
            width: 100%;
            margin-top: var(--space-md);
        }
        .scenario-start-btn:hover {
            background: var(--gradient-primary-dark);
            transform: translateY(-2px);
        }
        .scenario-start-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        /* Save/Load Modal */
        .save-load-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .save-load-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            max-width: 600px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            animation: popIn 0.5s ease-out;
        }
        .save-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin: var(--space-lg) 0;
        }
        .save-slot {
            background: var(--light);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            text-align: center;
        }
        .slot-info {
            font-size: 0.9rem;
            color: var(--gray);
            margin: var(--space-sm) 0;
        }
        .slot-buttons {
            display: flex;
            gap: var(--space-sm);
            justify-content: center;
        }
        /* Tutorial Overlay */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 20000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .tutorial-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            max-width: 600px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            position: relative;
        }
        .tutorial-step {
            display: none;
        }
        .tutorial-step.active {
            display: block;
        }
        .tutorial-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: var(--space-lg);
        }
        .tutorial-highlight {
            position: absolute;
            border: 3px solid var(--warning);
            border-radius: var(--radius-md);
            box-shadow: 0 0 20px rgba(255, 214, 10, 0.7);
            z-index: 20001;
            pointer-events: none;
            animation: pulse 2s infinite;
        }
        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            text-align: center;
            animation: popIn 0.5s ease-out;
            display: none;
            background: var(--gradient-primary);
            color: white;
            max-width: 400px;
            width: 90%;
        }
        /* Level Indicator */
        .level-indicator {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            box-shadow: var(--shadow-md);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }
        .level-progress {
            width: 100px;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .level-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            width: 0%;
            transition: width 0.5s ease;
        }
        /* Environmental Effects */
        .environment-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            opacity: 0;
            transition: opacity 1s ease;
        }
        .smog-overlay {
            background: rgba(100, 100, 100, 0.3);
        }
        .clean-overlay {
            background: rgba(200, 255, 200, 0.1);
        }
        /* Animations */
        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
        }
        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--success); }
            50% { box-shadow: 0 0 15px var(--success); }
            100% { box-shadow: 0 0 5px var(--success); }
        }
        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes rain-fall {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }
        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        /* Floating Particles */
        .floating-particle {
            position: absolute;
            pointer-events: none;
            font-size: 1.2rem;
            animation: float-up 2s ease-out forwards;
            z-index: 10;
        }
        /* Level-up Effect */
        .level-up-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            text-align: center;
            animation: levelUpPulse 3s ease-out forwards;
            display: none;
        }
        .level-up-text {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(0, 168, 150, 0.5);
            margin-bottom: 1rem;
        }
        .navbar-links.active {
            display: flex;
        }
        .level-up-number {
            font-size: 4rem;
            font-weight: bold;
            color: var(--accent);
            text-shadow: 0 0 20px rgba(231, 111, 81, 0.5);
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confettiFall 3s linear forwards;
        }
        @keyframes levelUpPulse {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }
        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        /* Weather Effects */
        .weather-sunny {
            background: linear-gradient(to bottom, #87ceeb 0%, #98fb98 100%);
        }
        .weather-cloudy {
            background: linear-gradient(to bottom, #b0c4de 0%, #98fb98 100%);
        }
        .weather-rain {
            background: linear-gradient(to bottom, #708090 0%, #98fb98 100%);
            position: relative;
        }
        .weather-rain::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><line x1="50" y1="0" x2="50" y2="100" stroke="rgba(255,255,255,0.5)" stroke-width="0.5"/></svg>') repeat;
            background-size: 20px 100px;
            animation: rain-fall 1s linear infinite;
            pointer-events: none;
        }
        .weather-smog {
            background: linear-gradient(to bottom, #a9a9a9 0%, #98fb98 100%);
            position: relative;
        }
        .weather-smog::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(128, 128, 128, 0.3);
            pointer-events: none;
        }
        /* Footer */
        /* FOOTER STYLES */
    .footer {
      background: linear-gradient(135deg, #0f3d3d, #092929);
      color: #e0f7f5;
      padding: 5rem 2rem 2rem;
      margin-top: 5rem;
      position: relative;
      border-top: 4px solid #00aa7a;
      box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.2);
    }
    
    .footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100px;
      background: linear-gradient(to bottom, rgba(0, 170, 122, 0.25), transparent);
      z-index: 0;
    }
    
    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 3rem;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    
    .footer-logo {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      font-family: 'Montserrat', sans-serif;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #ffffff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .footer-logo i {
      color: #00cc99;
      font-size: 1.8rem;
    }
    
    .footer-about {
      margin-bottom: 2rem;
      line-height: 1.7;
      color: #c4e8e2;
      font-size: 1rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    .footer-links h3, 
    .footer-contact h3 {
      font-size: 1.4rem;
      margin-bottom: 2rem;
      position: relative;
      padding-bottom: 0.8rem;
      font-family: 'Montserrat', sans-serif;
      color: #ffffff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .footer-links h3::after, 
    .footer-contact h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 4px;
      background: linear-gradient(to right, #00aa7a, #00ffaa);
      border-radius: 2px;
      box-shadow: 0 2px 4px rgba(0, 255, 170, 0.3);
    }
    
    .footer-links ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .footer-links li {
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }
    
    .footer-links li:hover {
      transform: translateX(5px);
    }
    
    .footer-links a {
      color: #c4e8e2;
      text-decoration: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    .footer-links a:hover {
      color: #00ffaa;
    }
    
    .footer-links i {
      font-size: 0.9rem;
      color: #00aa7a;
    }
    
    .contact-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 1.5rem;
      gap: 15px;
    }
    
    .contact-icon {
      color: #00cc99;
      font-size: 1.2rem;
      margin-top: 3px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    .contact-item div {
      color: #c4e8e2;
      line-height: 1.5;
      font-size: 1rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .social-links {
      display: flex;
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .social-link {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 45px;
      height: 45px;
      background-color: rgba(0, 204, 153, 0.1);
      border-radius: 50%;
      color: #ffffff;
      transition: all 0.3s ease;
      font-size: 1.2rem;
      border: 1px solid rgba(0, 204, 153, 0.3);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    .social-link:hover {
      background-color: #00cc99;
      transform: translateY(-5px);
      color: #ffffff;
      box-shadow: 0 5px 15px rgba(0, 204, 153, 0.3);
    }
    
    .copyright {
      text-align: center;
      padding-top: 3rem;
      margin-top: 3rem;
      border-top: 1px solid rgba(0, 204, 153, 0.2);
      color: #a0c4bc;
      font-size: 0.9rem;
      position: relative;
      z-index: 1;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .footer-links {
      display: flex;
      flex-direction: column;
    }
    
    /* RESPONSIVE TASARIM */
    @media (max-width: 768px) {
      .footer {
        padding: 3rem 1.5rem 1.5rem;
        border-top-width: 3px;
      }
      
      .footer-container {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      
      .footer-logo {
        font-size: 1.8rem;
        justify-content: center;
      }
      
      .footer-about {
        text-align: center;
      }
      
      .footer-links h3, 
      .footer-contact h3 {
        font-size: 1.3rem;
        margin-bottom: 1.5rem;
        text-align: center;
      }
      
      .footer-links h3::after,
      .footer-contact h3::after {
        left: 50%;
        transform: translateX(-50%);
      }
      
      .footer-links ul {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      
      .social-links {
        justify-content: center;
      }
      
      .contact-item {
        justify-content: center;
      }
      
      
    }
    
    @media (max-width: 480px) {
      .footer {
        padding: 2.5rem 1rem 1.5rem;
      }
      
      .footer-logo {
        font-size: 1.6rem;
      }
      
      .social-link {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
      }
    }
        /* Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }
            
            .navbar-links {
                gap: 0.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.2rem;
            }
            
            .game-container {
                grid-template-columns: 1fr;
            }
            
            .footer-container {
                flex-direction: column;
                text-align: center;
                gap: var(--space-md);
            }
            
            
            .level-indicator {
                top: 80px;
                right: 10px;
                padding: 0.3rem 0.8rem;
                font-size: 0.9rem;
            }
            
            .level-progress {
                width: 70px;
            }
            
            .game-grid {
                grid-template-columns: repeat(12, 1fr); /* Adjusted for mobile */
            }
            
            .resources-panel {
                flex-direction: column;
                align-items: center;
            }
            
            .resource {
                width: 100%;
                justify-content: center;
            }
            
            .building-options {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 480px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .game-grid {
                grid-template-columns: repeat(10, 1fr); /* Adjusted for small mobile */
            }
            
            .building-menu {
                order: 2;
            }
            
            .game-world {
                order: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="{{ url_for('index') }}" class="navbar-logo">
                <i class="fas fa-leaf"></i> Eco Urgent
            </a>
            <div class="navbar-links">
                <a href="{{ url_for('index') }}">
                    <i class="fas fa-home"></i>
                    <span class="tr-text">Ana Sayfa</span>
                    <span class="en-text" style="display:none">Home</span>
                </a>
                <a href="{{ url_for('bilgilendirme') }}">
                    <i class="fas fa-chart-bar"></i>
                    <span class="tr-text">Bilgilendirme</span>
                    <span class="en-text" style="display:none">Information</span>
                </a>
                <a href="{{ url_for('kurbanlar') }}">
                    <i class="fas fa-heart"></i>
                    <span class="tr-text">Kurbanlar</span>
                    <span class="en-text" style="display:none">Victims</span>
                </a>
                <a href="{{ url_for('senin_etkin') }}">
                    <i class="fas fa-flask"></i>
                    <span class="tr-text">Senin Etkin</span>
                    <span class="en-text" style="display:none">Your Impact</span>
                </a>
                <a href="{{ url_for('destek') }}" class="active">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span class="tr-text">Siteyi Destekle</span>
                    <span class="en-text" style="display:none">Support Us</span>
                </a>
            </div>
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1 class="tr-text">klim Deiikliiyle Mcadele</h1>
            <h1 class="en-text" style="display:none">Fight Against Climate Change</h1>
            <p class="tr-text">Geleceimiz iin birlikte hareket edelim. Destek olun, fark yaratalm!</p>
            <p class="en-text" style="display:none">Let's act together for our future. Support us, make a difference!</p>
        </div>
    </section>
    <!-- Language Toggle -->
    <div class="language-toggle">
        <button onclick="GameModule.setLanguage('tr')" class="{{ 'active' if current_lang == 'tr' else '' }}">TR</button>
        <button onclick="GameModule.setLanguage('en')" class="{{ 'active' if current_lang == 'en' else '' }}">EN</button>
    </div>
    <!-- Level Indicator -->
    <div class="level-indicator">
        <span class="tr-text">Seviye</span>
        <span class="en-text" style="display:none">Level</span>
        <span id="levelValue">1</span>
        <div class="level-progress">
            <div class="level-progress-bar" id="levelProgress"></div>
        </div>
    </div>
    <!-- Scenario Selection Modal -->
    <div class="scenario-modal" id="scenarioModal">
        <div class="scenario-content">
            <h2 class="tr-text">Senaryo Sein</h2>
            <h2 class="en-text" style="display:none">Choose Scenario</h2>
            <p class="tr-text">Farkl zorluk seviyelerinde oyun deneyimleri yaayn</p>
            <p class="en-text" style="display:none">Experience different challenge levels</p>
            
            <div class="scenario-options">
                <div class="scenario-option" onclick="GameModule.selectScenario('standard')">
                    <div class="scenario-icon"></div>
                    <div class="scenario-title tr-text">Standart ehir</div>
                    <div class="scenario-title en-text" style="display:none">Standard City</div>
                    <div class="scenario-desc tr-text">Dengeli kaynaklarla balayn</div>
                    <div class="scenario-desc en-text" style="display:none">Start with balanced resources</div>
                </div>
                
                <div class="scenario-option" onclick="GameModule.selectScenario('drought')">
                    <div class="scenario-icon"></div>
                    <div class="scenario-title tr-text">Kuraklk Krizi</div>
                    <div class="scenario-title en-text" style="display:none">Drought Crisis</div>
                    <div class="scenario-desc tr-text">Su kaynaklar kstl</div>
                    <div class="scenario-desc en-text" style="display:none">Limited water resources</div>
                </div>
                
                <div class="scenario-option" onclick="GameModule.selectScenario('polluted')">
                    <div class="scenario-icon"></div>
                    <div class="scenario-title tr-text">Kirli Topraklar</div>
                    <div class="scenario-title en-text" style="display:none">Polluted Lands</div>
                    <div class="scenario-desc tr-text">Yksek karbon ayak izi</div>
                    <div class="scenario-desc en-text" style="display:none">High carbon footprint</div>
                </div>
                
                <div class="scenario-option" onclick="GameModule.selectScenario('flood')">
                    <div class="scenario-icon"></div>
                    <div class="scenario-title tr-text">Sel Sonras</div>
                    <div class="scenario-title en-text" style="display:none">Post-Flood</div>
                    <div class="scenario-desc tr-text">Snrl ina alan</div>
                    <div class="scenario-desc en-text" style="display:none">Limited build area</div>
                </div>
                
                <div class="scenario-option" onclick="GameModule.selectScenario('mountain')">
                    <div class="scenario-icon"></div>
                    <div class="scenario-title tr-text">Dalk Blge</div>
                    <div class="scenario-title en-text" style="display:none">Mountain Region</div>
                    <div class="scenario-desc tr-text">Snrl ina alan, daha zorlu koullar</div>
                    <div class="scenario-desc en-text" style="display:none">Limited build area, more challenging conditions</div>
                </div>
                
                <div class="scenario-option" onclick="GameModule.selectScenario('desert')">
                    <div class="scenario-icon"></div>
                    <div class="scenario-title tr-text">l Blgesi</div>
                    <div class="scenario-title en-text" style="display:none">Desert Region</div>
                    <div class="scenario-desc tr-text">Su kaynaklar ok kstl, zel binalar gerekli</div>
                    <div class="scenario-desc en-text" style="display:none">Very limited water resources, special buildings required</div>
                </div>
            </div>
            
            <button class="scenario-start-btn" id="scenarioStartBtn" onclick="GameModule.startSelectedScenario()" disabled>
                <span class="tr-text">Bala</span>
                <span class="en-text" style="display:none">Start</span>
            </button>
        </div>
    </div>
    <!-- Save/Load Modal -->
    <div class="save-load-modal" id="saveLoadModal">
        <div class="save-load-content">
            <h2 class="tr-text">Oyunu Kaydet/Ykle</h2>
            <h2 class="en-text" style="display:none">Save/Load Game</h2>
            <div class="save-slots">
                <div class="save-slot">
                    <h3 class="tr-text">Slot 1</h3>
                    <h3 class="en-text" style="display:none">Slot 1</h3>
                    <p class="slot-info" id="slot1Info"><span class="tr-text">Bo</span><span class="en-text" style="display:none">Empty</span></p>
                    <div class="slot-buttons">
                        <button class="game-btn" onclick="GameModule.saveGame('slot1')">
                            <span class="tr-text">Kaydet</span>
                            <span class="en-text" style="display:none">Save</span>
                        </button>
                        <button class="game-btn secondary" onclick="GameModule.loadGame('slot1')" id="loadSlot1Btn" disabled>
                            <span class="tr-text">Ykle</span>
                            <span class="en-text" style="display:none">Load</span>
                        </button>
                    </div>
                </div>
                <div class="save-slot">
                    <h3 class="tr-text">Slot 2</h3>
                    <h3 class="en-text" style="display:none">Slot 2</h3>
                    <p class="slot-info" id="slot2Info"><span class="tr-text">Bo</span><span class="en-text" style="display:none">Empty</span></p>
                    <div class="slot-buttons">
                        <button class="game-btn" onclick="GameModule.saveGame('slot2')">
                            <span class="tr-text">Kaydet</span>
                            <span class="en-text" style="display:none">Save</span>
                        </button>
                        <button class="game-btn secondary" onclick="GameModule.loadGame('slot2')" id="loadSlot2Btn" disabled>
                            <span class="tr-text">Ykle</span>
                            <span class="en-text" style="display:none">Load</span>
                        </button>
                    </div>
                </div>
                <div class="save-slot">
                    <h3 class="tr-text">Slot 3</h3>
                    <h3 class="en-text" style="display:none">Slot 3</h3>
                    <p class="slot-info" id="slot3Info"><span class="tr-text">Bo</span><span class="en-text" style="display:none">Empty</span></p>
                    <div class="slot-buttons">
                        <button class="game-btn" onclick="GameModule.saveGame('slot3')">
                            <span class="tr-text">Kaydet</span>
                            <span class="en-text" style="display:none">Save</span>
                        </button>
                        <button class="game-btn secondary" onclick="GameModule.loadGame('slot3')" id="loadSlot3Btn" disabled>
                            <span class="tr-text">Ykle</span>
                            <span class="en-text" style="display:none">Load</span>
                        </button>
                    </div>
                </div>
            </div>
            <button class="game-btn" onclick="GameModule.closeSaveLoadModal()">
                <span class="tr-text">Kapat</span>
                <span class="en-text" style="display:none">Close</span>
            </button>
        </div>
    </div>
    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <div class="tutorial-step active" id="tutorialStep1">
                <h2 class="tr-text">Oyuna Ho Geldiniz!</h2>
                <h2 class="en-text" style="display:none">Welcome to the Game!</h2>
                <p class="tr-text">Eko-ehir kurma oyununda, srdrlebilir bir ehir ina edeceksiniz. Bu eitimde oyunun temel mekaniklerini reneceksiniz.</p>
                <p class="en-text" style="display:none">In the eco-city building game, you will build a sustainable city. In this tutorial, you will learn the basic mechanics of the game.</p>
            </div>
            
            <div class="tutorial-step" id="tutorialStep2">
                <h2 class="tr-text">Senaryo Seimi</h2>
                <h2 class="en-text" style="display:none">Scenario Selection</h2>
                <p class="tr-text">Oyunu balatmak iin bir senaryo semelisiniz. Her senaryonun farkl zorluklar ve balang koullar vardr.</p>
                <p class="en-text" style="display:none">To start the game, you must select a scenario. Each scenario has different difficulties and starting conditions.</p>
            </div>
            
            <div class="tutorial-step" id="tutorialStep3">
                <h2 class="tr-text">Bina na Etme</h2>
                <h2 class="en-text" style="display:none">Building Construction</h2>
                <p class="tr-text">Sadaki menden bir bina sein ve zgara zerinde bir kareye tklayarak ina edin. Her binann maliyeti ve etkileri vardr.</p>
                <p class="en-text" style="display:none">Select a building from the menu on the right and click on a grid tile to build it. Each building has costs and effects.</p>
            </div>
            
            <div class="tutorial-step" id="tutorialStep4">
                <h2 class="tr-text">Kaynak Ynetimi</h2>
                <h2 class="en-text" style="display:none">Resource Management</h2>
                <p class="tr-text">stteki kaynak panelinde paranz, enerjinizi, gdanz ve dier kaynaklarnz grebilirsiniz. Bu kaynaklar dengede tutun.</p>
                <p class="en-text" style="display:none">In the resource panel at the top, you can see your money, energy, food and other resources. Keep these resources balanced.</p>
            </div>
            
            <div class="tutorial-step" id="tutorialStep5">
                <h2 class="tr-text">Grevler</h2>
                <h2 class="en-text" style="display:none">Missions</h2>
                <p class="tr-text">Grev panelinde hedeflerinizi ve dllerinizi grebilirsiniz. Grevleri tamamlayarak ek kaynaklar kazann.</p>
                <p class="en-text" style="display:none">In the mission panel, you can see your objectives and rewards. Complete missions to earn additional resources.</p>
            </div>
            
            <div class="tutorial-navigation">
                <button class="game-btn secondary" onclick="GameModule.previousTutorialStep()">
                    <i class="fas fa-arrow-left"></i>
                    <span class="tr-text">nceki</span>
                    <span class="en-text" style="display:none">Previous</span>
                </button>
                <button class="game-btn" onclick="GameModule.skipTutorial()">
                    <span class="tr-text">Atla</span>
                    <span class="en-text" style="display:none">Skip</span>
                </button>
                <button class="game-btn" id="nextTutorialBtn" onclick="GameModule.nextTutorialStep()">
                    <span class="tr-text">Sonraki</span>
                    <span class="en-text" style="display:none">Next</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup">
        <h3> <span class="tr-text">Baarm Kazandnz!</span><span class="en-text" style="display: none">Achievement Unlocked!</span></h3>
        <p id="achievementText"></p>
        <button class="game-btn" onclick="GameModule.closeAchievement()">
            <span class="tr-text">Tamam</span>
            <span class="en-text" style="display: none">OK</span>
        </button>
    </div>
    <!-- Level-up Effect -->
    <div class="level-up-effect" id="levelUpEffect">
        <div class="level-up-text">
            <span class="tr-text">SEVYE ATLADINIZ!</span>
            <span class="en-text" style="display: none">LEVEL UP!</span>
        </div>
        <div class="level-up-number" id="levelUpNumber">1</div>
    </div>
    <!-- Main Content -->
    <div class="container">
        <!-- Support Section - Enhanced -->
        <div class="support-section animate__animated animate__fadeInUp">
            <div class="support-content">
                <h2 class="support-title">
                    <span class="tr-text">klim Deiikliiyle Mcadeleye Destek Olun</span>
                    <span class="en-text" style="display:none">Support the Fight Against Climate Change</span>
                </h2>
                <p class="support-description">
                    <span class="tr-text">
                        Platformum iklim deiiklii farkndaln artrmak ve srdrlebilir zmler gelitirmek iin alyor. 
                        Bana destek olmak isterseniz, bu siteyi ayakta tutmama ve motive olmama gerekten yardmc olur 
                    </span>
                    <span class="en-text" style="display:none">
                        My platform works to increase climate change awareness and develop sustainable solutions. 
                        If you'd like to support me, it really helps keep the site running and keeps me motivated 
                    </span>
                </p>
                
                <div class="coffee-logo"></div>
                
                <a href="https://buymeacoffee.com/climatehero" class="coffee-button" onclick="GameModule.trackCoffeeClick()">
                    <span class="coffee-icon"></span>
                    <span class="tr-text">Bana Kahve Ismarla</span>
                    <span class="en-text" style="display:none">Buy Me a Coffee</span>
                </a>
                
                <!-- Supporters Section - New -->
                <div class="supporters-section">
                    <div class="supporters-header">
                        <i class="fas fa-users supporters-icon"></i>
                        <h3 class="supporters-title">
                            <span class="tr-text">DESTEKLER</span>
                            <span class="en-text" style="display:none">SUPPORTERS</span>
                        </h3>
                    </div>
                    <div class="supporters-container">
                        <div class="supporters-message">
                            <p class="tr-text">
                                Sitemizi ziyaret ettiiniz iin teekkr ederiz. Projemize olan ilginiz bizim iin ok deerli. 
                                Burada zaman geirerek ve ieriimizi paylaarak bize destek olabilirsiniz.
                            </p>
                            <p class="en-text" style="display:none">
                                Thank you for visiting our site. Your interest in our project is very valuable to us. 
                                You can support us by spending time here and sharing our content.
                            </p>
                            <p class="signature">- Eco Urgent creator</p>
                        </div>
                        
                    </div>
                </div>
                
                <div class="support-options">
                    <div class="support-option">
                        <i class="fas fa-donate"></i>
                        <h3 class="tr-text">Dorudan Destek</h3>
                        <h3 class="en-text" style="display:none">Direct Support</h3>
                        <p class="tr-text">Ba yaparak projelerimize dorudan katk salayn</p>
                        <p class="en-text" style="display:none">Contribute directly to our projects through donations</p>
                    </div>
                    
                    <div class="support-option">
                        <i class="fas fa-clock"></i>
                        <h3 class="tr-text">Zaman Ayr</h3>
                        <h3 class="en-text" style="display:none">Spend Time</h3>
                        <p class="tr-text">Sitede zaman geirerek farkndal artrn</p>
                        <p class="en-text" style="display:none">Increase awareness by spending time on the site</p>
                    </div>
                    
                    <div class="support-option">
                        <i class="fas fa-info-circle"></i>
                        <h3 class="tr-text">Bilgilendirme</h3>
                        <h3 class="en-text" style="display:none">Information</h3>
                        <p class="tr-text">Sitedeki reklamlar sitenin devamll iindir.</p>
                        <p class="en-text" style="display:none">Ads on the site are for the continuity of the site.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- City Builder Game Section -->
        <div class="game-section animate__animated animate__fadeInUp animate__delay-1s">
            <h2 class="game-title">
                <span class="tr-text"> Eko-ehir Kurma Oyunu</span>
                <span class="en-text" style="display: none"> Eco-City Builder Game</span>
            </h2>
            
            <p class="game-description">
                <span class="tr-text">
                    Elenceli ve eitici bu oyunla srdrlebilir bir ehir ina etmeyi renin. 
                    Kaynaklarnz doru yneterek, karbon ayak izinizi azaltn ve ehrinizi gelitirin!
                </span>
                <span class="en-text" style="display: none">
                    Learn to build a sustainable city with this fun and educational game. 
                    Manage your resources correctly, reduce your carbon footprint, and develop your city!
                </span>
            </p>
            
            <div class="game-header">
                <div class="resources-panel">
                    <div class="resource money">
                        <i class="fas fa-coins resource-icon"></i>
                        <span class="resource-value" id="moneyResource">1000</span>
                    </div>
                    <div class="resource energy">
                        <i class="fas fa-bolt resource-icon"></i>
                        <span class="resource-value" id="energyResource">50</span>
                    </div>
                    <div class="resource food">
                        <i class="fas fa-utensils resource-icon"></i>
                        <span class="resource-value" id="foodResource">75</span>
                    </div>
                    <div class="resource population">
                        <i class="fas fa-users resource-icon"></i>
                        <span class="resource-value" id="populationResource">10</span>
                    </div>
                    <div class="resource happiness">
                        <i class="fas fa-smile resource-icon"></i>
                        <span class="resource-value" id="happinessResource">80</span>
                    </div>
                </div>
                
                <div class="missions-panel" id="missionsPanel">
                    <h3 class="tr-text">Grevler</h3>
                    <h3 class="en-text" style="display:none">Missions</h3>
                    <div class="mission-item">
                        <i class="fas fa-tasks mission-icon"></i>
                        <div class="mission-details">
                            <div class="mission-text tr-text">3 Park na Et</div>
                            <div class="mission-text en-text" style="display:none">Build 3 Parks</div>
                            <div class="mission-progress">
                                <div class="mission-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="mission-reward">+200</div>
                    </div>
                </div>
                
                <div class="game-controls">
                    <button class="game-btn" onclick="GameModule.toggleGame()" id="toggleBtn">
                        <i class="fas fa-play"></i>
                        <span class="tr-text">Bala</span>
                        <span class="en-text" style="display: none">Start</span>
                    </button>
                    <button class="game-btn secondary" onclick="GameModule.showSaveLoadModal()">
                        <i class="fas fa-save"></i>
                        <span class="tr-text">Kaydet/Ykle</span>
                        <span class="en-text" style="display: none">Save/Load</span>
                    </button>
                    <button class="game-btn secondary" onclick="GameModule.showTechTree()">
                        <i class="fas fa-microscope"></i>
                        <span class="tr-text">Teknoloji</span>
                        <span class="en-text" style="display: none">Tech</span>
                    </button>
                    <button class="game-btn secondary" onclick="GameModule.showCharts()">
                        <i class="fas fa-chart-line"></i>
                        <span class="tr-text">statistikler</span>
                        <span class="en-text" style="display: none">Stats</span>
                    </button>
                </div>
            </div>
            <div class="game-container">
                <div class="game-world">
                    <div class="environment-overlay smog-overlay" id="smogOverlay"></div>
                    <div class="environment-overlay clean-overlay" id="cleanOverlay"></div>
                    <div class="game-grid" id="gameGrid">
                        <!-- Game tiles will be generated here -->
                    </div>
                </div>
                
                <div class="building-menu">
                    <div class="building-category">
                        <h3 class="tr-text">Aralar</h3>
                        <h3 class="en-text" style="display: none">Tools</h3>
                        <div class="building-options">
                            <div class="building-option" onclick="GameModule.selectTool('destroy')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Yk</div>
                                <div class="building-name en-text" style="display: none">Destroy</div>
                                <div class="building-cost tr-text">Binalar ykar</div>
                                <div class="building-cost en-text" style="display: none">Destroy buildings</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="building-category">
                        <h3 class="tr-text">Konutlar</h3>
                        <h3 class="en-text" style="display: none">Housing</h3>
                        <div class="building-options">
                            <div class="building-option" onclick="GameModule.selectBuilding('house')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Ev</div>
                                <div class="building-name en-text" style="display: none">House</div>
                                <div class="building-cost"> 100</div>
                                <div class="building-tooltip tr-text">+5 Para, +2 Mutluluk<br>-1 Enerji, -1 Gda<br>Karbon: +1</div>
                                <div class="building-tooltip en-text" style="display: none">+5 Money, +2 Happiness<br>-1 Energy, -1 Food<br>Carbon: +1</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('apartment')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Apartman</div>
                                <div class="building-name en-text" style="display: none">Apartment</div>
                                <div class="building-cost"> 500</div>
                                <div class="building-tooltip tr-text">+20 Para, +5 Mutluluk<br>-3 Enerji, -3 Gda<br>Karbon: +2</div>
                                <div class="building-tooltip en-text" style="display: none">+20 Money, +5 Happiness<br>-3 Energy, -3 Food<br>Carbon: +2</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('skyscraper')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Gkdelen</div>
                                <div class="building-name en-text" style="display: none">Skyscraper</div>
                                <div class="building-cost"> 1500</div>
                                <div class="building-tooltip tr-text">+50 Para, +10 Mutluluk<br>-8 Enerji, -5 Gda<br>Karbon: +5</div>
                                <div class="building-tooltip en-text" style="display: none">+50 Money, +10 Happiness<br>-8 Energy, -5 Food<br>Carbon: +5</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="building-category">
                        <h3 class="tr-text">Endstri</h3>
                        <h3 class="en-text" style="display: none">Industry</h3>
                        <div class="building-options">
                            <div class="building-option" onclick="GameModule.selectBuilding('factory')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Fabrika</div>
                                <div class="building-name en-text" style="display: none">Factory</div>
                                <div class="building-cost"> 300</div>
                                <div class="building-tooltip tr-text">+15 Para<br>-5 Enerji, -3 Mutluluk<br>Karbon: +5</div>
                                <div class="building-tooltip en-text" style="display: none">+15 Money<br>-5 Energy, -3 Happiness<br>Carbon: +5</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('solar')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Gne Paneli</div>
                                <div class="building-name en-text" style="display: none">Solar Panel</div>
                                <div class="building-cost"> 400</div>
                                <div class="building-tooltip tr-text">+10 Enerji<br>-2 Para<br>Karbon: -3</div>
                                <div class="building-tooltip en-text" style="display: none">+10 Energy<br>-2 Money<br>Carbon: -3</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('wind')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Rzgar Trbini</div>
                                <div class="building-name en-text" style="display: none">Wind Turbine</div>
                                <div class="building-cost"> 600</div>
                                <div class="building-tooltip tr-text">+15 Enerji<br>-3 Para<br>Karbon: -4</div>
                                <div class="building-tooltip en-text" style="display: none">+15 Energy<br>-3 Money<br>Carbon: -4</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('hydro')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Hidroelektrik</div>
                                <div class="building-name en-text" style="display: none">Hydroelectric</div>
                                <div class="building-cost"> 800</div>
                                <div class="building-tooltip tr-text">+20 Enerji<br>-4 Para<br>Karbon: -5<br>(Sadece su kenarna ina edilebilir)</div>
                                <div class="building-tooltip en-text" style="display: none">+20 Energy<br>-4 Money<br>Carbon: -5<br>(Can only be built near water)</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="building-category">
                        <h3 class="tr-text">Doa</h3>
                        <h3 class="en-text" style="display: none">Nature</h3>
                        <div class="building-options">
                            <div class="building-option" onclick="GameModule.selectBuilding('farm')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">iftlik</div>
                                <div class="building-name en-text" style="display: none">Farm</div>
                                <div class="building-cost"> 200</div>
                                <div class="building-tooltip tr-text">+10 Gda<br>-2 Enerji<br>Karbon: +1</div>
                                <div class="building-tooltip en-text" style="display: none">+10 Food<br>-2 Energy<br>Carbon: +1</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('park')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Park</div>
                                <div class="building-name en-text" style="display: none">Park</div>
                                <div class="building-cost"> 150</div>
                                <div class="building-tooltip tr-text">+5 Mutluluk<br>-1 Para<br>Karbon: -1</div>
                                <div class="building-tooltip en-text" style="display: none">+5 Happiness<br>-1 Money<br>Carbon: -1</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('nursery')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Fidanlk</div>
                                <div class="building-name en-text" style="display: none">Tree Nursery</div>
                                <div class="building-cost"> 250</div>
                                <div class="building-tooltip tr-text">+3 Mutluluk<br>-2 Para<br>Karbon: -2</div>
                                <div class="building-tooltip en-text" style="display: none">+3 Happiness<br>-2 Money<br>Carbon: -2</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('lake')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Gl</div>
                                <div class="building-name en-text" style="display: none">Lake</div>
                                <div class="building-cost"> 300</div>
                                <div class="building-tooltip tr-text">+5 Mutluluk<br>-3 Para<br>Karbon: -2<br>(Sadece l blgelerinde)</div>
                                <div class="building-tooltip en-text" style="display: none">+5 Happiness<br>-3 Money<br>Carbon: -2<br>(Only in desert regions)</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="building-category">
                        <h3 class="tr-text">Hizmetler</h3>
                        <h3 class="en-text" style="display: none">Services</h3>
                        <div class="building-options">
                            <div class="building-option" onclick="GameModule.selectBuilding('hospital')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Hastane</div>
                                <div class="building-name en-text" style="display: none">Hospital</div>
                                <div class="building-cost"> 700</div>
                                <div class="building-tooltip tr-text">+10 Mutluluk<br>-5 Enerji, -3 Para<br>Karbon: +2</div>
                                <div class="building-tooltip en-text" style="display: none">+10 Happiness<br>-5 Energy, -3 Money<br>Carbon: +2</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('school')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Okul</div>
                                <div class="building-name en-text" style="display: none">School</div>
                                <div class="building-cost"> 500</div>
                                <div class="building-tooltip tr-text">+5 Mutluluk, +5 Srdrlebilirlik<br>-3 Enerji, -2 Para<br>Karbon: +1</div>
                                <div class="building-tooltip en-text" style="display: none">+5 Happiness, +5 Sustainability<br>-3 Energy, -2 Money<br>Carbon: +1</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('university')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">niversite</div>
                                <div class="building-name en-text" style="display: none">University</div>
                                <div class="building-cost"> 1200</div>
                                <div class="building-tooltip tr-text">+10 Srdrlebilirlik, +5 Mutluluk<br>-6 Enerji, -4 Para<br>Karbon: +2</div>
                                <div class="building-tooltip en-text" style="display: none">+10 Sustainability, +5 Happiness<br>-6 Energy, -4 Money<br>Carbon: +2</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('market')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Pazar</div>
                                <div class="building-name en-text" style="display: none">Market</div>
                                <div class="building-cost"> 350</div>
                                <div class="building-tooltip tr-text">+5 Gda, +3 Para<br>-2 Enerji<br>Karbon: +1</div>
                                <div class="building-tooltip en-text" style="display: none">+5 Food, +3 Money<br>-2 Energy<br>Carbon: +1</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="building-category">
                        <h3 class="tr-text">Altyap</h3>
                        <h3 class="en-text" style="display: none">Infrastructure</h3>
                        <div class="building-options">
                            <div class="building-option" onclick="GameModule.selectBuilding('road')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Yol</div>
                                <div class="building-name en-text" style="display: none">Road</div>
                                <div class="building-cost"> 50</div>
                                <div class="building-tooltip tr-text">Yakndaki binalarn verimliliini artrr<br>Karbon: +0.5</div>
                                <div class="building-tooltip en-text" style="display: none">Increases efficiency of nearby buildings<br>Carbon: +0.5</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('bridge')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Kpr</div>
                                <div class="building-name en-text" style="display: none">Bridge</div>
                                <div class="building-cost"> 400</div>
                                <div class="building-tooltip tr-text">Su zerinde gei salar<br>+3 Mutluluk<br>Karbon: +1</div>
                                <div class="building-tooltip en-text" style="display: none">Provides passage over water<br>+3 Happiness<br>Carbon: +1</div>
                            </div>
                            <div class="building-option" onclick="GameModule.selectBuilding('tunnel')">
                                <div class="building-icon"></div>
                                <div class="building-name tr-text">Tnel</div>
                                <div class="building-name en-text" style="display: none">Tunnel</div>
                                <div class="building-cost"> 600</div>
                                <div class="building-tooltip tr-text">Dalardan gei salar<br>+5 Mutluluk<br>Karbon: +2<br>(Sadece dalk blgelerde)</div>
                                <div class="building-tooltip en-text" style="display: none">Provides passage through mountains<br>+5 Happiness<br>Carbon: +2<br>(Only in mountain regions)</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-panel">
                        <h3 class="tr-text">ehir statistikleri</h3>
                        <h3 class="en-text" style="display: none">City Stats</h3>
                        <div class="stat-item">
                            <span class="stat-label tr-text">Karbon Ayak zi</span>
                            <span class="stat-label en-text" style="display: none">Carbon Footprint</span>
                            <span class="stat-value" id="carbonStat">50</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label tr-text">Yaanabilirlik</span>
                            <span class="stat-label en-text" style="display: none">Livability</span>
                            <span class="stat-value" id="livabilityStat">75</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label tr-text">Srdrlebilirlik</span>
                            <span class="stat-label en-text" style="display: none">Sustainability</span>
                            <span class="stat-value" id="sustainabilityStat">60</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label tr-text">Toplam Bina</span>
                            <span class="stat-label en-text" style="display: none">Total Buildings</span>
                            <span class="stat-value" id="totalBuildingsStat">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label tr-text">Oyun Sresi</span>
                            <span class="stat-label en-text" style="display: none">Play Time</span>
                            <span class="stat-value" id="playTimeStat">0:00</span>
                        </div>
                    </div>
                    
                    <div class="tech-tree-panel" id="techTreePanel">
                        <h3 class="tr-text">Teknoloji Aac</h3>
                        <h3 class="en-text" style="display: none">Tech Tree</h3>
                        <div class="tech-tree" id="techTree">
                            <!-- Tech items will be added dynamically -->
                        </div>
                    </div>
                    
                    <div class="charts-panel" id="chartsPanel">
                        <h3 class="tr-text">Kaynak Gemii</h3>
                        <h3 class="en-text" style="display: none">Resource History</h3>
                        <div class="chart-container" id="moneyChart"></div>
                        <div class="chart-container" id="energyChart"></div>
                        <div class="chart-container" id="carbonChart"></div>
                    </div>
                </div>
            </div>
            
            <div class="events-panel" id="eventsPanel">
                <h3 class="tr-text">Olaylar</h3>
                <h3 class="en-text" style="display: none">Events</h3>
                <div class="event-item">
                    <span class="tr-text">ehir kuruldu! Haydi gelitirmeye balayalm.</span>
                    <span class="en-text" style="display: none">City founded! Let's start developing.</span>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-about">
                <div class="footer-logo">
                    <i class="fas fa-leaf"></i>
                    <span>Eco Urgent</span>
                </div>
                <p class="footer-about">
                    {% if current_lang == 'tr' %}
                        klim deiiklii ile mcadelede birlikte hareket ediyoruz. Siz de sz verin, geleceimizi birlikte kurtaralm.
                    {% else %}
                        We act together in the fight against climate change. Make your pledge and let's save our future together.
                    {% endif %}
                </p>
            </div>

            <div class="footer-links">
                <h3>
                    {% if current_lang == 'tr' %}
                        Hzl Linkler
                    {% else %}
                        Quick Links
                    {% endif %}
                </h3>
                <ul>
                    <li><a href="{{ url_for('index') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span>{{ t.home }}</span>
                    </a></li>
                    <li><a href="{{ url_for('bilgilendirme') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span>{{ t.info }}</span>
                    </a></li>
                    <li><a href="{{ url_for('kurbanlar') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span>{{ t.victims }}</span>
                    </a></li>
                    <li><a href="{{ url_for('senin_etkin') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span>{{ t.impact_test }}</span>
                    </a></li>
                    <li><a href="{{ url_for('destek') }}">
                        <i class="fas fa-chevron-right"></i>
                        <span class="tr-text">Siteyi Destekle</span>
                        <span class="en-text" style="display: none">Support Us</span>
                    </a></li>
                </ul>
            </div>

            <div class="footer-contact">
                <h3>
                    {% if current_lang == 'tr' %}
                        letiim
                    {% else %}
                        Contact
                    {% endif %}
                </h3>

                <div class="contact-item">
                    <i class="fas fa-map-marker-alt contact-icon"></i>
                    <div>
                        <span>
                            {% if current_lang == 'tr' %}
                                24  Tam Orta Okul
                            {% else %}
                                Fully Secondary School 24
                            {% endif %}
                        </span>
                        <br>
                        <span>
                            {% if current_lang == 'tr' %}
                                Bak, Azerbaycan
                            {% else %}
                                Baku, Azerbaijan
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="contact-item">
                    <i class="fas fa-envelope contact-icon"></i>
                    <div>
                        <span>kaymasali3@gmail.com</span>
                    </div>
                </div>

                <div class="contact-item">
                    <i class="fas fa-phone-alt contact-icon"></i>
                    <div>
                        <span>+994 50 602 29 16</span>
                    </div>
                </div>

                <div class="social-links">
                    <a href="https://instagram.com/mrkaymasfire" class="social-link" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="copyright">
            <p>&copy; 2025 Eco Urgent. 
                {% if current_lang == 'tr' %}
                    Tm haklar sakldr.
                {% else %}
                    All rights reserved.
                {% endif %}
            </p>
            <div style="margin-top: 15px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <a href="{{ url_for('privacy_policy') }}" style="color: #bbb; text-decoration: none; font-size: 0.9rem; transition: color 0.3s ease;">
                    {% if current_lang == 'tr' %}
                        Gizlilik Politikas
                    {% else %}
                        Privacy Policy
                    {% endif %}
                </a>
                <a href="{{ url_for('terms_of_use') }}" style="color: #bbb; text-decoration: none; font-size: 0.9rem; transition: color 0.3s ease;">
                    {% if current_lang == 'tr' %}
                        Kullanm artlar
                    {% else %}
                        Terms of Use
                    {% endif %}
                </a>
            </div>
        </div>
    </footer>
    <script>
        // Game Module
        const GameModule = (function() {
            // Game Variables
            let gameState = {
                isPlaying: false,
                selectedBuilding: null,
                selectedTool: null,
                money: 1000,
                energy: 50,
                food: 75,
                population: 10,
                happiness: 80,
                carbonFootprint: 50,
                livability: 75,
                sustainability: 60,
                buildings: [],
                events: [],
                achievements: [],
                missions: [],
                completedMissions: [],
                techUnlocked: [],
                gameSpeed: 1000, // 1 second
                gameInterval: null,
                lastUpdate: Date.now(),
                weather: 'sunny',
                playTime: 0,
                level: 1,
                xp: 0,
                xpToNextLevel: 100,
                scenario: null,
                selectedScenario: null,
                gridSize: 15, // Increased grid size
                resourceHistory: {
                    money: [],
                    energy: [],
                    food: [],
                    population: [],
                    happiness: [],
                    carbon: [],
                    time: []
                },
                tutorialCompleted: false,
                currentLanguage: "en", // Default to English
                saveSlots: {
                    slot1: null,
                    slot2: null,
                    slot3: null
                },
                riotMode: false // For endless gameplay
            };
            
            // Terrain Types
            const TERRAIN_TYPES = {
                GRASS: 'grass',
                WATER: 'water',
                ROCK: 'rock',
                FOREST: 'forest',
                POLLUTED: 'polluted',
                MOUNTAIN: 'mountain',
                DESERT: 'desert'
            };
            
            // Building Types
            const buildingTypes = {
                house: {
                    name: { tr: 'Ev', en: 'House' },
                    emoji: '',
                    cost: 100,
                    produces: { money: 5, happiness: 2 },
                    consumes: { energy: 1, food: 1 },
                    impact: { carbon: 1, livability: 2, sustainability: -1 },
                    maxLevel: 3,
                    upgradeCost: [150, 200],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { money: 7, happiness: 3 }, consumes: { energy: 1, food: 1 } }, // Level 2
                        { produces: { money: 10, happiness: 5 }, consumes: { energy: 2, food: 2 } } // Level 3
                    ]
                },
                apartment: {
                    name: { tr: 'Apartman', en: 'Apartment' },
                    emoji: '',
                    cost: 500,
                    produces: { money: 20, happiness: 5 },
                    consumes: { energy: 3, food: 3 },
                    impact: { carbon: 2, livability: 5, sustainability: -2 },
                    maxLevel: 3,
                    upgradeCost: [600, 700],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { money: 25, happiness: 7 }, consumes: { energy: 3, food: 3 } }, // Level 2
                        { produces: { money: 30, happiness: 10 }, consumes: { energy: 4, food: 4 } } // Level 3
                    ]
                },
                skyscraper: {
                    name: { tr: 'Gkdelen', en: 'Skyscraper' },
                    emoji: '',
                    cost: 1500,
                    produces: { money: 50, happiness: 10 },
                    consumes: { energy: 8, food: 5 },
                    impact: { carbon: 5, livability: 10, sustainability: -3 },
                    maxLevel: 3,
                    upgradeCost: [1800, 2000],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { money: 60, happiness: 12 }, consumes: { energy: 8, food: 5 } }, // Level 2
                        { produces: { money: 75, happiness: 15 }, consumes: { energy: 10, food: 7 } } // Level 3
                    ],
                    techRequirement: 'urban_planning'
                },
                factory: {
                    name: { tr: 'Fabrika', en: 'Factory' },
                    emoji: '',
                    cost: 300,
                    produces: { money: 15 },
                    consumes: { energy: 5, happiness: 3 },
                    impact: { carbon: 5, livability: -3, sustainability: -4 },
                    maxLevel: 3,
                    upgradeCost: [400, 500],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { money: 20 }, consumes: { energy: 5, happiness: 3 } }, // Level 2
                        { produces: { money: 25 }, consumes: { energy: 5, happiness: 3 } } // Level 3
                    ],
                    techRequirement: 'industrial_tech'
                },
                solar: {
                    name: { tr: 'Gne Paneli', en: 'Solar Panel' },
                    emoji: '',
                    cost: 400,
                    produces: { energy: 10 },
                    consumes: { money: 2 },
                    impact: { carbon: -3, livability: 1, sustainability: 5 },
                    maxLevel: 3,
                    upgradeCost: [500, 600],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { energy: 15 }, consumes: { money: 2 } }, // Level 2
                        { produces: { energy: 20 }, consumes: { money: 2 } } // Level 3
                    ]
                },
                wind: {
                    name: { tr: 'Rzgar Trbini', en: 'Wind Turbine' },
                    emoji: '',
                    cost: 600,
                    produces: { energy: 15 },
                    consumes: { money: 3 },
                    impact: { carbon: -4, livability: 2, sustainability: 6 },
                    maxLevel: 3,
                    upgradeCost: [700, 800],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { energy: 20 }, consumes: { money: 3 } }, // Level 2
                        { produces: { energy: 25 }, consumes: { money: 3 } } // Level 3
                    ],
                    techRequirement: 'renewable_tech'
                },
                hydro: {
                    name: { tr: 'Hidroelektrik', en: 'Hydroelectric' },
                    emoji: '',
                    cost: 800,
                    produces: { energy: 20 },
                    consumes: { money: 4 },
                    impact: { carbon: -5, livability: 3, sustainability: 7 },
                    maxLevel: 3,
                    upgradeCost: [900, 1000],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { energy: 25 }, consumes: { money: 4 } }, // Level 2
                        { produces: { energy: 30 }, consumes: { money: 4 } } // Level 3
                    ],
                    techRequirement: 'renewable_tech',
                    terrainRequirement: 'water'
                },
                farm: {
                    name: { tr: 'iftlik', en: 'Farm' },
                    emoji: '',
                    cost: 200,
                    produces: { food: 10 },
                    consumes: { energy: 2 },
                    impact: { carbon: 1, livability: 2, sustainability: 3 },
                    maxLevel: 3,
                    upgradeCost: [250, 300],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { food: 15 }, consumes: { energy: 2 } }, // Level 2
                        { produces: { food: 20 }, consumes: { energy: 2 } } // Level 3
                    ]
                },
                park: {
                    name: { tr: 'Park', en: 'Park' },
                    emoji: '',
                    cost: 150,
                    produces: { happiness: 5 },
                    consumes: { money: 1 },
                    impact: { carbon: -1, livability: 5, sustainability: 4 },
                    maxLevel: 3,
                    upgradeCost: [200, 250],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { happiness: 8 }, consumes: { money: 1 } }, // Level 2
                        { produces: { happiness: 12 }, consumes: { money: 1 } } // Level 3
                    ]
                },
                nursery: {
                    name: { tr: 'Fidanlk', en: 'Tree Nursery' },
                    emoji: '',
                    cost: 250,
                    produces: { happiness: 3 },
                    consumes: { money: 2 },
                    impact: { carbon: -2, livability: 3, sustainability: 5 },
                    maxLevel: 3,
                    upgradeCost: [300, 350],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { happiness: 5 }, consumes: { money: 2 } }, // Level 2
                        { produces: { happiness: 8 }, consumes: { money: 2 } } // Level 3
                    ]
                },
                lake: {
                    name: { tr: 'Gl', en: 'Lake' },
                    emoji: '',
                    cost: 300,
                    produces: { happiness: 5 },
                    consumes: { money: 3 },
                    impact: { carbon: -2, livability: 7, sustainability: 6 },
                    maxLevel: 3,
                    upgradeCost: [350, 400],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { happiness: 8 }, consumes: { money: 3 } }, // Level 2
                        { produces: { happiness: 12 }, consumes: { money: 3 } } // Level 3
                    ],
                    terrainRequirement: 'desert'
                },
                hospital: {
                    name: { tr: 'Hastane', en: 'Hospital' },
                    emoji: '',
                    cost: 700,
                    produces: { happiness: 10 },
                    consumes: { energy: 5, money: 3 },
                    impact: { carbon: 2, livability: 8, sustainability: 2 },
                    maxLevel: 3,
                    upgradeCost: [800, 900],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { happiness: 15 }, consumes: { energy: 5, money: 3 } }, // Level 2
                        { produces: { happiness: 20 }, consumes: { energy: 5, money: 3 } } // Level 3
                    ],
                    techRequirement: 'health_tech'
                },
                school: {
                    name: { tr: 'Okul', en: 'School' },
                    emoji: '',
                    cost: 500,
                    produces: { happiness: 5, sustainability: 5 },
                    consumes: { energy: 3, money: 2 },
                    impact: { carbon: 1, livability: 5, sustainability: 7 },
                    maxLevel: 3,
                    upgradeCost: [600, 700],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { happiness: 8, sustainability: 8 }, consumes: { energy: 3, money: 2 } }, // Level 2
                        { produces: { happiness: 12, sustainability: 12 }, consumes: { energy: 3, money: 2 } } // Level 3
                    ],
                    techRequirement: 'education_tech'
                },
                university: {
                    name: { tr: 'niversite', en: 'University' },
                    emoji: '',
                    cost: 1200,
                    produces: { sustainability: 10, happiness: 5 },
                    consumes: { energy: 6, money: 4 },
                    impact: { carbon: 2, livability: 7, sustainability: 10 },
                    maxLevel: 3,
                    upgradeCost: [1400, 1600],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { sustainability: 15, happiness: 7 }, consumes: { energy: 6, money: 4 } }, // Level 2
                        { produces: { sustainability: 20, happiness: 10 }, consumes: { energy: 6, money: 4 } } // Level 3
                    ],
                    techRequirement: 'education_tech'
                },
                market: {
                    name: { tr: 'Pazar', en: 'Market' },
                    emoji: '',
                    cost: 350,
                    produces: { food: 5, money: 3 },
                    consumes: { energy: 2 },
                    impact: { carbon: 1, livability: 4, sustainability: 3 },
                    maxLevel: 3,
                    upgradeCost: [400, 450],
                    levelEffects: [
                        {}, // Level 1 (default)
                        { produces: { food: 8, money: 5 }, consumes: { energy: 2 } }, // Level 2
                        { produces: { food: 12, money: 7 }, consumes: { energy: 2 } } // Level 3
                    ]
                },
                road: {
                    name: { tr: 'Yol', en: 'Road' },
                    emoji: '',
                    cost: 50,
                    produces: {},
                    consumes: {},
                    impact: { carbon: 0.5, livability: 1, sustainability: -0.5 },
                    maxLevel: 1,
                    upgradeCost: [],
                    levelEffects: [{}],
                    specialEffect: 'roadEfficiency'
                },
                bridge: {
                    name: { tr: 'Kpr', en: 'Bridge' },
                    emoji: '',
                    cost: 400,
                    produces: { happiness: 3 },
                    consumes: {},
                    impact: { carbon: 1, livability: 5, sustainability: 2 },
                    maxLevel: 1,
                    upgradeCost: [],
                    levelEffects: [{}],
                    terrainRequirement: 'water'
                },
                tunnel: {
                    name: { tr: 'Tnel', en: 'Tunnel' },
                    emoji: '',
                    cost: 600,
                    produces: { happiness: 5 },
                    consumes: {},
                    impact: { carbon: 2, livability: 7, sustainability: 3 },
                    maxLevel: 1,
                    upgradeCost: [],
                    levelEffects: [{}],
                    terrainRequirement: 'mountain'
                }
            };
            
            // Tech Tree
            const techTree = {
                industrial_tech: {
                    name: { tr: 'Endstriyel Teknoloji', en: 'Industrial Tech' },
                    emoji: '',
                    cost: 500,
                    description: { 
                        tr: 'Fabrikalarn verimliliini artrr', 
                        en: 'Improves factory efficiency' 
                    },
                    requirements: [],
                    effect: () => {
                        // Factory upgrades are now available
                        updateBuildingMenu();
                    }
                },
                renewable_tech: {
                    name: { tr: 'Yenilenebilir Enerji', en: 'Renewable Energy' },
                    emoji: '',
                    cost: 600,
                    description: { 
                        tr: 'Rzgar trbinlerinin ve hidroelektrik santrallerin kilidini aar', 
                        en: 'Unlocks wind turbines and hydroelectric plants' 
                    },
                    requirements: [],
                    effect: () => {
                        // Wind turbines and hydro plants are now available
                        updateBuildingMenu();
                    }
                },
                health_tech: {
                    name: { tr: 'Salk Teknolojisi', en: 'Health Tech' },
                    emoji: '',
                    cost: 700,
                    description: { 
                        tr: 'Hastanelerin kilidini aar', 
                        en: 'Unlocks hospitals' 
                    },
                    requirements: ['industrial_tech'],
                    effect: () => {
                        // Hospitals are now available
                        updateBuildingMenu();
                    }
                },
                education_tech: {
                    name: { tr: 'Eitim Teknolojisi', en: 'Education Tech' },
                    emoji: '',
                    cost: 600,
                    description: { 
                        tr: 'Okullarn ve niversitelerin kilidini aar', 
                        en: 'Unlocks schools and universities' 
                    },
                    requirements: [],
                    effect: () => {
                        // Schools and universities are now available
                        updateBuildingMenu();
                    }
                },
                urban_planning: {
                    name: { tr: 'Kentsel Planlama', en: 'Urban Planning' },
                    emoji: '',
                    cost: 800,
                    description: { 
                        tr: 'Gkdelenlerin kilidini aar', 
                        en: 'Unlocks skyscrapers' 
                    },
                    requirements: ['industrial_tech'],
                    effect: () => {
                        // Skyscrapers are now available
                        updateBuildingMenu();
                    }
                },
                advanced_farming: {
                    name: { tr: 'Gelimi Tarm', en: 'Advanced Farming' },
                    emoji: '',
                    cost: 400,
                    description: { 
                        tr: 'iftlikler %25 daha fazla gda retir', 
                        en: 'Farms produce 25% more food' 
                    },
                    requirements: [],
                    effect: () => {
                        // Farms get a production boost
                        addEvent({
                            tr: 'iftlikler artk %25 daha fazla gda retiyor!',
                            en: 'Farms now produce 25% more food!'
                        });
                    }
                },
                water_management: {
                    name: { tr: 'Su Ynetimi', en: 'Water Management' },
                    emoji: '',
                    cost: 500,
                    description: { 
                        tr: 'Gllerin ve kprlerin kilidini aar', 
                        en: 'Unlocks lakes and bridges' 
                    },
                    requirements: [],
                    effect: () => {
                        // Lakes and bridges are now available
                        updateBuildingMenu();
                    }
                },
                mountain_engineering: {
                    name: { tr: 'Da Mhendislii', en: 'Mountain Engineering' },
                    emoji: '',
                    cost: 700,
                    description: { 
                        tr: 'Tnellerin kilidini aar', 
                        en: 'Unlocks tunnels' 
                    },
                    requirements: [],
                    effect: () => {
                        // Tunnels are now available
                        updateBuildingMenu();
                    }
                }
            };
            
            // Scenarios
            const scenarios = {
                standard: {
                    name: { tr: 'Standart ehir', en: 'Standard City' },
                    description: { 
                        tr: 'Dengeli kaynaklarla balayn', 
                        en: 'Start with balanced resources' 
                    },
                    initialResources: {
                        money: 1000,
                        energy: 50,
                        food: 75,
                        population: 10,
                        happiness: 80,
                        carbonFootprint: 50,
                        livability: 75,
                        sustainability: 60
                    },
                    mapModifier: (grid) => {
                        // Standard map - some water tiles
                        for (let i = 0; i < 20; i++) {
                            const randomIndex = Math.floor(Math.random() * 225); // 15x15 grid
                            const tile = grid.children[randomIndex];
                            if (tile.classList.contains('grass')) {
                                tile.className = 'game-tile water';
                                tile.innerHTML = '';
                                tile.dataset.terrain = 'water';
                            }
                        }
                    }
                },
                drought: {
                    name: { tr: 'Kuraklk Krizi', en: 'Drought Crisis' },
                    description: { 
                        tr: 'Su kaynaklar kstl', 
                        en: 'Limited water resources' 
                    },
                    initialResources: {
                        money: 800,
                        energy: 40,
                        food: 40,
                        population: 5,
                        happiness: 70,
                        carbonFootprint: 60,
                        livability: 60,
                        sustainability: 50
                    },
                    mapModifier: (grid) => {
                        // Drought - very little water
                        for (let i = 0; i < 5; i++) {
                            const randomIndex = Math.floor(Math.random() * 225);
                            const tile = grid.children[randomIndex];
                            if (tile.classList.contains('grass')) {
                                tile.className = 'game-tile water';
                                tile.innerHTML = '';
                                tile.dataset.terrain = 'water';
                            }
                        }
                    }
                },
                polluted: {
                    name: { tr: 'Kirli Topraklar', en: 'Polluted Lands' },
                    description: { 
                        tr: 'Yksek karbon ayak izi', 
                        en: 'High carbon footprint' 
                    },
                    initialResources: {
                        money: 1200,
                        energy: 30,
                        food: 60,
                        population: 8,
                        happiness: 60,
                        carbonFootprint: 80,
                        livability: 50,
                        sustainability: 40
                    },
                    mapModifier: (grid) => {
                        // Polluted - some polluted tiles
                        for (let i = 0; i < 30; i++) {
                            const randomIndex = Math.floor(Math.random() * 225);
                            const tile = grid.children[randomIndex];
                            if (tile.classList.contains('grass')) {
                                tile.className = 'game-tile polluted';
                                tile.innerHTML = '';
                                tile.dataset.terrain = 'polluted';
                            }
                        }
                    }
                },
                flood: {
                    name: { tr: 'Sel Sonras', en: 'Post-Flood' },
                    description: { 
                        tr: 'Snrl ina alan', 
                        en: 'Limited build area' 
                    },
                    initialResources: {
                        money: 600,
                        energy: 60,
                        food: 50,
                        population: 6,
                        happiness: 65,
                        carbonFootprint: 40,
                        livability: 65,
                        sustainability: 70
                    },
                    mapModifier: (grid) => {
                        // Flood - lots of water
                        for (let i = 0; i < 60; i++) {
                            const randomIndex = Math.floor(Math.random() * 225);
                            const tile = grid.children[randomIndex];
                            if (tile.classList.contains('grass')) {
                                tile.className = 'game-tile water';
                                tile.innerHTML = '';
                                tile.dataset.terrain = 'water';
                            }
                        }
                    }
                },
                mountain: {
                    name: { tr: 'Dalk Blge', en: 'Mountain Region' },
                    description: { 
                        tr: 'Snrl ina alan, daha zorlu koullar', 
                        en: 'Limited build area, more challenging conditions' 
                    },
                    initialResources: {
                        money: 900,
                        energy: 70,
                        food: 60,
                        population: 7,
                        happiness: 75,
                        carbonFootprint: 30,
                        livability: 65,
                        sustainability: 70
                    },
                    mapModifier: (grid) => {
                        // Mountain region - lots of mountains
                        for (let i = 0; i < 50; i++) {
                            const randomIndex = Math.floor(Math.random() * 225);
                            const tile = grid.children[randomIndex];
                            if (tile.classList.contains('grass')) {
                                tile.className = 'game-tile mountain';
                                tile.innerHTML = '';
                                tile.dataset.terrain = 'mountain';
                            }
                        }
                    }
                },
                desert: {
                    name: { tr: 'l Blgesi', en: 'Desert Region' },
                    description: { 
                        tr: 'Su kaynaklar ok kstl, zel binalar gerekli', 
                        en: 'Very limited water resources, special buildings required' 
                    },
                    initialResources: {
                        money: 1100,
                        energy: 80,
                        food: 30,
                        population: 5,
                        happiness: 60,
                        carbonFootprint: 45,
                        livability: 55,
                        sustainability: 45
                    },
                    mapModifier: (grid) => {
                        // Desert region - lots of desert tiles
                        for (let i = 0; i < 100; i++) {
                            const randomIndex = Math.floor(Math.random() * 225);
                            const tile = grid.children[randomIndex];
                            if (tile.classList.contains('grass')) {
                                tile.className = 'game-tile desert';
                                tile.innerHTML = '';
                                tile.dataset.terrain = 'desert';
                            }
                        }
                    }
                }
            };
            
            // Missions - Increased variety and number
            const missions = [
                {
                    id: 'build_3_parks',
                    title: { tr: '3 Park na Et', en: 'Build 3 Parks' },
                    description: { tr: 'ehrinize 3 park ina edin', en: 'Build 3 parks in your city' },
                    target: 3,
                    current: 0,
                    reward: { money: 200 },
                    type: 'build',
                    buildingType: 'park'
                },
                {
                    id: 'build_5_houses',
                    title: { tr: '5 Ev na Et', en: 'Build 5 Houses' },
                    description: { tr: 'ehrinize 5 ev ina edin', en: 'Build 5 houses in your city' },
                    target: 5,
                    current: 0,
                    reward: { money: 300, happiness: 10 },
                    type: 'build',
                    buildingType: 'house'
                },
                {
                    id: 'build_2_factories',
                    title: { tr: '2 Fabrika na Et', en: 'Build 2 Factories' },
                    description: { tr: 'ehrinize 2 fabrika ina edin', en: 'Build 2 factories in your city' },
                    target: 2,
                    current: 0,
                    reward: { money: 400 },
                    type: 'build',
                    buildingType: 'factory'
                },
                {
                    id: 'build_renewable_energy',
                    title: { tr: 'Yenilenebilir Enerji', en: 'Renewable Energy' },
                    description: { tr: '3 yenilenebilir enerji binas ina edin', en: 'Build 3 renewable energy buildings' },
                    target: 3,
                    current: 0,
                    reward: { energy: 30, sustainability: 15 },
                    type: 'build_multiple',
                    buildingTypes: ['solar', 'wind', 'hydro']
                },
                {
                    id: 'carbon_below_40',
                    title: { tr: 'Karbonu Dk Tut', en: 'Keep Carbon Low' },
                    description: { tr: 'Karbon ayak izini 5 dakika boyunca 40 altnda tut', en: 'Keep carbon footprint below 40 for 5 minutes' },
                    target: 300, // 5 minutes in seconds
                    current: 0,
                    reward: { happiness: 20, sustainability: 10 },
                    type: 'maintain',
                    stat: 'carbonFootprint',
                    threshold: 40
                },
                {
                    id: 'reach_population_50',
                    title: { tr: 'Nfus Art', en: 'Population Growth' },
                    description: { tr: 'Nfusu 50\'ye kar', en: 'Reach population of 50' },
                    target: 50,
                    current: 0,
                    reward: { money: 500, food: 50 },
                    type: 'reach',
                    stat: 'population'
                },
                {
                    id: 'reach_sustainability_70',
                    title: { tr: 'Srdrlebilir ehir', en: 'Sustainable City' },
                    description: { tr: 'Srdrlebilirlii 70\'e kar', en: 'Reach sustainability of 70' },
                    target: 70,
                    current: 0,
                    reward: { sustainability: 10, money: 300 },
                    type: 'reach',
                    stat: 'sustainability'
                },
                {
                    id: 'upgrade_buildings',
                    title: { tr: 'Binalar Gelitir', en: 'Upgrade Buildings' },
                    description: { tr: '5 binay ykselt', en: 'Upgrade 5 buildings' },
                    target: 5,
                    current: 0,
                    reward: { money: 300, energy: 20 },
                    type: 'upgrade'
                },
                {
                    id: 'build_infrastructure',
                    title: { tr: 'Altyap Gelitirme', en: 'Infrastructure Development' },
                    description: { tr: '5 altyap binas ina et', en: 'Build 5 infrastructure buildings' },
                    target: 5,
                    current: 0,
                    reward: { livability: 15, happiness: 10 },
                    type: 'build_multiple',
                    buildingTypes: ['road', 'bridge', 'tunnel']
                },
                {
                    id: 'build_services',
                    title: { tr: 'Hizmet Binalar', en: 'Service Buildings' },
                    description: { tr: '3 hizmet binas ina et', en: 'Build 3 service buildings' },
                    target: 3,
                    current: 0,
                    reward: { happiness: 20, sustainability: 10 },
                    type: 'build_multiple',
                    buildingTypes: ['hospital', 'school', 'university', 'market']
                },
                {
                    id: 'build_nature',
                    title: { tr: 'Doa Dostu ehir', en: 'Eco-Friendly City' },
                    description: { tr: '7 doa binas ina et', en: 'Build 7 nature buildings' },
                    target: 7,
                    current: 0,
                    reward: { sustainability: 20, happiness: 15 },
                    type: 'build_multiple',
                    buildingTypes: ['park', 'nursery', 'farm', 'lake']
                },
                {
                    id: 'research_all_tech',
                    title: { tr: 'Teknoloji Ustas', en: 'Tech Master' },
                    description: { tr: 'Tm teknolojileri aratr', en: 'Research all technologies' },
                    target: Object.keys(techTree).length,
                    current: 0,
                    reward: { sustainability: 30, money: 1000 },
                    type: 'research'
                },
                {
                    id: 'happiness_above_80',
                    title: { tr: 'Mutlu ehir', en: 'Happy City' },
                    description: { tr: 'Mutluluk seviyesini 80\'in zerinde tut', en: 'Keep happiness above 80' },
                    target: 300, // 5 minutes in seconds
                    current: 0,
                    reward: { population: 20, money: 400 },
                    type: 'maintain',
                    stat: 'happiness',
                    threshold: 80
                }
            ];
            
            // Random Events
            const randomEvents = [
                {
                    id: 'heat_wave',
                    title: { tr: 'Scak Hava Dalgas', en: 'Heat Wave' },
                    message: { 
                        tr: 'Scak hava dalgas! Enerji tketimi artt.', 
                        en: 'Heat wave! Energy consumption increased.' 
                    },
                    effect: () => {
                        gameState.energy *= 0.9;
                        playSound('warning');
                    },
                    type: 'warning'
                },
                {
                    id: 'festival',
                    title: { tr: 'ehir Festivali', en: 'City Festival' },
                    message: { 
                        tr: 'ehir festivali! Mutluluk artt.', 
                        en: 'City festival! Happiness increased.' 
                    },
                    effect: () => {
                        gameState.happiness = Math.min(100, gameState.happiness + 10);
                        playSound('success');
                    },
                    type: 'success'
                },
                {
                    id: 'recession',
                    title: { tr: 'Ekonomik Durgunluk', en: 'Economic Recession' },
                    message: { 
                        tr: 'Ekonomik durgunluk! Gelirler azald.', 
                        en: 'Economic recession! Income decreased.' 
                    },
                    effect: () => {
                        gameState.money *= 0.8;
                        playSound('warning');
                    },
                    type: 'danger'
                },
                {
                    id: 'innovation',
                    title: { tr: 'Yeniliki Fikirler', en: 'Innovative Ideas' },
                    message: { 
                        tr: 'Yeniliki fikirler! Srdrlebilirlik artt.', 
                        en: 'Innovative ideas! Sustainability increased.' 
                    },
                    effect: () => {
                        gameState.sustainability = Math.min(100, gameState.sustainability + 5);
                        playSound('success');
                    },
                    type: 'success'
                },
                {
                    id: 'rain',
                    title: { tr: 'Yamur', en: 'Rain' },
                    message: { 
                        tr: 'Yamur yayor! Su kaynaklar doldu.', 
                        en: 'It\'s raining! Water resources replenished.' 
                    },
                    effect: () => {
                        // Convert some grass tiles to water
                        const grid = document.getElementById('gameGrid');
                        for (let i = 0; i < 5; i++) {
                            const randomIndex = Math.floor(Math.random() * 225);
                            const tile = grid.children[randomIndex];
                            if (tile.classList.contains('grass')) {
                                tile.className = 'game-tile water';
                                tile.innerHTML = '';
                                tile.dataset.terrain = 'water';
                            }
                        }
                        playSound('ambient');
                    },
                    type: 'neutral'
                },
                {
                    id: 'riot',
                    title: { tr: 'Huzursuzluk', en: 'Unrest' },
                    message: { 
                        tr: 'Mutluluk seviyesi ok dt! Huzursuzluk ba gsteriyor.', 
                        en: 'Happiness level is too low! Unrest is brewing.' 
                    },
                    effect: () => {
                        gameState.riotMode = true;
                        gameState.money *= 0.7;
                        gameState.happiness = Math.max(0, gameState.happiness - 20);
                        playSound('danger');
                    },
                    type: 'danger',
                    condition: () => gameState.happiness < 30
                }
            ];
            
            // Decisions
            const decisions = [
                {
                    id: 'foreign_investment',
                    title: { tr: 'Yabanc Yatrm', en: 'Foreign Investment' },
                    text: { 
                        tr: 'Bir yabanc irket ehrinize byk bir fabrika kurmay teklif ediyor. Bu i frsatn kabul ediyor musunuz?', 
                        en: 'A foreign company offers to build a large factory in your city. Do you accept this business opportunity?' 
                    },
                    options: [
                        {
                            text: { tr: 'Evet', en: 'Yes' },
                            type: 'positive',
                            effects: { 
                                money: 1000, 
                                carbonFootprint: 15,
                                happiness: -10 
                            },
                            message: { 
                                tr: 'Fabrika ina edildi. Ekonomi canland ama evre zarar grd.', 
                                en: 'Factory built. Economy boosted but environment suffered.' 
                            }
                        },
                        {
                            text: { tr: 'Hayr', en: 'No' },
                            type: 'negative',
                            effects: { 
                                happiness: 5,
                                sustainability: 5 
                            },
                            message: { 
                                tr: 'Teklifi reddettiniz. Vatandalar kararnzdan memnun.', 
                                en: 'You declined the offer. Citizens are happy with your decision.' 
                            }
                        }
                    ]
                },
                {
                    id: 'renewable_subsidy',
                    title: { tr: 'Yenilenebilir Enerji Sbvansiyonu', en: 'Renewable Energy Subsidy' },
                    text: { 
                        tr: 'Yenilenebilir enerji kaynaklarna sbvansiyon salamak ister misiniz? Bu enerji retimini artracak ama bteye yk olacak.', 
                        en: 'Do you want to subsidize renewable energy sources? This will increase energy production but strain the budget.' 
                    },
                    options: [
                        {
                            text: { tr: 'Evet', en: 'Yes' },
                            type: 'positive',
                            effects: { 
                                energy: 50, 
                                money: -300,
                                sustainability: 10 
                            },
                            message: { 
                                tr: 'Yenilenebilir enerji tevik edildi. Uzun vadede faydal olacak.', 
                                en: 'Renewable energy promoted. Will be beneficial in the long term.' 
                            }
                        },
                        {
                            text: { tr: 'Hayr', en: 'No' },
                            type: 'negative',
                            effects: { 
                                money: 100,
                                carbonFootprint: 5 
                            },
                            message: { 
                                tr: 'Sbvansiyon reddedildi. Ksa vadede bte rahatlad.', 
                                en: 'Subsidy declined. Budget relieved in short term.' 
                            }
                        }
                    ]
                }
            ];
            
            // Achievements
            const achievements = [
                {
                    id: 'first_building',
                    title: { tr: 'lk Bina!', en: 'First Building!' },
                    description: { tr: 'lk binanz ina ettiniz', en: 'You built your first building' },
                    condition: () => gameState.buildings.length === 1,
                    reward: { xp: 50 }
                },
                {
                    id: 'eco_city',
                    title: { tr: 'Eko-ehir!', en: 'Eco-City!' },
                    description: { tr: 'Srdrlebilirlik 80+ oldu', en: 'Sustainability reached 80+' },
                    condition: () => gameState.sustainability >= 80,
                    reward: { xp: 100 }
                },
                {
                    id: 'happy_city',
                    title: { tr: 'Mutlu ehir!', en: 'Happy City!' },
                    description: { tr: 'Mutluluk 90+ oldu', en: 'Happiness reached 90+' },
                    condition: () => gameState.happiness >= 90,
                    reward: { xp: 100 }
                },
                {
                    id: 'level_5',
                    title: { tr: 'Seviye 5!', en: 'Level 5!' },
                    description: { tr: '5. seviyeye ulatnz', en: 'You reached level 5' },
                    condition: () => gameState.level >= 5,
                    reward: { xp: 200 }
                },
                {
                    id: 'master_builder',
                    title: { tr: 'Usta naat!', en: 'Master Builder!' },
                    description: { tr: '30+ bina ina ettiniz', en: 'You built 30+ buildings' },
                    condition: () => gameState.buildings.length >= 30,
                    reward: { xp: 150 }
                },
                {
                    id: 'tech_master',
                    title: { tr: 'Teknoloji Ustas!', en: 'Tech Master!' },
                    description: { tr: 'Tm teknolojileri aratrdnz', en: 'You researched all technologies' },
                    condition: () => gameState.techUnlocked.length === Object.keys(techTree).length,
                    reward: { xp: 300 }
                },
                {
                    id: 'mission_master',
                    title: { tr: 'Grev Ustas!', en: 'Mission Master!' },
                    description: { tr: 'Tm grevleri tamamladnz', en: 'You completed all missions' },
                    condition: () => gameState.completedMissions.length >= missions.length,
                    reward: { xp: 400 }
                },
                {
                    id: 'riot_ender',
                    title: { tr: 'Bar Getiren!', en: 'Peace Bringer!' },
                    description: { tr: 'Huzursuzluu sona erdirdiniz', en: 'You ended the unrest' },
                    condition: () => gameState.riotMode === false && gameState.happiness > 70,
                    reward: { xp: 250 }
                }
            ];
            
            // Tutorial Steps
            const tutorialSteps = [
                {
                    id: 'start',
                    element: '#toggleBtn',
                    title: { tr: 'Oyunu Balatn', en: 'Start the Game' },
                    content: { 
                        tr: 'Oyunu balatmak iin Bala dmesine tklayn. Bir senaryo semeniz istenecektir.', 
                        en: 'Click the Start button to begin the game. You will be asked to select a scenario.' 
                    }
                },
                {
                    id: 'scenario',
                    element: '#scenarioModal',
                    title: { tr: 'Senaryo Seimi', en: 'Scenario Selection' },
                    content: { 
                        tr: 'Farkl zorluk seviyelerine sahip senaryolardan birini sein. Her senaryonun farkl balang koullar vardr.', 
                        en: 'Select one of the scenarios with different difficulty levels. Each scenario has different starting conditions.' 
                    }
                },
                {
                    id: 'buildings',
                    element: '.building-menu',
                    title: { tr: 'Bina Mens', en: 'Building Menu' },
                    content: { 
                        tr: 'Sadaki menden ina etmek istediiniz binay sein. Her binann maliyeti ve etkileri vardr.', 
                        en: 'Select the building you want to construct from the menu on the right. Each building has costs and effects.' 
                    }
                },
                {
                    id: 'resources',
                    element: '.resources-panel',
                    title: { tr: 'Kaynaklar', en: 'Resources' },
                    content: { 
                        tr: 'stteki kaynak panelinde paranz, enerjinizi, gdanz ve dier kaynaklarnz grebilirsiniz. Bu kaynaklar dengede tutun.', 
                        en: 'In the resource panel at the top, you can see your money, energy, food and other resources. Keep these resources balanced.' 
                    }
                },
                {
                    id: 'missions',
                    element: '.missions-panel',
                    title: { tr: 'Grevler', en: 'Missions' },
                    content: { 
                        tr: 'Grev panelinde hedeflerinizi ve dllerinizi grebilirsiniz. Grevleri tamamlayarak ek kaynaklar kazann.', 
                        en: 'In the mission panel, you can see your objectives and rewards. Complete missions to earn additional resources.' 
                    }
                }
            ];
            
            // Initialize Game
            function initGame() {
                // Initialize language
                updateLanguageContent();
                
                // Initialize missions
                gameState.missions = [...missions];
                updateMissionsDisplay();
                
                // Initialize resource history
                Object.keys(gameState.resourceHistory).forEach(key => {
                    gameState.resourceHistory[key] = [];
                });
                
                // Create grid
                createGrid();
                
                // Check for saved games
                updateSaveSlots();
            }
            
            // Tutorial Functions
            let currentTutorialStep = 0;
            
            function showTutorial() {
                document.getElementById('tutorialOverlay').style.display = 'flex';
                currentTutorialStep = 0;
                showTutorialStep(currentTutorialStep);
            }
            
            function showTutorialStep(stepIndex) {
                // Hide all steps
                document.querySelectorAll('.tutorial-step').forEach(step => {
                    step.classList.remove('active');
                });
                
                // Show current step
                document.getElementById(`tutorialStep${stepIndex + 1}`).classList.add('active');
                
                // Update navigation buttons
                document.getElementById('nextTutorialBtn').style.display = 
                    stepIndex < tutorialSteps.length - 1 ? 'flex' : 'none';
                
                // Highlight element if exists
                if (tutorialSteps[stepIndex].element) {
                    highlightElement(tutorialSteps[stepIndex].element);
                }
            }
            
            function highlightElement(selector) {
                // Remove existing highlights
                document.querySelectorAll('.tutorial-highlight').forEach(el => el.remove());
                
                // Add new highlight
                const element = document.querySelector(selector);
                if (element) {
                    const rect = element.getBoundingClientRect();
                    const highlight = document.createElement('div');
                    highlight.className = 'tutorial-highlight';
                    highlight.style.left = `${rect.left - 5}px`;
                    highlight.style.top = `${rect.top - 5}px`;
                    highlight.style.width = `${rect.width + 10}px`;
                    highlight.style.height = `${rect.height + 10}px`;
                    document.body.appendChild(highlight);
                }
            }
            
            function nextTutorialStep() {
                if (currentTutorialStep < tutorialSteps.length - 1) {
                    currentTutorialStep++;
                    showTutorialStep(currentTutorialStep);
                }
            }
            
            function previousTutorialStep() {
                if (currentTutorialStep > 0) {
                    currentTutorialStep--;
                    showTutorialStep(currentTutorialStep);
                }
            }
            
            function skipTutorial() {
                document.getElementById('tutorialOverlay').style.display = 'none';
                document.querySelectorAll('.tutorial-highlight').forEach(el => el.remove());
                gameState.tutorialCompleted = true;
            }
            
            // Scenario Selection
            function selectScenario(scenarioId) {
                gameState.selectedScenario = scenarioId;
                document.querySelectorAll('.scenario-option').forEach(option => {
                    option.classList.remove('selected');
                });
                document.querySelector(`.scenario-option[onclick="GameModule.selectScenario('${scenarioId}')"]`).classList.add('selected');
                
                // Enable start button
                document.getElementById('scenarioStartBtn').disabled = false;
            }
            
            function startSelectedScenario() {
                if (!gameState.selectedScenario) {
                    const isTurkish = gameState.currentLanguage === 'tr';
                    addEvent(isTurkish ? 'Ltfen bir senaryo sein!' : 'Please select a scenario!');
                    return;
                }
                
                // Initialize game data
                initializeGameData(gameState.selectedScenario);
                
                const scenario = scenarios[gameState.selectedScenario];
                
                // Create grid with scenario modifications
                createGrid();
                scenario.mapModifier(document.getElementById('gameGrid'));
                
                // Close modal
                document.getElementById('scenarioModal').style.display = 'none';
                
                // Add initial event
                addEvent(getMessage('city_founded'));
                addEvent({
                    tr: `${scenario.name.tr} senaryosu balad!`,
                    en: `${scenario.name.en} scenario started!`
                });
                
                // Now start the game
                gameState.isPlaying = true;
                const toggleBtn = document.getElementById('toggleBtn');
                toggleBtn.innerHTML = '<i class="fas fa-pause"></i> <span class="tr-text">Duraklat</span><span class="en-text" style="display: none">Pause</span>';
                startGameLoop();
                addEvent(getMessage('game_started'));
                
                updateDisplay();
            }
            
            function initializeGameData(scenarioId) {
                const scenario = scenarios[scenarioId];
                
                // Reset game state but keep some persistent data (like achievements, level, etc.)
                const persistentData = {
                    achievements: gameState.achievements,
                    level: gameState.level,
                    xp: gameState.xp,
                    xpToNextLevel: gameState.xpToNextLevel,
                    tutorialCompleted: gameState.tutorialCompleted,
                    currentLanguage: gameState.currentLanguage,
                    saveSlots: gameState.saveSlots
                };
                
                // Reset game state
                gameState = {
                    ...gameState,
                    isPlaying: false,
                    selectedBuilding: null,
                    selectedTool: null,
                    buildings: [],
                    events: [],
                    missions: [...missions],
                    completedMissions: [],
                    techUnlocked: [],
                    gameSpeed: 1000,
                    gameInterval: null,
                    lastUpdate: Date.now(),
                    weather: 'sunny',
                    playTime: 0,
                    scenario: scenarioId,
                    selectedScenario: scenarioId,
                    gridSize: 15,
                    resourceHistory: {
                        money: [],
                        energy: [],
                        food: [],
                        population: [],
                        happiness: [],
                        carbon: [],
                        time: []
                    },
                    riotMode: false,
                    ...persistentData
                };
                
                // Set initial resources from scenario
                Object.keys(scenario.initialResources).forEach(key => {
                    gameState[key] = scenario.initialResources[key];
                });
            }
            
            // Grid Functions
            function createGrid() {
                const grid = document.getElementById('gameGrid');
                grid.innerHTML = '';
                
                // Determine grid size based on screen size
                const isMobile = window.innerWidth <= 768;
                const gridSize = isMobile ? 12 : 15; // Increased grid size
                gameState.gridSize = gridSize;
                grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
                
                // Terrain types
                const terrainTypes = [
                    { type: 'grass', weight: 0.6, emoji: '' },
                    { type: 'water', weight: 0.1, emoji: '' },
                    { type: 'rock', weight: 0.05, emoji: '' },
                    { type: 'forest', weight: 0.15, emoji: '' },
                    { type: 'mountain', weight: 0.05, emoji: '' },
                    { type: 'desert', weight: 0.05, emoji: '' }
                ];
                
                // Generate terrain based on weights
                function getRandomTerrain() {
                    const random = Math.random();
                    let cumulativeWeight = 0;
                    
                    for (const terrain of terrainTypes) {
                        cumulativeWeight += terrain.weight;
                        if (random < cumulativeWeight) {
                            return terrain;
                        }
                    }
                    
                    return terrainTypes[0]; // Default to grass
                }
                
                for (let i = 0; i < gridSize * gridSize; i++) {
                    const tile = document.createElement('div');
                    const terrain = getRandomTerrain();
                    
                    tile.className = `game-tile ${terrain.type}`;
                    tile.dataset.index = i;
                    tile.dataset.terrain = terrain.type;
                    tile.addEventListener('click', () => handleTileClick(i));
                    tile.addEventListener('dblclick', () => handleTileDoubleClick(i)); // Added double-click event
                    tile.innerHTML = terrain.emoji;
                    
                    // Add special animations for water
                    if (terrain.type === 'water') {
                        tile.style.animation = 'wave 3s ease-in-out infinite';
                    }
                    
                    grid.appendChild(tile);
                }
            }
            
            function handleTileClick(index) {
                if (!gameState.isPlaying) return;
                
                // Handle destroy tool
                if (gameState.selectedTool === 'destroy') {
                    // Find building at this position
                    const buildingIndex = gameState.buildings.findIndex(b => b.position === index);
                    if (buildingIndex !== -1) {
                        const building = gameState.buildings[buildingIndex];
                        const buildingType = buildingTypes[building.type];
                        
                        // Remove building
                        gameState.buildings.splice(buildingIndex, 1);
                        
                        // Update tile
                        const grid = document.getElementById('gameGrid');
                        const tile = grid.children[index];
                        tile.className = 'game-tile grass';
                        tile.innerHTML = '';
                        tile.dataset.terrain = 'grass';
                        
                        // Play sound
                        playSound('destroy');
                        
                        // Add event
                        const isTurkish = gameState.currentLanguage === 'tr';
                        addEvent({
                            tr: `${buildingType.name.tr} ykld!`,
                            en: `${buildingType.name.en} destroyed!`
                        });
                        
                        updateDisplay();
                    }
                    return;
                }
                
                if (!gameState.selectedBuilding) return;
                
                const grid = document.getElementById('gameGrid');
                const tile = grid.children[index];
                const terrain = tile.dataset.terrain;
                
                // Check if tile is buildable
                if (terrain === 'water' || terrain === 'rock' || terrain === 'mountain') {
                    // Some buildings can be built on specific terrains
                    const buildingType = gameState.selectedBuilding;
                    const building = buildingTypes[buildingType];
                    
                    if (building.terrainRequirement === terrain) {
                        // This building can be built on this terrain
                    } else {
                        const isTurkish = gameState.currentLanguage === 'tr';
                        addEvent(isTurkish ? 
                            'Bu araziye bina ina edemezsiniz!' : 
                            'You cannot build on this terrain!');
                        return;
                    }
                }
                
                // Check if there's already a building here
                const existingBuilding = gameState.buildings.find(b => b.position === index);
                if (existingBuilding) {
                    showUpgradePrompt(existingBuilding, index);
                    return;
                }
                
                const buildingType = gameState.selectedBuilding;
                const building = buildingTypes[buildingType];
                
                // Check tech requirements
                if (building.techRequirement && !gameState.techUnlocked.includes(building.techRequirement)) {
                    const isTurkish = gameState.currentLanguage === 'tr';
                    addEvent({
                        tr: `Bu binay ina etmek iin ${techTree[building.techRequirement].name.tr} teknolojisini aratrmanz gerekiyor!`,
                        en: `You need to research ${techTree[building.techRequirement].name.en} tech to build this!`
                    });
                    return;
                }
                
                if (gameState.money < building.cost) {
                    addEvent(getMessage('not_enough_money'));
                    return;
                }
                
                // Build the structure
                gameState.money -= building.cost;
                gameState.buildings.push({
                    type: buildingType,
                    position: index,
                    level: 1
                });
                
                // Update tile appearance
                tile.className = `game-tile ${buildingType}`;
                tile.innerHTML = building.emoji;
                tile.innerHTML += `<span class="building-level">1</span>`;
                
                // Play building sound
                playSound('build');
                
                // Add floating particle
                showFloatingParticle(tile, `-${building.cost}`);
                
                // Add event
                addEvent(getMessage('built_' + buildingType, { name: building.name }));
                
                // Update missions
                updateMissionProgress('build', buildingType);
                
                // Check for achievements
                checkAchievements();
                
                updateDisplay();
            }
            
            function handleTileDoubleClick(index) {
                // Handle double-click for automatic leveling up
                if (!gameState.isPlaying) return;
                
                // Find building at this position
                const buildingIndex = gameState.buildings.findIndex(b => b.position === index);
                if (buildingIndex !== -1) {
                    const building = gameState.buildings[buildingIndex];
                    upgradeBuilding(building, index);
                }
            }
            
            function showUpgradePrompt(building, index) {
                const buildingType = buildingTypes[building.type];
                if (building.level >= buildingType.maxLevel) {
                    const isTurkish = gameState.currentLanguage === 'tr';
                    addEvent({
                        tr: `Bu bina maksimum seviyede (${buildingType.maxLevel})!`,
                        en: `This building is at max level (${buildingType.maxLevel})!`
                    });
                    return;
                }
                
                const upgradeCost = buildingType.upgradeCost[building.level - 1];
                if (gameState.money < upgradeCost) {
                    addEvent(getMessage('not_enough_money'));
                    return;
                }
                
                const isTurkish = gameState.currentLanguage === 'tr';
                const confirmUpgrade = confirm(
                    isTurkish 
                        ? `${buildingType.name.tr} ykseltmek ${upgradeCost} tutacak. Onaylyor musunuz?` 
                        : `Upgrade ${buildingType.name.en} for ${upgradeCost}?`
                );
                
                if (confirmUpgrade) {
                    upgradeBuilding(building, index, upgradeCost);
                }
            }
            
            function upgradeBuilding(building, index, cost) {
                const buildingType = buildingTypes[building.type];
                
                if (building.level >= buildingType.maxLevel) {
                    const isTurkish = gameState.currentLanguage === 'tr';
                    addEvent({
                        tr: `Bu bina maksimum seviyede (${buildingType.maxLevel})!`,
                        en: `This building is at max level (${buildingType.maxLevel})!`
                    });
                    return;
                }
                
                const upgradeCost = cost || buildingType.upgradeCost[building.level - 1];
                if (gameState.money < upgradeCost) {
                    addEvent(getMessage('not_enough_money'));
                    return;
                }
                
                gameState.money -= upgradeCost;
                building.level += 1;
                
                const grid = document.getElementById('gameGrid');
                const tile = grid.children[index];
                tile.innerHTML = buildingType.emoji;
                tile.innerHTML += `<span class="building-level">${building.level}</span>`;
                
                // Play upgrade sound
                playSound('upgrade');
                
                // Add floating particle
                showFloatingParticle(tile, `-${upgradeCost}`);
                
                // Add upgrade effect
                const effect = document.createElement('div');
                effect.className = 'upgrade-effect';
                tile.appendChild(effect);
                
                setTimeout(() => {
                    effect.remove();
                }, 1000);
                
                // Add event
                const isTurkish = gameState.currentLanguage === 'tr';
                addEvent({
                    tr: `${buildingType.name.tr} seviye ${building.level} ykseltildi!`,
                    en: `${buildingType.name.en} upgraded to level ${building.level}!`
                });
                
                // Update missions
                updateMissionProgress('upgrade');
                
                updateDisplay();
            }
            
            function selectBuilding(type) {
                gameState.selectedBuilding = type;
                gameState.selectedTool = null;
                
                // Update UI
                document.querySelectorAll('.building-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                document.querySelector(`.building-option[onclick="GameModule.selectBuilding('${type}')"]`).classList.add('selected');
                
                addEvent(getMessage('selected_' + type, { name: buildingTypes[type].name }));
            }
            
            function selectTool(tool) {
                gameState.selectedTool = tool;
                gameState.selectedBuilding = null;
                
                // Update UI
                document.querySelectorAll('.building-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                document.querySelector(`.building-option[onclick="GameModule.selectTool('${tool}')"]`).classList.add('selected');
                
                addEvent(getMessage('selected_tool', { tool: tool }));
            }
            
            // Game Loop
            function startGameLoop() {
                if (gameState.gameInterval) clearInterval(gameState.gameInterval);
                
                gameState.gameInterval = setInterval(() => {
                    updateGame();
                }, gameState.gameSpeed);
                
                gameState.lastUpdate = Date.now();
            }
            
            function stopGameLoop() {
                if (gameState.gameInterval) {
                    clearInterval(gameState.gameInterval);
                    gameState.gameInterval = null;
                }
            }
            
            function updateGame() {
                const now = Date.now();
                const deltaTime = (now - gameState.lastUpdate) / 1000; // in seconds
                gameState.lastUpdate = now;
                
                // Update play time
                gameState.playTime += deltaTime;
                
                // Calculate difficulty scaling based on play time
                const difficultyMultiplier = 1 + (gameState.playTime / 600); // Increase difficulty every 10 minutes
                
                // Store previous resource values for animation
                const prevResources = {
                    money: gameState.money,
                    energy: gameState.energy,
                    food: gameState.food,
                    population: gameState.population,
                    happiness: gameState.happiness
                };
                
                // Process each building
                gameState.buildings.forEach(building => {
                    const type = buildingTypes[building.type];
                    const levelMultiplier = 1 + (building.level - 1) * 0.5; // 50% boost per level
                    
                    // Add resources
                    if (type.produces) {
                        for (const [resource, amount] of Object.entries(type.produces)) {
                            // Apply level effects if available
                            let adjustedAmount = amount;
                            if (type.levelEffects && type.levelEffects[building.level - 1] && type.levelEffects[building.level - 1].produces && type.levelEffects[building.level - 1].produces[resource]) {
                                adjustedAmount = type.levelEffects[building.level - 1].produces[resource];
                            }
                            
                            gameState[resource] += adjustedAmount * levelMultiplier * deltaTime;
                        }
                    }
                    
                    // Consume resources
                    if (type.consumes) {
                        for (const [resource, amount] of Object.entries(type.consumes)) {
                            // Apply level effects if available
                            let adjustedAmount = amount;
                            if (type.levelEffects && type.levelEffects[building.level - 1] && type.levelEffects[building.level - 1].consumes && type.levelEffects[building.level - 1].consumes[resource]) {
                                adjustedAmount = type.levelEffects[building.level - 1].consumes[resource];
                            }
                            
                            gameState[resource] = Math.max(0, gameState[resource] - adjustedAmount * levelMultiplier * deltaTime * difficultyMultiplier);
                        }
                    }
                    
                    // Apply special effects
                    if (type.specialEffect === 'roadEfficiency') {
                        // Roads increase efficiency of nearby buildings
                        const grid = document.getElementById('gameGrid');
                        const gridSize = gameState.gridSize;
                        const row = Math.floor(building.position / gridSize);
                        const col = building.position % gridSize;
                        
                        // Check adjacent tiles
                        for (let r = Math.max(0, row - 1); r <= Math.min(gridSize - 1, row + 1); r++) {
                            for (let c = Math.max(0, col - 1); c <= Math.min(gridSize - 1, col + 1); c++) {
                                const adjacentIndex = r * gridSize + c;
                                if (adjacentIndex === building.position) continue;
                                
                                const adjacentBuilding = gameState.buildings.find(b => b.position === adjacentIndex);
                                if (adjacentBuilding) {
                                    // Increase production of adjacent buildings
                                    const adjType = buildingTypes[adjacentBuilding.type];
                                    if (adjType.produces) {
                                        for (const [resource, amount] of Object.entries(adjType.produces)) {
                                            gameState[resource] += amount * 0.2 * deltaTime; // 20% bonus
                                        }
                                    }
                                }
                            }
                        }
                    }
                });
                
                // Update stats
                updateStats();
                
                // Animate resource changes
                for (const [resource, value] of Object.entries(prevResources)) {
                    const resourceId = resource + 'Resource';
                    const element = document.getElementById(resourceId);
                    if (element) {
                        const change = gameState[resource] - value;
                        if (Math.abs(change) > 0.1) {
                            animateResourceChange(element, change);
                        }
                    }
                }
                
                // Update resource history (every 10 seconds)
                if (Math.floor(gameState.playTime) % 10 === 0) {
                    updateResourceHistory();
                }
                
                // Random events (chance increases with difficulty)
                if (Math.random() < 0.05 * difficultyMultiplier) {
                    triggerRandomEvent();
                }
                
                // Random decisions (chance increases with difficulty)
                if (Math.random() < 0.02 * difficultyMultiplier) {
                    triggerRandomDecision();
                }
                
                // Update missions
                updateMissionProgress('time', deltaTime);
                
                // Check for level up
                checkLevelUp();
                
                // Check for riot mode (endless gameplay)
                if (gameState.happiness < 30 && !gameState.riotMode) {
                    // Trigger riot event
                    const riotEvent = randomEvents.find(e => e.id === 'riot');
                    if (riotEvent) {
                        riotEvent.effect();
                        showEventNotification(riotEvent);
                    }
                } else if (gameState.happiness > 70 && gameState.riotMode) {
                    // End riot mode
                    gameState.riotMode = false;
                    const isTurkish = gameState.currentLanguage === 'tr';
                    addEvent({
                        tr: 'Huzursuzluk sona erdi! ehir normale dnyor.',
                        en: 'Unrest has ended! The city is returning to normal.'
                    });
                    
                    // Check for achievement
                    checkAchievements();
                }
                
                updateDisplay();
            }
            
            function updateStats() {
                // Reset impacts
                gameState.carbonFootprint = scenarios[gameState.scenario].initialResources.carbonFootprint;
                gameState.livability = scenarios[gameState.scenario].initialResources.livability;
                gameState.sustainability = scenarios[gameState.scenario].initialResources.sustainability;
                
                // Calculate impacts from buildings
                gameState.buildings.forEach(building => {
                    const type = buildingTypes[building.type];
                    const levelMultiplier = 1 + (building.level - 1) * 0.5; // 50% boost per level
                    
                    if (type.impact) {
                        for (const [stat, amount] of Object.entries(type.impact)) {
                            const adjustedAmount = amount * levelMultiplier;
                            switch(stat) {
                                case 'carbon':
                                    gameState.carbonFootprint += adjustedAmount;
                                    break;
                                case 'livability':
                                    gameState.livability += adjustedAmount;
                                    break;
                                case 'sustainability':
                                    gameState.sustainability += adjustedAmount;
                                    break;
                            }
                        }
                    }
                });
                
                // Clamp values
                gameState.carbonFootprint = Math.max(0, Math.min(100, gameState.carbonFootprint));
                gameState.livability = Math.max(0, Math.min(100, gameState.livability));
                gameState.sustainability = Math.max(0, Math.min(100, gameState.sustainability));
                
                // Update population based on livability
                gameState.population += (gameState.livability - 50) / 100;
                gameState.population = Math.max(1, gameState.population);
                
                // Update happiness based on various factors
                const happinessChange = 
                    (gameState.livability / 50) + 
                    (gameState.food / gameState.population / 10) + 
                    (gameState.energy / gameState.population / 5) - 
                    (gameState.carbonFootprint / 50);
                    
                gameState.happiness += happinessChange;
                gameState.happiness = Math.max(0, Math.min(100, gameState.happiness));
                
                // Update environmental effects
                updateEnvironmentalEffects();
                
                // Update weather based on stats
                updateWeather();
                
                // Update missions that track stats
                updateMissionProgress('stat', 'carbonFootprint');
                updateMissionProgress('stat', 'population');
                updateMissionProgress('stat', 'happiness');
                updateMissionProgress('stat', 'sustainability');
            }
            
            function updateEnvironmentalEffects() {
                const smogOverlay = document.getElementById('smogOverlay');
                const cleanOverlay = document.getElementById('cleanOverlay');
                
                // Smog effect based on carbon footprint
                if (gameState.carbonFootprint > 70) {
                    smogOverlay.style.opacity = '0.5';
                } else if (gameState.carbonFootprint > 50) {
                    smogOverlay.style.opacity = '0.3';
                } else {
                    smogOverlay.style.opacity = '0';
                }
                
                // Clean effect based on sustainability
                if (gameState.sustainability > 80) {
                    cleanOverlay.style.opacity = '0.3';
                } else if (gameState.sustainability > 60) {
                    cleanOverlay.style.opacity = '0.1';
                } else {
                    cleanOverlay.style.opacity = '0';
                }
            }
            
            function updateWeather() {
                // Weather changes based on carbon footprint and happiness
                if (gameState.carbonFootprint > 70) {
                    gameState.weather = 'smog';
                } else if (gameState.carbonFootprint < 30 && gameState.happiness > 80) {
                    gameState.weather = 'sunny';
                } else if (gameState.happiness < 50) {
                    gameState.weather = 'rain';
                } else {
                    gameState.weather = 'cloudy';
                }
                
                // Apply weather effects
                const gameWorld = document.querySelector('.game-world');
                
                // Remove existing weather classes
                gameWorld.classList.remove('weather-sunny', 'weather-cloudy', 'weather-rain', 'weather-smog');
                
                // Add current weather class
                gameWorld.classList.add(`weather-${gameState.weather}`);
            }
            
            // Random Events
            function triggerRandomEvent() {
                // Filter events based on conditions
                const availableEvents = randomEvents.filter(event => {
                    if (event.condition) {
                        return event.condition();
                    }
                    return true;
                });
                
                if (availableEvents.length === 0) return;
                
                const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                
                // Apply event effects
                event.effect();
                
                // Add event to log
                addEvent({
                    tr: `${event.title.tr}: ${event.message.tr}`,
                    en: `${event.title.en}: ${event.message.en}`
                });
                
                // Show event notification
                showEventNotification(event);
            }
            
            function showEventNotification(event) {
                const notification = document.createElement('div');
                notification.className = `event-item ${event.type}`;
                
                const isTurkish = gameState.currentLanguage === 'tr';
                notification.innerHTML = `
                    <strong>${isTurkish ? event.title.tr : event.title.en}:</strong> 
                    ${isTurkish ? event.message.tr : event.message.en}
                `;
                
                // Add to events panel
                const eventsPanel = document.getElementById('eventsPanel');
                eventsPanel.insertBefore(notification, eventsPanel.children[1]);
                
                // Limit number of events shown
                while (eventsPanel.children.length > 20) {
                    eventsPanel.removeChild(eventsPanel.lastChild);
                }
                
                // Scroll to bottom
                eventsPanel.scrollTop = eventsPanel.scrollHeight;
                
                // Play sound based on event type
                playSound(event.type);
            }
            
            // Decisions
            function triggerRandomDecision() {
                if (gameState.buildings.length < 3) return; // Don't trigger too early
                
                const decision = decisions[Math.floor(Math.random() * decisions.length)];
                showDecisionModal(decision);
            }
            
            function showDecisionModal(decision) {
                const modal = document.createElement('div');
                modal.className = 'decision-modal';
                modal.style.display = 'flex';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.background = 'rgba(0,0,0,0.8)';
                modal.style.zIndex = '10000';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                
                const content = document.createElement('div');
                content.className = 'decision-content';
                content.style.background = 'white';
                content.style.borderRadius = 'var(--radius-lg)';
                content.style.padding = 'var(--space-xl)';
                content.style.maxWidth = '500px';
                content.style.width = '90%';
                content.style.boxShadow = 'var(--shadow-lg)';
                content.style.animation = 'popIn 0.5s ease-out';
                content.style.textAlign = 'center';
                
                const title = document.createElement('h3');
                const isTurkish = gameState.currentLanguage === 'tr';
                title.textContent = isTurkish ? decision.title.tr : decision.title.en;
                content.appendChild(title);
                
                const text = document.createElement('p');
                text.textContent = isTurkish ? decision.text.tr : decision.text.en;
                content.appendChild(text);
                
                const options = document.createElement('div');
                options.className = 'decision-options';
                options.style.display = 'flex';
                options.style.gap = 'var(--space-md)';
                options.style.marginTop = 'var(--space-lg)';
                options.style.justifyContent = 'center';
                
                decision.options.forEach((option, index) => {
                    const optionEl = document.createElement('div');
                    optionEl.className = `decision-option ${option.type}`;
                    optionEl.textContent = isTurkish ? option.text.tr : option.text.en;
                    optionEl.style.padding = 'var(--space-sm) var(--space-lg)';
                    optionEl.style.borderRadius = 'var(--radius-md)';
                    optionEl.style.cursor = 'pointer';
                    optionEl.style.transition = 'var(--transition)';
                    optionEl.style.fontWeight = '600';
                    
                    if (option.type === 'positive') {
                        optionEl.style.background = 'var(--gradient-primary)';
                        optionEl.style.color = 'white';
                    } else {
                        optionEl.style.background = 'var(--gradient-secondary)';
                        optionEl.style.color = 'white';
                    }
                    
                    optionEl.onmouseover = () => {
                        optionEl.style.transform = 'translateY(-2px)';
                        optionEl.style.boxShadow = 'var(--shadow-md)';
                    };
                    
                    optionEl.onmouseout = () => {
                        optionEl.style.transform = 'none';
                        optionEl.style.boxShadow = 'none';
                    };
                    
                    optionEl.onclick = () => {
                        applyDecisionEffects(option.effects);
                        addEvent(isTurkish ? option.message.tr : option.message.en);
                        modal.remove();
                    };
                    
                    options.appendChild(optionEl);
                });
                
                content.appendChild(options);
                modal.appendChild(content);
                document.body.appendChild(modal);
            }
            
            function applyDecisionEffects(effects) {
                for (const [resource, amount] of Object.entries(effects)) {
                    if (resource === 'carbonFootprint' || resource === 'livability' || resource === 'sustainability') {
                        gameState[resource] += amount;
                    } else {
                        gameState[resource] += amount;
                    }
                }
                updateDisplay();
            }
            
            // Tech Tree
            function showTechTree() {
                const techTreePanel = document.getElementById('techTreePanel');
                const chartsPanel = document.getElementById('chartsPanel');
                
                if (techTreePanel.style.display === 'block') {
                    techTreePanel.style.display = 'none';
                    return;
                }
                
                chartsPanel.style.display = 'none';
                techTreePanel.style.display = 'block';
                
                // Populate tech tree
                const techTreeElement = document.getElementById('techTree');
                techTreeElement.innerHTML = '';
                
                Object.keys(techTree).forEach(techId => {
                    const tech = techTree[techId];
                    const isUnlocked = gameState.techUnlocked.includes(techId);
                    const requirementsMet = tech.requirements.every(req => gameState.techUnlocked.includes(req));
                    
                    const techItem = document.createElement('div');
                    techItem.className = `tech-item ${isUnlocked ? 'unlocked' : requirementsMet ? '' : 'locked'}`;
                    
                    const icon = document.createElement('div');
                    icon.className = 'tech-icon';
                    icon.textContent = tech.emoji;
                    techItem.appendChild(icon);
                    
                    const name = document.createElement('div');
                    name.className = 'tech-name';
                    const isTurkish = gameState.currentLanguage === 'tr';
                    name.textContent = isTurkish ? tech.name.tr : tech.name.en;
                    techItem.appendChild(name);
                    
                    const desc = document.createElement('div');
                    desc.className = 'tech-desc';
                    desc.textContent = isTurkish ? tech.description.tr : tech.description.en;
                    techItem.appendChild(desc);
                    
                    if (!isUnlocked) {
                        const cost = document.createElement('div');
                        cost.className = 'tech-cost';
                        cost.textContent = ` ${tech.cost}`;
                        techItem.appendChild(cost);
                        
                        if (tech.requirements.length > 0) {
                            const reqs = document.createElement('div');
                            reqs.className = 'tech-requirements';
                            const reqNames = tech.requirements.map(req => 
                                isTurkish ? techTree[req].name.tr : techTree[req].name.en
                            );
                            reqs.textContent = isTurkish ? 
                                `Gereksinimler: ${reqNames.join(', ')}` : 
                                `Requires: ${reqNames.join(', ')}`;
                            techItem.appendChild(reqs);
                        }
                        
                        if (requirementsMet) {
                            techItem.onclick = () => researchTech(techId);
                        }
                    } else {
                        // Add checkmark for unlocked techs
                        const checkmark = document.createElement('div');
                        checkmark.innerHTML = '<i class="fas fa-check-circle"></i>';
                        checkmark.style.color = 'var(--success)';
                        checkmark.style.position = 'absolute';
                        checkmark.style.top = '5px';
                        checkmark.style.right = '5px';
                        techItem.appendChild(checkmark);
                    }
                    
                    techTreeElement.appendChild(techItem);
                });
            }
            
            function researchTech(techId) {
                const tech = techTree[techId];
                
                if (gameState.money < tech.cost) {
                    addEvent(getMessage('not_enough_money'));
                    return;
                }
                
                gameState.money -= tech.cost;
                gameState.techUnlocked.push(techId);
                
                // Apply tech effect
                tech.effect();
                
                // Add event
                const isTurkish = gameState.currentLanguage === 'tr';
                addEvent(isTurkish ? 
                    `Teknoloji aratrld: ${tech.name.tr}` : 
                    `Technology researched: ${tech.name.en}`);
                
                // Add XP
                addXP(100);
                
                // Refresh tech tree display
                showTechTree();
                updateDisplay();
                
                // Check for achievements
                if (gameState.techUnlocked.length === Object.keys(techTree).length) {
                    checkAchievements();
                }
            }
            
            function updateBuildingMenu() {
                document.querySelectorAll('.building-option').forEach(option => {
                    const buildingType = option.getAttribute('onclick').match(/selectBuilding\('(.+?)'\)/);
                    if (!buildingType) return;
                    
                    const building = buildingTypes[buildingType[1]];
                    
                    // Check if building is locked by tech
                    if (building.techRequirement && !gameState.techUnlocked.includes(building.techRequirement)) {
                        option.classList.add('locked');
                    } else {
                        option.classList.remove('locked');
                    }
                });
            }
            
            // Missions
            function updateMissionsDisplay() {
                const missionsPanel = document.getElementById('missionsPanel');
                missionsPanel.innerHTML = '';
                
                // Add title
                const title = document.createElement('h3');
                title.className = 'tr-text';
                title.textContent = 'Grevler';
                missionsPanel.appendChild(title);
                
                const titleEn = document.createElement('h3');
                titleEn.className = 'en-text';
                titleEn.textContent = 'Missions';
                titleEn.style.display = 'none';
                missionsPanel.appendChild(titleEn);
                
                // Add active missions
                gameState.missions.forEach(mission => {
                    if (gameState.completedMissions.includes(mission.id)) return;
                    
                    const missionItem = document.createElement('div');
                    missionItem.className = 'mission-item';
                    
                    const icon = document.createElement('i');
                    icon.className = 'fas fa-tasks mission-icon';
                    missionItem.appendChild(icon);
                    
                    const details = document.createElement('div');
                    details.className = 'mission-details';
                    
                    const text = document.createElement('div');
                    text.className = 'mission-text tr-text';
                    text.textContent = mission.title.tr;
                    details.appendChild(text);
                    
                    const textEn = document.createElement('div');
                    textEn.className = 'mission-text en-text';
                    textEn.textContent = mission.title.en;
                    textEn.style.display = 'none';
                    details.appendChild(textEn);
                    
                    const progress = document.createElement('div');
                    progress.className = 'mission-progress';
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'mission-progress-bar';
                    progressBar.style.width = `${Math.min(100, (mission.current / mission.target) * 100)}%`;
                    progress.appendChild(progressBar);
                    
                    details.appendChild(progress);
                    missionItem.appendChild(details);
                    
                    const reward = document.createElement('div');
                    reward.className = 'mission-reward';
                    
                    if (mission.reward.money) {
                        reward.textContent += `+${mission.reward.money} `;
                    }
                    if (mission.reward.energy) {
                        reward.textContent += `+${mission.reward.energy} `;
                    }
                    if (mission.reward.happiness) {
                        reward.textContent += `+${mission.reward.happiness} `;
                    }
                    if (mission.reward.sustainability) {
                        reward.textContent += `+${mission.reward.sustainability} `;
                    }
                    if (mission.reward.food) {
                        reward.textContent += `+${mission.reward.food} `;
                    }
                    if (mission.reward.population) {
                        reward.textContent += `+${mission.reward.population} `;
                    }
                    
                    missionItem.appendChild(reward);
                    missionsPanel.appendChild(missionItem);
                });
            }
            
            function updateMissionProgress(type, specific) {
                gameState.missions.forEach(mission => {
                    if (gameState.completedMissions.includes(mission.id)) return;
                    
                    if (type === 'build' && mission.type === 'build' && mission.buildingType === specific) {
                        mission.current += 1;
                    } else if (type === 'build_multiple' && mission.type === 'build_multiple' && mission.buildingTypes.includes(specific)) {
                        mission.current += 1;
                    } else if (type === 'upgrade' && mission.type === 'upgrade') {
                        mission.current += 1;
                    } else if (type === 'research' && mission.type === 'research') {
                        mission.current = gameState.techUnlocked.length;
                    } else if (type === 'stat' && mission.type === 'reach' && mission.stat === specific) {
                        mission.current = gameState[specific];
                    } else if (type === 'stat' && mission.type === 'maintain' && mission.stat === specific) {
                        if (gameState[specific] <= mission.threshold) {
                            mission.current += 1;
                        } else {
                            mission.current = 0;
                        }
                    } else if (type === 'time' && mission.type === 'maintain') {
                        mission.current += specific;
                    }
                    
                    // Check if mission is completed
                    if (mission.current >= mission.target) {
                        completeMission(mission);
                    }
                });
                
                updateMissionsDisplay();
            }
            
            function completeMission(mission) {
                gameState.completedMissions.push(mission.id);
                
                // Apply rewards
                if (mission.reward.money) gameState.money += mission.reward.money;
                if (mission.reward.energy) gameState.energy += mission.reward.energy;
                if (mission.reward.happiness) gameState.happiness += mission.reward.happiness;
                if (mission.reward.sustainability) gameState.sustainability += mission.reward.sustainability;
                if (mission.reward.food) gameState.food += mission.reward.food;
                if (mission.reward.population) gameState.population += mission.reward.population;
                
                // Add XP
                addXP(50);
                
                // Add event
                const isTurkish = gameState.currentLanguage === 'tr';
                addEvent(isTurkish ? 
                    `Grev tamamland: ${mission.title.tr}! dl kazanld.` : 
                    `Mission complete: ${mission.title.en}! Reward earned.`);
                
                // Play sound
                playSound('success');
                
                // Show floating particle for reward
                const rewardsPanel = document.querySelector('.missions-panel');
                if (rewardsPanel) {
                    let rewardText = '';
                    if (mission.reward.money) rewardText += `+${mission.reward.money} `;
                    if (mission.reward.energy) rewardText += `+${mission.reward.energy} `;
                    if (mission.reward.happiness) rewardText += `+${mission.reward.happiness} `;
                    if (mission.reward.sustainability) rewardText += `+${mission.reward.sustainability} `;
                    if (mission.reward.food) rewardText += `+${mission.reward.food} `;
                    if (mission.reward.population) rewardText += `+${mission.reward.population} `;
                    
                    showFloatingParticle(rewardsPanel, rewardText);
                }
                
                // Check for new missions
                if (gameState.completedMissions.length >= gameState.missions.length && gameState.missions.length < missions.length) {
                    // Add a new mission
                    const newMission = missions.find(m => !gameState.missions.some(gm => gm.id === m.id));
                    if (newMission) {
                        gameState.missions.push({...newMission});
                        addEvent(isTurkish ? 
                            `Yeni grev: ${newMission.title.tr}` : 
                            `New mission: ${newMission.title.en}`);
                    }
                }
            }
            
            // Achievements
            function checkAchievements() {
                achievements.forEach(achievement => {
                    if (gameState.achievements.includes(achievement.id)) return;
                    
                    if (achievement.condition()) {
                        gameState.achievements.push(achievement.id);
                        showAchievement(achievement);
                        
                        // Apply reward
                        if (achievement.reward.xp) {
                            addXP(achievement.reward.xp);
                        }
                    }
                });
            }
            
            function showAchievement(achievement) {
                const popup = document.getElementById('achievementPopup');
                const textElement = document.getElementById('achievementText');
                const isTurkish = gameState.currentLanguage === 'tr';
                
                textElement.textContent = isTurkish ? achievement.title.tr : achievement.title.en;
                popup.style.display = 'block';
                
                // Play sound
                playSound('achievement');
                
                setTimeout(() => {
                    popup.style.display = 'none';
                }, 3000);
            }
            
            function closeAchievement() {
                document.getElementById('achievementPopup').style.display = 'none';
            }
            
            // Level System
            function addXP(amount) {
                gameState.xp += amount;
                
                // Show floating particle
                const levelIndicator = document.querySelector('.level-indicator');
                if (levelIndicator) {
                    showFloatingParticle(levelIndicator, `+${amount} XP`);
                }
                
                if (gameState.xp >= gameState.xpToNextLevel) {
                    levelUp();
                }
            }
            
            function levelUp() {
                gameState.level += 1;
                gameState.xp -= gameState.xpToNextLevel;
                gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
                
                // Add event
                const isTurkish = gameState.currentLanguage === 'tr';
                addEvent(isTurkish ? 
                    `Tebrikler! Seviye atladnz: ${gameState.level}` : 
                    `Congratulations! Level up: ${gameState.level}`);
                
                // Play sound
                playSound('levelup');
                
                // Show level-up effect
                showLevelUpEffect();
                
                // Check for achievements
                checkAchievements();
            }
            
            function showLevelUpEffect() {
                const effect = document.getElementById('levelUpEffect');
                const levelNumber = document.getElementById('levelUpNumber');
                
                levelNumber.textContent = gameState.level;
                effect.style.display = 'block';
                
                // Create confetti
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    confetti.style.animationDelay = `${Math.random() * 2}s`;
                    effect.appendChild(confetti);
                }
                
                setTimeout(() => {
                    effect.style.display = 'none';
                    // Remove confetti
                    while (effect.firstChild) {
                        effect.removeChild(effect.firstChild);
                    }
                }, 3000);
            }
            
            function checkLevelUp() {
                if (gameState.xp >= gameState.xpToNextLevel) {
                    levelUp();
                }
            }
            
            // Save/Load Functions
            function updateSaveSlots() {
                // Check each save slot
                for (let i = 1; i <= 3; i++) {
                    const slotKey = `slot${i}`;
                    const savedGame = localStorage.getItem(`ecoCityGame_${slotKey}`);
                    
                    if (savedGame) {
                        const parsedData = JSON.parse(savedGame);
                        gameState.saveSlots[slotKey] = parsedData;
                        
                        // Update UI
                        const slotInfo = document.getElementById(`${slotKey}Info`);
                        const loadBtn = document.getElementById(`load${slotKey.charAt(0).toUpperCase() + slotKey.slice(1)}Btn`);
                        
                        if (slotInfo && loadBtn) {
                            slotInfo.innerHTML = new Date(parsedData.timestamp).toLocaleString();
                            loadBtn.disabled = false;
                        }
                    } else {
                        gameState.saveSlots[slotKey] = null;
                        
                        // Update UI
                        const slotInfo = document.getElementById(`${slotKey}Info`);
                        const loadBtn = document.getElementById(`load${slotKey.charAt(0).toUpperCase() + slotKey.slice(1)}Btn`);
                        
                        if (slotInfo && loadBtn) {
                            const isTurkish = gameState.currentLanguage === 'tr';
                            slotInfo.innerHTML = `<span class="tr-text">Bo</span><span class="en-text" style="display:none">Empty</span>`;
                            loadBtn.disabled = true;
                        }
                    }
                }
            }
            
            function showSaveLoadModal() {
                document.getElementById('saveLoadModal').style.display = 'flex';
                updateSaveSlots();
            }
            
            function closeSaveLoadModal() {
                document.getElementById('saveLoadModal').style.display = 'none';
            }
            
            function saveGame(slot) {
                // Save all game state
                const saveData = {
                    gameState: gameState,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem(`ecoCityGame_${slot}`, JSON.stringify(saveData));
                gameState.saveSlots[slot] = saveData;
                
                addEvent(getMessage('game_saved'));
                
                // Play sound
                playSound('save');
                
                // Update UI
                updateSaveSlots();
            }
            
            function loadGame(slot) {
                const savedData = localStorage.getItem(`ecoCityGame_${slot}`);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    gameState = parsedData.gameState;
                    
                    // Re-render the game
                    renderBuildings();
                    updateDisplay();
                    updateMissionsDisplay();
                    
                    // If the game was playing, restart the game loop
                    if (gameState.isPlaying) {
                        startGameLoop();
                    }
                    
                    addEvent(getMessage('game_loaded'));
                    
                    // Play sound
                    playSound('load');
                } else {
                    addEvent(getMessage('no_saved_game'));
                }
            }
            
            function renderBuildings() {
                const grid = document.getElementById('gameGrid');
                
                // Reset all tiles to grass
                for (let i = 0; i < grid.children.length; i++) {
                    const tile = grid.children[i];
                    if (!tile.classList.contains('water') && !tile.classList.contains('rock') && 
                        !tile.classList.contains('mountain') && !tile.classList.contains('desert')) {
                        tile.className = 'game-tile grass';
                        tile.innerHTML = '';
                        tile.dataset.terrain = 'grass';
                    }
                }
                
                // Render buildings
                gameState.buildings.forEach(building => {
                    const tile = grid.children[building.position];
                    if (tile) {
                        tile.className = `game-tile ${building.type}`;
                        tile.innerHTML = buildingTypes[building.type].emoji;
                        tile.innerHTML += `<span class="building-level">${building.level}</span>`;
                    }
                });
            }
            
            // Charts
            function showCharts() {
                const techTreePanel = document.getElementById('techTreePanel');
                const chartsPanel = document.getElementById('chartsPanel');
                
                if (chartsPanel.style.display === 'block') {
                    chartsPanel.style.display = 'none';
                    return;
                }
                
                techTreePanel.style.display = 'none';
                chartsPanel.style.display = 'block';
                
                // Simple chart implementation (in a real game, you would use a charting library)
                updateResourceCharts();
            }
            
            function updateResourceCharts() {
                // Update money chart
                const moneyChart = document.getElementById('moneyChart');
                moneyChart.innerHTML = '<canvas id="moneyCanvas"></canvas>';
                drawLineChart('moneyCanvas', gameState.resourceHistory.money, 'Money');
                
                // Update energy chart
                const energyChart = document.getElementById('energyChart');
                energyChart.innerHTML = '<canvas id="energyCanvas"></canvas>';
                drawLineChart('energyCanvas', gameState.resourceHistory.energy, 'Energy');
                
                // Update carbon chart
                const carbonChart = document.getElementById('carbonChart');
                carbonChart.innerHTML = '<canvas id="carbonCanvas"></canvas>';
                drawLineChart('carbonCanvas', gameState.resourceHistory.carbon, 'Carbon');
            }
            
            function drawLineChart(canvasId, data, label) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const width = canvas.offsetWidth;
                const height = canvas.offsetHeight;
                
                // Set canvas size
                canvas.width = width;
                canvas.height = height;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                if (data.length < 2) return;
                
                // Find min and max values
                const minValue = Math.min(...data);
                const maxValue = Math.max(...data);
                const range = maxValue - minValue || 1;
                
                // Draw line
                ctx.beginPath();
                ctx.strokeStyle = '#00a896';
                ctx.lineWidth = 2;
                
                data.forEach((value, index) => {
                    const x = (index / (data.length - 1)) * width;
                    const y = height - ((value - minValue) / range) * height;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
                
                // Draw label
                ctx.fillStyle = '#264653';
                ctx.font = '12px Poppins';
                ctx.fillText(label, 10, 20);
            }
            
            function updateResourceHistory() {
                gameState.resourceHistory.money.push(Math.floor(gameState.money));
                gameState.resourceHistory.energy.push(Math.floor(gameState.energy));
                gameState.resourceHistory.food.push(Math.floor(gameState.food));
                gameState.resourceHistory.population.push(Math.floor(gameState.population));
                gameState.resourceHistory.happiness.push(Math.floor(gameState.happiness));
                gameState.resourceHistory.carbon.push(Math.floor(gameState.carbonFootprint));
                gameState.resourceHistory.time.push(Math.floor(gameState.playTime));
                
                // Keep history to a reasonable size
                if (gameState.resourceHistory.money.length > 20) {
                    Object.keys(gameState.resourceHistory).forEach(key => {
                        gameState.resourceHistory[key].shift();
                    });
                }
            }
            
            // Sound Effects
            function playSound(type) {
                // Create audio context
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create oscillator
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                // Connect nodes
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Set sound based on type
                switch(type) {
                    case 'build':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        oscillator.frequency.exponentialRampToValueAtTime(261.63, audioContext.currentTime + 0.1); // C4
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                        break;
                        
                    case 'upgrade':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        oscillator.frequency.exponentialRampToValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                        break;
                        
                    case 'destroy':
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(220, audioContext.currentTime); // A3
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                        break;
                        
                    case 'achievement':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                        break;
                        
                    case 'success':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime); // E5
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.2);
                        break;
                        
                    case 'warning':
                        oscillator.type = 'triangle';
                        oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime); // E4
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                        break;
                        
                    case 'danger':
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(220, audioContext.currentTime); // A3
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                        
                    case 'levelup':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                        oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3); // C6
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.4);
                        break;
                        
                    case 'save':
                    case 'load':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                        break;
                        
                    case 'ambient':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                        
                    default:
                        // Default sound
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                }
            }
            
            // Language Functions
            function setLanguage(lang) {
                // Save to localStorage
                localStorage.setItem('preferredLanguage', lang);
                
                // Update UI without reloading
                const trElements = document.querySelectorAll('.tr-text');
                const enElements = document.querySelectorAll('.en-text');
                
                if (lang === 'tr') {
                    trElements.forEach(el => {
                        el.style.display = el.tagName === 'SPAN' ? 'inline' : 'block';
                    });
                    enElements.forEach(el => el.style.display = 'none');
                } else {
                    trElements.forEach(el => el.style.display = 'none');
                    enElements.forEach(el => {
                        el.style.display = el.tagName === 'SPAN' ? 'inline' : 'block';
                    });
                }
                
                // Update language toggle buttons
                document.querySelector('.language-toggle button:nth-child(1)').classList.toggle('active', lang === 'tr');
                document.querySelector('.language-toggle button:nth-child(2)').classList.toggle('active', lang === 'en');
                
                // Update game state
                gameState.currentLanguage = lang;
                
                // Update displays
                updateDisplay();
                updateMissionsDisplay();
            }
            
            function updateLanguageContent() {
                const savedLang = localStorage.getItem('preferredLanguage') || 'en'; // Default to English
                setLanguage(savedLang);
            }
            
            // Game Controls
            function toggleGame() {
                if (!gameState.isPlaying) {
                    // If the game hasn't started and we haven't selected a scenario, show the scenario modal
                    if (!gameState.scenario) {
                        showScenarioModal();
                        return;
                    }
                    
                    gameState.isPlaying = true;
                    const toggleBtn = document.getElementById('toggleBtn');
                    toggleBtn.innerHTML = '<i class="fas fa-pause"></i> <span class="tr-text">Duraklat</span><span class="en-text" style="display: none">Pause</span>';
                    startGameLoop();
                    addEvent(getMessage('game_started'));
                } else {
                    gameState.isPlaying = false;
                    const toggleBtn = document.getElementById('toggleBtn');
                    toggleBtn.innerHTML = '<i class="fas fa-play"></i> <span class="tr-text">Devam Et</span><span class="en-text" style="display: none">Resume</span>';
                    stopGameLoop();
                    addEvent(getMessage('game_paused'));
                }
            }
            
            // Utility Functions
            function trackCoffeeClick() {
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'buy_coffee_click', {
                        'event_category': 'support',
                        'event_label': 'donation_button'
                    });
                }
            }
            
            function showScenarioModal() {
                document.getElementById('scenarioModal').style.display = 'flex';
            }
            
            // Event Functions
            function addEvent(message) {
                const eventItem = document.createElement('div');
                eventItem.className = 'event-item';
                
                if (typeof message === 'object') {
                    const isTurkish = gameState.currentLanguage === 'tr';
                    eventItem.textContent = isTurkish ? message.tr : message.en;
                } else {
                    eventItem.textContent = message;
                }
                
                // Add to game state
                gameState.events.push(message);
                
                // Add to UI
                const eventsPanel = document.getElementById('eventsPanel');
                eventsPanel.insertBefore(eventItem, eventsPanel.children[1]);
                
                // Limit number of events shown
                while (eventsPanel.children.length > 20) {
                    eventsPanel.removeChild(eventsPanel.lastChild);
                }
                
                // Scroll to bottom
                eventsPanel.scrollTop = eventsPanel.scrollHeight;
            }
            
            function getMessage(id, params = {}) {
                const messages = {
                    city_founded: {
                        tr: 'ehir kuruldu! Haydi gelitirmeye balayalm.',
                        en: 'City founded! Let\'s start developing.'
                    },
                    not_enough_money: {
                        tr: 'Yeterli paranz yok!',
                        en: 'Not enough money!'
                    },
                    game_started: {
                        tr: 'Oyun balad! ehriniz byyor...',
                        en: 'Game started! Your city is growing...'
                    },
                    game_paused: {
                        tr: 'Oyun duraklatld.',
                        en: 'Game paused.'
                    },
                    game_saved: {
                        tr: 'Oyun kaydedildi!',
                        en: 'Game saved!'
                    },
                    game_loaded: {
                        tr: 'Oyun yklendi!',
                        en: 'Game loaded!'
                    },
                    no_saved_game: {
                        tr: 'Kaytl oyun bulunamad.',
                        en: 'No saved game found.'
                    },
                    selected_tool: {
                        tr: 'Ara seildi: {tool}',
                        en: 'Tool selected: {tool}'
                    }
                };
                
                // Add building messages
                Object.keys(buildingTypes).forEach(type => {
                    messages[`built_${type}`] = {
                        tr: `Yeni bir ${buildingTypes[type].name.tr} ina edildi!`,
                        en: `A new ${buildingTypes[type].name.en} was built!`
                    };
                    
                    messages[`selected_${type}`] = {
                        tr: `${buildingTypes[type].name.tr} seildi. Bir karo tklayarak ina edin.`,
                        en: `${buildingTypes[type].name.en} selected. Click a tile to build.`
                    };
                });
                
                // Replace parameters in message
                let message = messages[id] || { tr: id, en: id };
                if (params) {
                    for (const [key, value] of Object.entries(params)) {
                        message.tr = message.tr.replace(`{${key}}`, value);
                        message.en = message.en.replace(`{${key}}`, value);
                    }
                }
                
                return message;
            }
            
            // UI Functions
            function updateDisplay() {
                // Update resources
                document.getElementById('moneyResource').textContent = Math.floor(gameState.money);
                document.getElementById('energyResource').textContent = Math.floor(gameState.energy);
                document.getElementById('foodResource').textContent = Math.floor(gameState.food);
                document.getElementById('populationResource').textContent = Math.floor(gameState.population);
                document.getElementById('happinessResource').textContent = Math.floor(gameState.happiness);
                
                // Update stats
                document.getElementById('carbonStat').textContent = Math.floor(gameState.carbonFootprint);
                document.getElementById('livabilityStat').textContent = Math.floor(gameState.livability);
                document.getElementById('sustainabilityStat').textContent = Math.floor(gameState.sustainability);
                document.getElementById('totalBuildingsStat').textContent = gameState.buildings.length;
                
                // Update play time
                const minutes = Math.floor(gameState.playTime / 60);
                const seconds = Math.floor(gameState.playTime % 60);
                document.getElementById('playTimeStat').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Update level display
                document.getElementById('levelValue').textContent = gameState.level;
                document.getElementById('levelProgress').style.width = `${(gameState.xp / gameState.xpToNextLevel) * 100}%`;
                
                // Color code resources based on levels
                updateResourceColor('moneyResource', gameState.money, 500);
                updateResourceColor('energyResource', gameState.energy, 30);
                updateResourceColor('foodResource', gameState.food, gameState.population * 5);
                updateResourceColor('happinessResource', gameState.happiness, 50);
                
                // Update riot mode indicator
                if (gameState.riotMode) {
                    document.querySelector('.game-world').style.border = '5px solid var(--danger)';
                } else {
                    document.querySelector('.game-world').style.border = 'none';
                }
            }
            
            function updateResourceColor(id, value, threshold) {
                const element = document.getElementById(id);
                if (value < threshold * 0.3) {
                    element.style.color = 'var(--danger)';
                } else if (value < threshold) {
                    element.style.color = 'var(--warning)';
                } else {
                    element.style.color = '';
                }
            }
            
            function animateResourceChange(resourceElement, change) {
                // Create a floating text element
                const floatingText = document.createElement('div');
                floatingText.className = 'floating-particle';
                floatingText.textContent = `${change > 0 ? '+' : ''}${Math.floor(change)}${getResourceEmoji(resourceElement.id)}`;
                floatingText.style.left = resourceElement.offsetLeft + 'px';
                floatingText.style.top = resourceElement.offsetTop + 'px';
                floatingText.style.color = change > 0 ? 'var(--success)' : 'var(--danger)';
                
                // Add to the resource panel
                resourceElement.parentElement.appendChild(floatingText);
                
                // Remove after animation
                setTimeout(() => {
                    floatingText.remove();
                }, 2000);
            }
            
            function getResourceEmoji(resourceId) {
                switch(resourceId) {
                    case 'moneyResource': return '';
                    case 'energyResource': return '';
                    case 'foodResource': return '';
                    case 'populationResource': return '';
                    case 'happinessResource': return '';
                    default: return '';
                }
            }
            
            function showFloatingParticle(element, text) {
                const particle = document.createElement('div');
                particle.className = 'floating-particle';
                particle.textContent = text;
                particle.style.left = '50%';
                particle.style.top = '50%';
                particle.style.transform = 'translate(-50%, -50%)';
                
                element.appendChild(particle);
                
                // Remove after animation
                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
            
            // Mobile touch handling
            let touchStartX = 0;
            let touchStartY = 0;
            
            function handleTouchStart(e) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }
            
            function handleTouchMove(e) {
                if (!gameState.selectedBuilding && !gameState.selectedTool) return;
                
                const touchX = e.touches[0].clientX;
                const touchY = e.touches[0].clientY;
                
                const dx = touchX - touchStartX;
                const dy = touchY - touchStartY;
                
                // If significant movement, scroll instead of build
                if (Math.abs(dx) > 10 || Math.abs(dy) > 10) {
                    gameState.selectedBuilding = null;
                    gameState.selectedTool = null;
                    document.querySelectorAll('.building-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                }
            }
            
            // Public API
            return {
                initGame,
                selectScenario,
                startSelectedScenario,
                toggleGame,
                selectBuilding,
                selectTool,
                saveGame,
                loadGame,
                showTechTree,
                showCharts,
                setLanguage,
                updateLanguageContent,
                trackCoffeeClick,
                handleTileClick,
                handleTileDoubleClick,
                handleTouchStart,
                handleTouchMove,
                nextTutorialStep,
                previousTutorialStep,
                skipTutorial,
                showTutorial,
                closeAchievement,
                showSaveLoadModal,
                closeSaveLoadModal,
                researchTech
            };
        })();
        
        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            GameModule.initGame();
            
            // Add touch event listeners for mobile
            if ('ontouchstart' in window) {
                const grid = document.getElementById('gameGrid');
                grid.addEventListener('touchstart', GameModule.handleTouchStart, {passive: true});
                grid.addEventListener('touchmove', GameModule.handleTouchMove, {passive: true});
            }
            
            // Fix "Senin Etkin" button in navbar
            document.querySelector('.navbar a[href="{{ url_for("senin_etkin") }}"]').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = "{{ url_for('senin_etkin') }}";
            });
        });
        
        // Make functions globally accessible
        window.GameModule = GameModule;
    </script>
</body>
</html>